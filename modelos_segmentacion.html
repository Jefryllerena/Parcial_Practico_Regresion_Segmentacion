
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Ejercicio 4. Modelos de Segmentación &#8212; jbook_Parcial_Practico</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'modelos_segmentacion';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Ejercicio 3. Modelos de Regresión" href="modelos_regresion.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="descripcion_del_proyecto.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo-uninorte.png" class="logo__image only-light" alt="jbook_Parcial_Practico - Home"/>
    <script>document.write(`<img src="_static/logo-uninorte.png" class="logo__image only-dark" alt="jbook_Parcial_Practico - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="descripcion_del_proyecto.html">
                    Por: Angélica Sepúlveda, Andrés Pedraza y Jefry Llerena
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="eda.html">Ejercicio 1. Análisis Exploratorio de Datos</a></li>

<li class="toctree-l1"><a class="reference internal" href="modelos_clasificacion.html">Ejercicio 2. Modelos de Clasificación</a></li>
<li class="toctree-l1"><a class="reference internal" href="modelos_regresion.html">Ejercicio 3. Modelos de Regresión</a></li>

<li class="toctree-l1 current active"><a class="current reference internal" href="#">Ejercicio 4. Modelos de Segmentación</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fmodelos_segmentacion.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/modelos_segmentacion.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Ejercicio 4. Modelos de Segmentación</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#punto-4">Punto 4</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parte-a">Parte A</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parte-b">Parte B</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parte-c">Parte C</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplots">Boxplots</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#histogramas">Histogramas</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#comparacion-visual-de-imagenes">Comparacion Visual de Imagenes</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#curvas-roc-y-precision-recall">Curvas ROC y Precision-Recall</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mapa-de-error">Mapa de Error</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="ejercicio-4-modelos-de-segmentacion">
<h1>Ejercicio 4. Modelos de Segmentación<a class="headerlink" href="#ejercicio-4-modelos-de-segmentacion" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># !pip install segmentation_models segmentation_models_pytorch timm monai medpy torchmetrics albumentations imagecodecs einops</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span><span class="o">,</span><span class="w"> </span><span class="nn">json</span><span class="o">,</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span><span class="o">,</span><span class="w"> </span><span class="nn">warnings</span><span class="o">,</span><span class="w"> </span><span class="nn">math</span><span class="o">,</span><span class="w"> </span><span class="nn">gc</span><span class="o">,</span><span class="w"> </span><span class="nn">pandas</span><span class="o">,</span><span class="w"> </span><span class="nn">numpy</span><span class="o">,</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span><span class="o">,</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span><span class="o">,</span><span class="w"> </span><span class="nn">tensorflow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tf</span><span class="o">,</span><span class="w"> </span><span class="nn">cv2</span><span class="o">,</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span><span class="o">,</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">StratifiedKFold</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">precision_recall_curve</span><span class="p">,</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span><span class="p">,</span> <span class="n">balanced_accuracy_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span><span class="o">,</span><span class="w"> </span><span class="nn">tifffile</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tiff</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">optim</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torch.utils.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">DataLoader</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torchvision.transforms</span><span class="w"> </span><span class="kn">import</span> <span class="n">functional</span> <span class="k">as</span> <span class="n">TF</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torchvision.models.detection</span><span class="w"> </span><span class="kn">import</span> <span class="n">maskrcnn_resnet50_fpn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">segmentation_models_pytorch</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">smp</span><span class="o">,</span><span class="w"> </span><span class="nn">timm</span><span class="o">,</span><span class="w"> </span><span class="nn">monai</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">KFold</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">balanced_accuracy_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.spatial.distance</span><span class="w"> </span><span class="kn">import</span> <span class="n">directed_hausdorff</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">medpy.metric.binary</span><span class="w"> </span><span class="kn">import</span> <span class="n">hd95</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">skimage.draw</span><span class="w"> </span><span class="kn">import</span> <span class="n">polygon</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>

<span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">benchmark</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">mp</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">device</span>
</pre></div>
</div>
</div>
</div>
<section id="punto-4">
<h2>Punto 4<a class="headerlink" href="#punto-4" title="Link to this heading">#</a></h2>
<section id="parte-a">
<h3>Parte A<a class="headerlink" href="#parte-a" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">meta_tiles</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;tile_meta.csv&#39;</span><span class="p">)</span>
<span class="n">meta_wsi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;wsi_meta.csv&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;polygons.jsonl&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">anotaciones</span> <span class="o">=</span> <span class="p">[</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">f</span><span class="p">]</span>

<span class="n">df_anot</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">anotaciones</span><span class="p">,</span> <span class="s1">&#39;annotations&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
<span class="n">df_anot</span><span class="p">[</span><span class="s1">&#39;area_px&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_anot</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ls</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">contourArea</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ls</span><span class="p">))</span>

<span class="n">df_anot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>type</th>
      <th>coordinates</th>
      <th>id</th>
      <th>area_px</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>glomerulus</td>
      <td>[[[167, 249], [166, 249], [165, 249], [164, 24...</td>
      <td>0006ff2aa7cd</td>
      <td>55942.5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>blood_vessel</td>
      <td>[[[283, 109], [282, 109], [281, 109], [280, 10...</td>
      <td>0006ff2aa7cd</td>
      <td>521.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>blood_vessel</td>
      <td>[[[104, 292], [103, 292], [102, 292], [101, 29...</td>
      <td>0006ff2aa7cd</td>
      <td>939.5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>blood_vessel</td>
      <td>[[[505, 442], [504, 442], [503, 442], [502, 44...</td>
      <td>0006ff2aa7cd</td>
      <td>928.5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>blood_vessel</td>
      <td>[[[375, 477], [374, 477], [373, 477], [372, 47...</td>
      <td>0006ff2aa7cd</td>
      <td>963.5</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>17513</th>
      <td>blood_vessel</td>
      <td>[[[184, 308], [183, 308], [182, 308], [181, 30...</td>
      <td>ffd3d193c71e</td>
      <td>360.0</td>
    </tr>
    <tr>
      <th>17514</th>
      <td>blood_vessel</td>
      <td>[[[42, 92], [41, 92], [40, 92], [39, 92], [38,...</td>
      <td>ffd3d193c71e</td>
      <td>661.0</td>
    </tr>
    <tr>
      <th>17515</th>
      <td>blood_vessel</td>
      <td>[[[287, 480], [286, 480], [285, 480], [284, 48...</td>
      <td>ffd3d193c71e</td>
      <td>342.5</td>
    </tr>
    <tr>
      <th>17516</th>
      <td>blood_vessel</td>
      <td>[[[493, 388], [492, 388], [491, 388], [490, 38...</td>
      <td>ffd3d193c71e</td>
      <td>1643.5</td>
    </tr>
    <tr>
      <th>17517</th>
      <td>blood_vessel</td>
      <td>[[[64, 15], [63, 15], [62, 15], [61, 15], [61,...</td>
      <td>ffd3d193c71e</td>
      <td>158.5</td>
    </tr>
  </tbody>
</table>
<p>17518 rows × 4 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">meta_tiles</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>source_wsi</th>
      <th>dataset</th>
      <th>i</th>
      <th>j</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0006ff2aa7cd</td>
      <td>2</td>
      <td>2</td>
      <td>16896</td>
      <td>16420</td>
    </tr>
    <tr>
      <th>1</th>
      <td>000e79e206b7</td>
      <td>6</td>
      <td>3</td>
      <td>10240</td>
      <td>29184</td>
    </tr>
    <tr>
      <th>2</th>
      <td>00168d1b7522</td>
      <td>2</td>
      <td>2</td>
      <td>14848</td>
      <td>14884</td>
    </tr>
    <tr>
      <th>3</th>
      <td>00176a88fdb0</td>
      <td>7</td>
      <td>3</td>
      <td>14848</td>
      <td>25088</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0033bbc76b6b</td>
      <td>1</td>
      <td>1</td>
      <td>10240</td>
      <td>43008</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7028</th>
      <td>ffd37b5c6598</td>
      <td>13</td>
      <td>3</td>
      <td>13824</td>
      <td>21504</td>
    </tr>
    <tr>
      <th>7029</th>
      <td>ffd3d193c71e</td>
      <td>3</td>
      <td>2</td>
      <td>7680</td>
      <td>16896</td>
    </tr>
    <tr>
      <th>7030</th>
      <td>ffd77e2517af</td>
      <td>13</td>
      <td>3</td>
      <td>15872</td>
      <td>28160</td>
    </tr>
    <tr>
      <th>7031</th>
      <td>ffe3cbb81f72</td>
      <td>10</td>
      <td>3</td>
      <td>15456</td>
      <td>23000</td>
    </tr>
    <tr>
      <th>7032</th>
      <td>ffe40e3bc324</td>
      <td>9</td>
      <td>3</td>
      <td>13824</td>
      <td>19456</td>
    </tr>
  </tbody>
</table>
<p>7033 rows × 5 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">meta_wsi</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>source_wsi</th>
      <th>age</th>
      <th>sex</th>
      <th>race</th>
      <th>height</th>
      <th>weight</th>
      <th>bmi</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>58</td>
      <td>F</td>
      <td>W</td>
      <td>160.0</td>
      <td>59.0</td>
      <td>23.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>56</td>
      <td>F</td>
      <td>W</td>
      <td>175.2</td>
      <td>139.6</td>
      <td>45.5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>73</td>
      <td>F</td>
      <td>W</td>
      <td>162.3</td>
      <td>87.5</td>
      <td>33.2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>53</td>
      <td>M</td>
      <td>B</td>
      <td>166.0</td>
      <td>73.0</td>
      <td>26.5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_anot_agr</span> <span class="o">=</span> <span class="n">df_anot</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">])[</span><span class="s1">&#39;area_px&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_anot_agr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>type</th>
      <th>id</th>
      <th>blood_vessel</th>
      <th>glomerulus</th>
      <th>unsure</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0006ff2aa7cd</td>
      <td>10051.0</td>
      <td>55942.5</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>00168d1b7522</td>
      <td>1557.5</td>
      <td>20416.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0033bbc76b6b</td>
      <td>2891.0</td>
      <td>0.0</td>
      <td>2619.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>003504460b3a</td>
      <td>1969.5</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>004daf1cbe75</td>
      <td>4886.5</td>
      <td>37870.5</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1628</th>
      <td>ff434af74304</td>
      <td>5495.5</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1629</th>
      <td>ff4897b3eda6</td>
      <td>7093.5</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1630</th>
      <td>ff66dec71c4c</td>
      <td>21842.0</td>
      <td>2035.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1631</th>
      <td>ff99cdef0f2a</td>
      <td>3630.5</td>
      <td>3017.5</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1632</th>
      <td>ffd3d193c71e</td>
      <td>3165.5</td>
      <td>141444.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>1633 rows × 4 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Estadísticas globales&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total tiles&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">meta_tiles</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total WSIs&#39;</span><span class="p">,</span> <span class="n">meta_tiles</span><span class="p">[</span><span class="s1">&#39;source_wsi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">())</span>


<span class="n">meta_tiles</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Estadísticas globales
Total tiles 7033
Total WSIs 13
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dataset
3    5400
2    1211
1     422
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">meta_tiles</span><span class="p">[[</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;j&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>i</th>
      <th>j</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>7033.000000</td>
      <td>7033.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>14296.542585</td>
      <td>23227.014930</td>
    </tr>
    <tr>
      <th>std</th>
      <td>5946.054578</td>
      <td>10644.032931</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1536.000000</td>
      <td>2560.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>9728.000000</td>
      <td>15265.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>13824.000000</td>
      <td>22528.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>18944.000000</td>
      <td>29656.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>30208.000000</td>
      <td>52753.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Distribución de anotaciones por tipo&#39;</span><span class="p">)</span>
<span class="n">df_anot</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Distribución de anotaciones por tipo
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>type
blood_vessel    16054
unsure            897
glomerulus        567
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cobertura promedio de máscara por tile&#39;</span><span class="p">)</span>
<span class="n">df_anot_agr</span><span class="p">[[</span><span class="s1">&#39;blood_vessel&#39;</span><span class="p">,</span> <span class="s1">&#39;glomerulus&#39;</span><span class="p">,</span> <span class="s1">&#39;unsure&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="mi">512</span> <span class="o">*</span> <span class="mi">512</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cobertura promedio de máscara por tile
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>type
blood_vessel    0.043463
glomerulus      0.045918
unsure          0.004662
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sin_mask</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">meta_tiles</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">df_anot</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Tiles sin máscara&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sin_mask</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tiles sin máscara 5400
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_anot_agr</span><span class="p">[</span><span class="s1">&#39;ratio_bv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_anot_agr</span><span class="p">[</span><span class="s1">&#39;blood_vessel&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">512</span> <span class="o">*</span> <span class="mi">512</span><span class="p">)</span>
<span class="n">an_bajas</span> <span class="o">=</span> <span class="n">df_anot_agr</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;ratio_bv &lt; 0.0005 and ratio_bv &gt; 0&#39;</span><span class="p">)</span>
<span class="n">an_altas</span> <span class="o">=</span> <span class="n">df_anot_agr</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;ratio_bv &gt; 0.9&#39;</span><span class="p">)</span>

<span class="n">df_anot_agr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>type</th>
      <th>id</th>
      <th>blood_vessel</th>
      <th>glomerulus</th>
      <th>unsure</th>
      <th>ratio_bv</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0006ff2aa7cd</td>
      <td>10051.0</td>
      <td>55942.5</td>
      <td>0.0</td>
      <td>0.038342</td>
    </tr>
    <tr>
      <th>1</th>
      <td>00168d1b7522</td>
      <td>1557.5</td>
      <td>20416.0</td>
      <td>0.0</td>
      <td>0.005941</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0033bbc76b6b</td>
      <td>2891.0</td>
      <td>0.0</td>
      <td>2619.0</td>
      <td>0.011028</td>
    </tr>
    <tr>
      <th>3</th>
      <td>003504460b3a</td>
      <td>1969.5</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.007513</td>
    </tr>
    <tr>
      <th>4</th>
      <td>004daf1cbe75</td>
      <td>4886.5</td>
      <td>37870.5</td>
      <td>0.0</td>
      <td>0.018641</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1628</th>
      <td>ff434af74304</td>
      <td>5495.5</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.020964</td>
    </tr>
    <tr>
      <th>1629</th>
      <td>ff4897b3eda6</td>
      <td>7093.5</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.027060</td>
    </tr>
    <tr>
      <th>1630</th>
      <td>ff66dec71c4c</td>
      <td>21842.0</td>
      <td>2035.0</td>
      <td>0.0</td>
      <td>0.083321</td>
    </tr>
    <tr>
      <th>1631</th>
      <td>ff99cdef0f2a</td>
      <td>3630.5</td>
      <td>3017.5</td>
      <td>0.0</td>
      <td>0.013849</td>
    </tr>
    <tr>
      <th>1632</th>
      <td>ffd3d193c71e</td>
      <td>3165.5</td>
      <td>141444.0</td>
      <td>0.0</td>
      <td>0.012075</td>
    </tr>
  </tbody>
</table>
<p>1633 rows × 5 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">an_bajas</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>type</th>
      <th>id</th>
      <th>blood_vessel</th>
      <th>glomerulus</th>
      <th>unsure</th>
      <th>ratio_bv</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1139</th>
      <td>b3ee5e7bcf74</td>
      <td>85.5</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000326</td>
    </tr>
    <tr>
      <th>1232</th>
      <td>c35d853b0cd2</td>
      <td>93.5</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000357</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">an_altas</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>type</th>
      <th>id</th>
      <th>blood_vessel</th>
      <th>glomerulus</th>
      <th>unsure</th>
      <th>ratio_bv</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Posibles anomalías baja cobertura&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">an_bajas</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Posibles anomalías alta cobertura&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">an_altas</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Posibles anomalías baja cobertura 2
Posibles anomalías alta cobertura 0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">cargar_imagen</span><span class="p">(</span><span class="n">tile_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;train/</span><span class="si">{</span><span class="n">tile_id</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generar_mascara</span><span class="p">(</span><span class="n">lista_poligonos</span><span class="p">):</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">lista_poligonos</span><span class="p">:</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">fillPoly</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">[</span><span class="n">pts</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mask</span>

<span class="k">def</span><span class="w"> </span><span class="nf">mostrar_ejemplo</span><span class="p">(</span><span class="n">tile_id</span><span class="p">):</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cargar_imagen</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
    <span class="n">sub</span> <span class="o">=</span> <span class="n">df_anot</span><span class="p">[</span><span class="n">df_anot</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tile_id</span><span class="p">]</span>
    <span class="n">mask_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">fila</span> <span class="ow">in</span> <span class="n">sub</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">mask_total</span> <span class="o">|=</span> <span class="n">generar_mascara</span><span class="p">(</span><span class="n">fila</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">])</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Imagen </span><span class="si">{</span><span class="n">tile_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask_total</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Máscara&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
        <span class="n">a</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">muestras</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_anot_agr</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]),</span> <span class="nb">min</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">meta_tiles</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">tid</span> <span class="ow">in</span> <span class="n">muestras</span><span class="p">:</span>
    <span class="n">mostrar_ejemplo</span><span class="p">(</span><span class="n">tid</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2b6a09c6edaa59f555cd94a7033d11140de28bcf21e50771c842ceb8f9a8db1f.png" src="_images/2b6a09c6edaa59f555cd94a7033d11140de28bcf21e50771c842ceb8f9a8db1f.png" />
<img alt="_images/0dd4097b34f90d16d1d4e306bda0b5caba003c0b46efd4204d3048d4dc68b5be.png" src="_images/0dd4097b34f90d16d1d4e306bda0b5caba003c0b46efd4204d3048d4dc68b5be.png" />
<img alt="_images/120b2606f2b1aef51c75df4b24842290603be8fa93d05823596bd8c9f5b4ae94.png" src="_images/120b2606f2b1aef51c75df4b24842290603be8fa93d05823596bd8c9f5b4ae94.png" />
<img alt="_images/11252ca501ca168509354ad04301572b35aa37b9f5c5f2350687def33240d01d.png" src="_images/11252ca501ca168509354ad04301572b35aa37b9f5c5f2350687def33240d01d.png" />
<img alt="_images/699bde48b772782bd605366dde8a30da727e27646b050133933fed45357c1ea8.png" src="_images/699bde48b772782bd605366dde8a30da727e27646b050133933fed45357c1ea8.png" />
<img alt="_images/2c009b5d0babf27db3ea34f4191c9415eef358ed641248c16b7f0f066e3b80d3.png" src="_images/2c009b5d0babf27db3ea34f4191c9415eef358ed641248c16b7f0f066e3b80d3.png" />
<img alt="_images/93de2f0ecef018a0f2dc2692661849c17312bd4280f12c7f886c462439ca6aa9.png" src="_images/93de2f0ecef018a0f2dc2692661849c17312bd4280f12c7f886c462439ca6aa9.png" />
<img alt="_images/75a742c5e0ddf273598526b7afba3b5e986405573b11001a8213c669a8e0fbb9.png" src="_images/75a742c5e0ddf273598526b7afba3b5e986405573b11001a8213c669a8e0fbb9.png" />
<img alt="_images/e6080c578621c4c1aeb360a85d8c7996e5f658e114c958c0fe7f89726eca4075.png" src="_images/e6080c578621c4c1aeb360a85d8c7996e5f658e114c958c0fe7f89726eca4075.png" />
</div>
</div>
</section>
<section id="parte-b">
<h3>Parte B<a class="headerlink" href="#parte-b" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">meta_tiles</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;tile_meta.csv&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;polygons.jsonl&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">anotaciones</span> <span class="o">=</span> <span class="p">{</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">l</span><span class="p">)[</span><span class="s2">&quot;id&quot;</span><span class="p">]:</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">l</span><span class="p">)[</span><span class="s2">&quot;annotations&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">f</span><span class="p">}</span>

<span class="n">ids_anotados</span> <span class="o">=</span> <span class="p">[</span><span class="n">tid</span> <span class="k">for</span> <span class="n">tid</span> <span class="ow">in</span> <span class="n">meta_tiles</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">if</span> <span class="n">tid</span> <span class="ow">in</span> <span class="n">anotaciones</span><span class="p">]</span>
<span class="n">kfold</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">HuBMAP</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">aug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gris</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ids</span> <span class="o">=</span> <span class="n">ids</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">aug</span> <span class="o">=</span> <span class="n">aug</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">gris</span> <span class="o">=</span> <span class="n">gris</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tid</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">anotaciones</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">512</span><span class="p">,</span><span class="mi">512</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">512</span><span class="p">,</span><span class="mi">512</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">anotaciones</span><span class="p">[</span><span class="n">tid</span><span class="p">]:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">rr</span><span class="p">,</span> <span class="n">cc</span> <span class="o">=</span> <span class="n">polygon</span><span class="p">(</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;blood_vessel&quot;</span><span class="p">:</span>
                <span class="n">m</span><span class="p">[</span><span class="n">rr</span><span class="p">,</span> <span class="n">cc</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">a</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;glomerulus&quot;</span><span class="p">:</span>
                <span class="n">m</span><span class="p">[</span><span class="n">rr</span><span class="p">,</span> <span class="n">cc</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">m</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">tid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">img_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;train/</span><span class="si">{</span><span class="n">tid</span><span class="si">}</span><span class="s2">.tif&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">img_path</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>

            <span class="n">img</span> <span class="o">=</span> <span class="n">tiff</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>
            <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># img = np.repeat(img[..., None], 3, 2)</span>
                <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">gris</span><span class="p">:</span>                         <span class="c1"># convertir</span>
                <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">msk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span><span class="p">(</span><span class="n">tid</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aug</span> <span class="ow">and</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
                <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">msk</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="n">img</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span>
            <span class="n">msk</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">msk</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="n">msk</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Excepción en tile </span><span class="si">{</span><span class="n">tid</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">dice_loss</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
    <span class="n">p</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">inter</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">();</span> <span class="k">return</span> <span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">inter</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="n">t</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">entrenar_modelo</span><span class="p">(</span><span class="n">modelo</span><span class="p">,</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">epocas</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">lote</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">gris</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">inicio</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">preds</span><span class="p">,</span> <span class="n">truth</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">vl</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kfold</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">ids_anotados</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fold </span><span class="si">{</span><span class="n">f</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">dl_tr</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">HuBMAP</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ids_anotados</span><span class="p">)[</span><span class="n">tr</span><span class="p">],</span> <span class="n">aug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gris</span><span class="o">=</span><span class="n">gris</span><span class="p">),</span>
                           <span class="n">batch_size</span><span class="o">=</span><span class="n">lote</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pin_memory</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop_last</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dl_vl</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">HuBMAP</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ids_anotados</span><span class="p">)[</span><span class="n">vl</span><span class="p">],</span> <span class="n">gris</span><span class="o">=</span><span class="n">gris</span><span class="p">),</span>
                           <span class="n">batch_size</span><span class="o">=</span><span class="n">lote</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pin_memory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">modelo</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">modelo</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="mf">1e-3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epocas</span><span class="p">):</span>
            <span class="n">modelo</span><span class="o">.</span><span class="n">train</span><span class="p">();</span> <span class="n">ltr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">dl_tr</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">y</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
                <span class="n">opt</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
                <span class="n">o</span> <span class="o">=</span> <span class="n">modelo</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">dice_loss</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="n">l</span><span class="o">.</span><span class="n">backward</span><span class="p">();</span> <span class="n">opt</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="n">ltr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Época </span><span class="si">{</span><span class="n">e</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> pérdida </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ltr</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">modelo</span><span class="o">.</span><span class="n">eval</span><span class="p">();</span> <span class="n">pl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">dl_vl</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
                <span class="n">o</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">modelo</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
                <span class="n">pl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">);</span> <span class="n">truth</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
        <span class="n">preds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">pl</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">();</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nombre</span><span class="si">}</span><span class="s2">_pred.npz&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                                     <span class="n">t</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">truth</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tiempo total </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">inicio</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">calcular_metricas</span><span class="p">(</span><span class="n">ruta</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ruta</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span>                      <span class="c1"># probabilidades (float32)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">]</span>                      <span class="c1"># ground‑truth (float32)</span>

    <span class="c1"># binarizamos</span>
    <span class="n">pb</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">gt</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="c1"># planos 1‑D para métricas escalar‑escalares</span>
    <span class="n">pb_flat</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">gt_flat</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">inter</span> <span class="o">=</span> <span class="p">(</span><span class="n">pb</span> <span class="o">&amp;</span> <span class="n">gt</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">union</span> <span class="o">=</span> <span class="p">(</span><span class="n">pb</span> <span class="o">|</span> <span class="n">gt</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="n">dice</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">inter</span> <span class="o">/</span> <span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">gt</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-7</span><span class="p">)</span>
    <span class="n">iou</span>  <span class="o">=</span> <span class="n">inter</span> <span class="o">/</span> <span class="p">(</span><span class="n">union</span> <span class="o">+</span> <span class="mf">1e-7</span><span class="p">)</span>
    <span class="n">prec</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">gt_flat</span><span class="p">,</span> <span class="n">pb_flat</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">rec</span>  <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">gt_flat</span><span class="p">,</span> <span class="n">pb_flat</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">auc</span>  <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">gt_flat</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># Hausdorff medio (ignora pares vacíos)</span>
    <span class="n">hds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pb</span><span class="p">)):</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">pb</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">gt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">sum</span><span class="p">():</span>
            <span class="n">hds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hd95</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="n">hd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">hds</span><span class="p">)</span> <span class="k">if</span> <span class="n">hds</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="n">bal</span> <span class="o">=</span> <span class="n">balanced_accuracy_score</span><span class="p">(</span><span class="n">gt_flat</span><span class="p">,</span> <span class="n">pb_flat</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dice</span><span class="p">,</span> <span class="n">iou</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">rec</span><span class="p">,</span> <span class="n">auc</span><span class="p">,</span> <span class="n">hd</span><span class="p">,</span> <span class="n">bal</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="o">=</span><span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># unet = smp.Unet(&quot;resnet18&quot;, classes=1, encoder_weights=None, in_channels=3)</span>
<span class="c1"># entrenar_modelo(unet, &quot;unet&quot;)</span>
</pre></div>
</div>
</div>
</div>
<p>Fold 1</p>
<p>Época 1 pérdida 0.7357</p>
<p>Época 2 pérdida 0.5802</p>
<p>Fold 2</p>
<p>Época 1 pérdida 0.5490</p>
<p>Época 2 pérdida 0.5209</p>
<p>Tiempo total 2960.1s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resultados[&quot;U-Net&quot;]=calcular_metricas(&quot;unet_pred.npz&quot;)</span>
<span class="c1"># print(resultados[&quot;U-Net&quot;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="p">[</span><span class="s2">&quot;U-Net&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.3657676171209982</span><span class="p">,</span> <span class="mf">0.223816160390012</span><span class="p">,</span> <span class="mf">0.5818459552217784</span><span class="p">,</span> <span class="mf">0.2667175449525134</span><span class="p">,</span> <span class="mf">0.6976392639819838</span><span class="p">,</span> <span class="mf">214.9718765130667</span><span class="p">,</span> <span class="mf">0.6288454613023772</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># vnet = monai.networks.nets.VNet(</span>
<span class="c1">#     spatial_dims=2,    # 2‑D porque los tiles son 512×512</span>
<span class="c1">#     in_channels=1,</span>
<span class="c1">#     out_channels=1,</span>
<span class="c1">#     act=&quot;relu&quot;</span>
<span class="c1"># )</span>
<span class="c1"># entrenar_modelo(vnet,&quot;vnet&quot;)</span>
</pre></div>
</div>
</div>
</div>
<p>Fold 1</p>
<p>Época 1 pérdida 0.9191</p>
<p>Época 2 pérdida 0.9154</p>
<p>Fold 2</p>
<p>Época 1 pérdida 0.9092</p>
<p>Época 2 pérdida 0.9039</p>
<p>Tiempo total 5797.5s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resultados[&quot;V_Net&quot;]=calcular_metricas(&quot;vnet_pred.npz&quot;)</span>
<span class="c1"># print(resultados[&quot;V_Net&quot;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="p">[</span><span class="s2">&quot;V_Net&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.12536624099297586</span><span class="p">,</span> <span class="mf">0.06687505780296049</span><span class="p">,</span> <span class="mf">0.07091400658766504</span><span class="p">,</span> <span class="mf">0.5400525739978579</span><span class="p">,</span> <span class="mf">0.6305296480084055</span><span class="p">,</span> <span class="mf">206.19146433752485</span><span class="p">,</span> <span class="mf">0.6034261555389702</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># class SegNet(nn.Module):</span>
<span class="c1">#     def __init__(self):</span>
<span class="c1">#         super().__init__()</span>
<span class="c1">#         self.encoder=nn.Sequential(</span>
<span class="c1">#             nn.Conv2d(3,32,3,1,1),nn.BatchNorm2d(32),nn.ReLU(),nn.MaxPool2d(2),</span>
<span class="c1">#             nn.Conv2d(32,64,3,1,1),nn.BatchNorm2d(64),nn.ReLU(),nn.MaxPool2d(2))</span>
<span class="c1">#         self.decoder=nn.Sequential(</span>
<span class="c1">#             nn.ConvTranspose2d(64,32,2,2),nn.BatchNorm2d(32),nn.ReLU(),</span>
<span class="c1">#             nn.ConvTranspose2d(32,1,2,2))</span>
<span class="c1">#     def forward(self,x): return self.decoder(self.encoder(x))</span>

<span class="c1"># segnet=SegNet()</span>
<span class="c1"># entrenar_modelo(segnet,&quot;segnet&quot;)</span>
</pre></div>
</div>
</div>
</div>
<p>Fold 1</p>
<p>Época 1 pérdida 0.8839</p>
<p>Época 2 pérdida 0.8024</p>
<p>Fold 2</p>
<p>Época 1 pérdida 0.7536</p>
<p>Época 2 pérdida 0.7436</p>
<p>Tiempo total 973.7s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resultados[&quot;SegNet&quot;]=calcular_metricas(&quot;segnet_pred.npz&quot;)</span>
<span class="c1"># print(resultados[&quot;SegNet&quot;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="p">[</span><span class="s2">&quot;SegNet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.22675554542990525</span><span class="p">,</span> <span class="mf">0.12787607757379385</span><span class="p">,</span> <span class="mf">0.2369690363294747</span><span class="p">,</span> <span class="mf">0.21738608988773034</span><span class="p">,</span> <span class="mf">0.6405428333526553</span><span class="p">,</span> <span class="mf">179.0008254925285</span><span class="p">,</span> <span class="mf">0.5922115075397454</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># deeplab=smp.DeepLabV3Plus(&quot;resnet34&quot;,classes=1,encoder_weights=None,in_channels=3)</span>
<span class="c1"># entrenar_modelo(deeplab,&quot;deeplab&quot;)</span>
</pre></div>
</div>
</div>
</div>
<p>Fold 1</p>
<p>Época 1 pérdida 0.7330</p>
<p>Época 2 pérdida 0.5968</p>
<p>Fold 2</p>
<p>Época 1 pérdida 0.5733</p>
<p>Época 2 pérdida 0.5476</p>
<p>Tiempo total 3653.1s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resultados[&quot;DeepLabV3+&quot;]=calcular_metricas(&quot;deeplab_pred.npz&quot;)</span>
<span class="c1"># print(resultados[&quot;DeepLabV3+&quot;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="p">[</span><span class="s2">&quot;DeepLabV3+&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.14195539539967134</span><span class="p">,</span> <span class="mf">0.07640042389090353</span><span class="p">,</span> <span class="mf">0.08360187760641055</span><span class="p">,</span> <span class="mf">0.4700399423804192</span><span class="p">,</span> <span class="mf">0.6695391203753587</span><span class="p">,</span> <span class="mf">182.82947204832968</span><span class="p">,</span> <span class="mf">0.6137039010102096</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># att_unet=smp.Unet(&quot;resnet18&quot;,classes=1,encoder_weights=None,in_channels=3,decoder_attention_type=&quot;scse&quot;)</span>
<span class="c1"># entrenar_modelo(att_unet,&quot;attention_unet&quot;)</span>
</pre></div>
</div>
</div>
</div>
<p>Fold 1</p>
<p>Época 1 pérdida 0.6994</p>
<p>Época 2 pérdida 0.5708</p>
<p>Fold 2</p>
<p>Época 1 pérdida 0.5381</p>
<p>Época 2 pérdida 0.5229</p>
<p>Tiempo total 3646.5s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resultados[&quot;Attention U-Net&quot;]=calcular_metricas(&quot;attention_unet_pred.npz&quot;)</span>
<span class="c1"># print(resultados[&quot;Attention U-Net&quot;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="p">[</span><span class="s2">&quot;Attention U-Net&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.4190511078853865</span><span class="p">,</span> <span class="mf">0.26506303269859705</span><span class="p">,</span> <span class="mf">0.606627315675494</span><span class="p">,</span> <span class="mf">0.320078973709521</span><span class="p">,</span> <span class="mf">0.6933218467927132</span><span class="p">,</span> <span class="mf">169.42644471092657</span><span class="p">,</span> <span class="mf">0.6551523467114649</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># from skimage.measure import label, regionprops</span>


<span class="c1"># def colar(batch):</span>
<span class="c1">#     imgs, tgts, gts = zip(*batch)</span>
<span class="c1">#     return list(imgs), list(tgts), list(gts)</span>


<span class="c1"># class HuBMAPMaskRCNN(Dataset):</span>
<span class="c1">#     def __init__(self, ids, aug=False):</span>
<span class="c1">#         self.base = HuBMAP(ids, aug=aug, gris=False)</span>

<span class="c1">#     def __len__(self): return len(self.base)</span>

<span class="c1">#     def __getitem__(self, idx):</span>
<span class="c1">#         img, sem = self.base[idx]            # sem = (1,512,512) uint8</span>
<span class="c1">#         m = sem.squeeze(0).numpy()</span>
<span class="c1">#         inst = label(m, connectivity=1)</span>
<span class="c1">#         props = regionprops(inst)</span>

<span class="c1">#         if len(props)==0:                    # tile sin vasos</span>
<span class="c1">#             target = {</span>
<span class="c1">#                 &quot;boxes&quot;:  torch.zeros((0,4), dtype=torch.float32),</span>
<span class="c1">#                 &quot;labels&quot;: torch.zeros((0,),  dtype=torch.int64),</span>
<span class="c1">#                 &quot;masks&quot;:  torch.zeros((0,512,512), dtype=torch.uint8),</span>
<span class="c1">#                 &quot;image_id&quot;: torch.tensor([idx]),</span>
<span class="c1">#                 &quot;area&quot;:    torch.zeros((0,),  dtype=torch.float32),</span>
<span class="c1">#                 &quot;iscrowd&quot;: torch.zeros((0,),  dtype=torch.int64),</span>
<span class="c1">#             }</span>
<span class="c1">#             return img, target, sem</span>

<span class="c1">#         boxes, masks = [], []</span>
<span class="c1">#         for p in props:</span>
<span class="c1">#             y1,x1,y2,x2 = p.bbox</span>
<span class="c1">#             boxes.append([x1,y1,x2,y2])</span>
<span class="c1">#             masks.append((inst==p.label).astype(np.uint8))</span>

<span class="c1">#         target = {</span>
<span class="c1">#             &quot;boxes&quot;:  torch.as_tensor(boxes, dtype=torch.float32),</span>
<span class="c1">#             &quot;labels&quot;: torch.ones((len(boxes),), dtype=torch.int64),</span>
<span class="c1">#             &quot;masks&quot;:  torch.as_tensor(masks, dtype=torch.uint8),</span>
<span class="c1">#             &quot;image_id&quot;: torch.tensor([idx]),</span>
<span class="c1">#             &quot;area&quot;:   torch.as_tensor([(b[2]-b[0])*(b[3]-b[1]) for b in boxes], dtype=torch.float32),</span>
<span class="c1">#             &quot;iscrowd&quot;:torch.zeros((len(boxes),), dtype=torch.int64),</span>
<span class="c1">#         }</span>
<span class="c1">#         return img, target, sem</span>


<span class="c1"># def entrenar_maskrcnn(modelo, nombre, epocas=2, lote=2):</span>
<span class="c1">#     inicio=time.time(); preds, truth = [], []</span>
<span class="c1">#     for f,(tr,vl) in enumerate(kfold.split(ids_anotados)):</span>
<span class="c1">#         print(f&quot;[Mask] Fold {f+1}&quot;)</span>
<span class="c1">#         dl_tr = DataLoader(</span>
<span class="c1">#             HuBMAPMaskRCNN(np.array(ids_anotados)[tr], aug=True),</span>
<span class="c1">#             batch_size=lote, shuffle=True, num_workers=0,</span>
<span class="c1">#             pin_memory=True, drop_last=True, collate_fn=colar</span>
<span class="c1">#         )</span>
<span class="c1">#         dl_vl = DataLoader(</span>
<span class="c1">#             HuBMAPMaskRCNN(np.array(ids_anotados)[vl]),</span>
<span class="c1">#             batch_size=1, shuffle=False, num_workers=0,</span>
<span class="c1">#             pin_memory=True, collate_fn=colar</span>
<span class="c1">#         )</span>

<span class="c1">#         modelo.to(device).train()</span>
<span class="c1">#         opt = optim.Adam(modelo.parameters(), 1e-4)</span>

<span class="c1">#         for e in range(epocas):</span>
<span class="c1">#             ltr=[]</span>
<span class="c1">#             for imgs, tgts, _ in dl_tr:</span>
<span class="c1">#                 imgs = [i.to(device) for i in imgs]</span>
<span class="c1">#                 tgts = [{k:(v.to(device) if torch.is_tensor(v) else v)</span>
<span class="c1">#                          for k,v in t.items()} for t in tgts]</span>
<span class="c1">#                 loss = sum(modelo(imgs, tgts).values())</span>
<span class="c1">#                 opt.zero_grad(); loss.backward(); opt.step()</span>
<span class="c1">#                 ltr.append(loss.item())</span>
<span class="c1">#             print(f&quot;  Época {e+1} pérdida {np.mean(ltr):.4f}&quot;)</span>

<span class="c1">#         modelo.eval(); pl=[]</span>
<span class="c1">#         with torch.no_grad():</span>
<span class="c1">#             for imgs, _, gts in dl_vl:</span>
<span class="c1">#                 out = modelo([imgs[0].to(device)])[0]</span>
<span class="c1">#                 mpred = torch.zeros_like(gts[0][0])</span>
<span class="c1">#                 keep = out[&quot;scores&quot;] &gt; 0.3</span>
<span class="c1">#                 for m in out[&quot;masks&quot;][keep]:</span>
<span class="c1">#                     mpred = torch.maximum(mpred, (m[0]&gt;0.5).cpu().to(torch.uint8))</span>
<span class="c1">#                 pl.append(mpred.numpy()); truth.append(gts[0].numpy())</span>
<span class="c1">#         preds.append(np.stack(pl,0))</span>
<span class="c1">#         gc.collect(); torch.cuda.empty_cache()</span>

<span class="c1">#     np.savez(f&quot;{nombre}_pred.npz&quot;, p=np.concatenate(preds,0),</span>
<span class="c1">#                                  t=np.concatenate(truth,0))</span>
<span class="c1">#     print(f&quot;Tiempo total {time.time()-inicio:.1f}s&quot;)</span>



<span class="c1"># maskrcnn = maskrcnn_resnet50_fpn(weights=None, num_classes=2)</span>
<span class="c1"># entrenar_maskrcnn(maskrcnn, &quot;maskrcnn&quot;)</span>
</pre></div>
</div>
</div>
</div>
<p>Época 1 pérdida 1.4263</p>
<p>Época 2 pérdida 1.2548</p>
<p>[Mask] Fold 2</p>
<p>Época 1 pérdida 1.1962</p>
<p>Época 2 pérdida 1.1006</p>
<p>Tiempo total 21688.6s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resultados[&quot;Mask R-CNN&quot;]=calcular_metricas(&quot;maskrcnn_pred.npz&quot;)</span>
<span class="c1"># print(resultados[&quot;Mask R-CNN&quot;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="p">[</span><span class="s2">&quot;Mask R-CNN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.4700875588981105</span><span class="p">,</span> <span class="mf">0.30726435465779933</span><span class="p">,</span> <span class="mf">0.35290892473696067</span><span class="p">,</span> <span class="mf">0.7037623147102636</span><span class="p">,</span> <span class="mf">0.8214972106265819</span><span class="p">,</span> <span class="mf">141.30209424083768</span><span class="p">,</span> <span class="mf">0.8214972106265819</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resunet=smp.Unet(&quot;resnet18&quot;,classes=1,encoder_weights=None,in_channels=3)</span>
<span class="c1"># entrenar_modelo(resunet,&quot;resunet&quot;)</span>
</pre></div>
</div>
</div>
</div>
<p>Fold 1</p>
<p>Época 1 pérdida 0.7333</p>
<p>Época 2 pérdida 0.5781</p>
<p>Fold 2</p>
<p>Época 1 pérdida 0.5626</p>
<p>Época 2 pérdida 0.5336</p>
<p>Tiempo total 2984.7s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resultados[&quot;ResUNet&quot;]=calcular_metricas(&quot;resunet_pred.npz&quot;)</span>
<span class="c1"># print(resultados[&quot;ResUNet&quot;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="p">[</span><span class="s2">&quot;ResUNet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.21392137692719543</span><span class="p">,</span> <span class="mf">0.11977153422236302</span><span class="p">,</span> <span class="mf">0.5997590162502497</span><span class="p">,</span> <span class="mf">0.13017624791565846</span><span class="p">,</span> <span class="mf">0.5722688012534252</span><span class="p">,</span> <span class="mf">229.33932011038922</span><span class="p">,</span> <span class="mf">0.5630426595288168</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># psp=smp.PSPNet(&quot;mobilenet_v2&quot;,classes=1,encoder_weights=None,in_channels=3)</span>
<span class="c1"># entrenar_modelo(psp,&quot;pspnet&quot;)</span>
</pre></div>
</div>
</div>
</div>
<p>Fold 1</p>
<p>Época 1 pérdida 0.6465</p>
<p>Época 2 pérdida 0.5530</p>
<p>Fold 2</p>
<p>Época 1 pérdida 0.5336</p>
<p>Época 2 pérdida 0.5074</p>
<p>Tiempo total 993.4s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resultados[&quot;PSPNet&quot;]=calcular_metricas(&quot;pspnet_pred.npz&quot;)</span>
<span class="c1"># print(resultados[&quot;PSPNet&quot;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="p">[</span><span class="s2">&quot;PSPNet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.4400795696195428</span><span class="p">,</span> <span class="mf">0.28211667790786576</span><span class="p">,</span> <span class="mf">0.3947327118913157</span><span class="p">,</span> <span class="mf">0.4971975822547149</span><span class="p">,</span> <span class="mf">0.8499361504748153</span><span class="p">,</span> <span class="mf">175.85728472086944</span><span class="p">,</span> <span class="mf">0.7306477970888254</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fcn=smp.FPN(&quot;mobilenet_v2&quot;,classes=1,encoder_weights=None,in_channels=3)</span>
<span class="c1"># entrenar_modelo(fcn,&quot;fcn&quot;)</span>
</pre></div>
</div>
</div>
</div>
<p>Fold 1</p>
<p>Época 1 pérdida 0.7297</p>
<p>Época 2 pérdida 0.6134</p>
<p>Fold 2</p>
<p>Época 1 pérdida 0.5754</p>
<p>Época 2 pérdida 0.5436</p>
<p>Tiempo total 2075.8s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resultados[&quot;FCN&quot;]=calcular_metricas(&quot;fcn_pred.npz&quot;)</span>
<span class="c1"># print(resultados[&quot;FCN&quot;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="p">[</span><span class="s2">&quot;FCN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.4126242842557098</span><span class="p">,</span> <span class="mf">0.2599411595900837</span><span class="p">,</span> <span class="mf">0.5080749616815667</span><span class="p">,</span> <span class="mf">0.3473656359026521</span><span class="p">,</span> <span class="mf">0.7714862508142828</span><span class="p">,</span> <span class="mf">192.9422429572784</span><span class="p">,</span> <span class="mf">0.6657637622551611</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># from monai.networks.nets import SwinUNETR</span>

<span class="c1"># swin_unet = SwinUNETR(</span>
<span class="c1">#     img_size=(512,512),</span>
<span class="c1">#     in_channels=3,</span>
<span class="c1">#     out_channels=1,</span>
<span class="c1">#     spatial_dims=2,          # ← 2‑D tiles</span>
<span class="c1">#     feature_size=24          # modelo pequeño y rápido</span>
<span class="c1"># )</span>

<span class="c1"># entrenar_modelo(swin_unet,&quot;swin_unet&quot;)</span>
</pre></div>
</div>
</div>
</div>
<p>Fold 1</p>
<p>Época 1 pérdida 0.8214</p>
<p>Época 2 pérdida 0.6322</p>
<p>Fold 2</p>
<p>Época 1 pérdida 0.5621</p>
<p>Época 2 pérdida 0.5310</p>
<p>Tiempo total 5929.9s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resultados[&quot;Swin U-Net&quot;]=calcular_metricas(&quot;swin_unet_pred.npz&quot;)</span>
<span class="c1"># print(resultados[&quot;Swin U-Net&quot;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="p">[</span><span class="s2">&quot;Swin U-Net&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.474761716926587</span><span class="p">,</span> <span class="mf">0.3112705222491033</span><span class="p">,</span> <span class="mf">0.4875930075492259</span><span class="p">,</span> <span class="mf">0.4625884359955025</span><span class="p">,</span> <span class="mf">0.7592380966148162</span><span class="p">,</span> <span class="mf">155.10278622208094</span><span class="p">,</span> <span class="mf">0.7198478485162607</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Dice&quot;</span><span class="p">,</span><span class="s2">&quot;IoU&quot;</span><span class="p">,</span><span class="s2">&quot;Precisión&quot;</span><span class="p">,</span><span class="s2">&quot;Recall&quot;</span><span class="p">,</span><span class="s2">&quot;AUC&quot;</span><span class="p">,</span><span class="s2">&quot;Hausdorff&quot;</span><span class="p">,</span><span class="s2">&quot;Balanced Acc.&quot;</span><span class="p">]</span>

<span class="n">tabla_resultados_modelos</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resultados</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">tabla_resultados_modelos</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Dice</th>
      <th>IoU</th>
      <th>Precisión</th>
      <th>Recall</th>
      <th>AUC</th>
      <th>Hausdorff</th>
      <th>Balanced Acc.</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>U-Net</th>
      <td>0.365768</td>
      <td>0.223816</td>
      <td>0.581846</td>
      <td>0.266718</td>
      <td>0.697639</td>
      <td>214.971877</td>
      <td>0.628845</td>
    </tr>
    <tr>
      <th>V_Net</th>
      <td>0.125366</td>
      <td>0.066875</td>
      <td>0.070914</td>
      <td>0.540053</td>
      <td>0.630530</td>
      <td>206.191464</td>
      <td>0.603426</td>
    </tr>
    <tr>
      <th>SegNet</th>
      <td>0.226756</td>
      <td>0.127876</td>
      <td>0.236969</td>
      <td>0.217386</td>
      <td>0.640543</td>
      <td>179.000825</td>
      <td>0.592212</td>
    </tr>
    <tr>
      <th>DeepLabV3+</th>
      <td>0.141955</td>
      <td>0.076400</td>
      <td>0.083602</td>
      <td>0.470040</td>
      <td>0.669539</td>
      <td>182.829472</td>
      <td>0.613704</td>
    </tr>
    <tr>
      <th>Attention U-Net</th>
      <td>0.419051</td>
      <td>0.265063</td>
      <td>0.606627</td>
      <td>0.320079</td>
      <td>0.693322</td>
      <td>169.426445</td>
      <td>0.655152</td>
    </tr>
    <tr>
      <th>Mask R-CNN</th>
      <td>0.470088</td>
      <td>0.307264</td>
      <td>0.352909</td>
      <td>0.703762</td>
      <td>0.821497</td>
      <td>141.302094</td>
      <td>0.821497</td>
    </tr>
    <tr>
      <th>ResUNet</th>
      <td>0.213921</td>
      <td>0.119772</td>
      <td>0.599759</td>
      <td>0.130176</td>
      <td>0.572269</td>
      <td>229.339320</td>
      <td>0.563043</td>
    </tr>
    <tr>
      <th>PSPNet</th>
      <td>0.440080</td>
      <td>0.282117</td>
      <td>0.394733</td>
      <td>0.497198</td>
      <td>0.849936</td>
      <td>175.857285</td>
      <td>0.730648</td>
    </tr>
    <tr>
      <th>FCN</th>
      <td>0.412624</td>
      <td>0.259941</td>
      <td>0.508075</td>
      <td>0.347366</td>
      <td>0.771486</td>
      <td>192.942243</td>
      <td>0.665764</td>
    </tr>
    <tr>
      <th>Swin U-Net</th>
      <td>0.474762</td>
      <td>0.311271</td>
      <td>0.487593</td>
      <td>0.462588</td>
      <td>0.759238</td>
      <td>155.102786</td>
      <td>0.719848</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">tabla_resultados_modelos</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>|                 |     Dice |       IoU |   Precisión |   Recall |      AUC |   Hausdorff |   Balanced Acc. |
|:----------------|---------:|----------:|------------:|---------:|---------:|------------:|----------------:|
| U-Net           | 0.365768 | 0.223816  |   0.581846  | 0.266718 | 0.697639 |     214.972 |        0.628845 |
| V_Net           | 0.125366 | 0.0668751 |   0.070914  | 0.540053 | 0.63053  |     206.191 |        0.603426 |
| SegNet          | 0.226756 | 0.127876  |   0.236969  | 0.217386 | 0.640543 |     179.001 |        0.592212 |
| DeepLabV3+      | 0.141955 | 0.0764004 |   0.0836019 | 0.47004  | 0.669539 |     182.829 |        0.613704 |
| Attention U-Net | 0.419051 | 0.265063  |   0.606627  | 0.320079 | 0.693322 |     169.426 |        0.655152 |
| Mask R-CNN      | 0.470088 | 0.307264  |   0.352909  | 0.703762 | 0.821497 |     141.302 |        0.821497 |
| ResUNet         | 0.213921 | 0.119772  |   0.599759  | 0.130176 | 0.572269 |     229.339 |        0.563043 |
| PSPNet          | 0.44008  | 0.282117  |   0.394733  | 0.497198 | 0.849936 |     175.857 |        0.730648 |
| FCN             | 0.412624 | 0.259941  |   0.508075  | 0.347366 | 0.771486 |     192.942 |        0.665764 |
| Swin U-Net      | 0.474762 | 0.311271  |   0.487593  | 0.462588 | 0.759238 |     155.103 |        0.719848 |
</pre></div>
</div>
</div>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p></p></th>
<th class="head text-right"><p>Dice</p></th>
<th class="head text-right"><p>IoU</p></th>
<th class="head text-right"><p>Precisión</p></th>
<th class="head text-right"><p>Recall</p></th>
<th class="head text-right"><p>AUC</p></th>
<th class="head text-right"><p>Hausdorff</p></th>
<th class="head text-right"><p>Balanced Acc.</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>U-Net</p></td>
<td class="text-right"><p>0.365768</p></td>
<td class="text-right"><p>0.223816</p></td>
<td class="text-right"><p>0.581846</p></td>
<td class="text-right"><p>0.266718</p></td>
<td class="text-right"><p>0.697639</p></td>
<td class="text-right"><p>214.972</p></td>
<td class="text-right"><p>0.628845</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>V_Net</p></td>
<td class="text-right"><p>0.125366</p></td>
<td class="text-right"><p>0.0668751</p></td>
<td class="text-right"><p>0.070914</p></td>
<td class="text-right"><p>0.540053</p></td>
<td class="text-right"><p>0.63053</p></td>
<td class="text-right"><p>206.191</p></td>
<td class="text-right"><p>0.603426</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>SegNet</p></td>
<td class="text-right"><p>0.226756</p></td>
<td class="text-right"><p>0.127876</p></td>
<td class="text-right"><p>0.236969</p></td>
<td class="text-right"><p>0.217386</p></td>
<td class="text-right"><p>0.640543</p></td>
<td class="text-right"><p>179.001</p></td>
<td class="text-right"><p>0.592212</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>DeepLabV3+</p></td>
<td class="text-right"><p>0.141955</p></td>
<td class="text-right"><p>0.0764004</p></td>
<td class="text-right"><p>0.0836019</p></td>
<td class="text-right"><p>0.47004</p></td>
<td class="text-right"><p>0.669539</p></td>
<td class="text-right"><p>182.829</p></td>
<td class="text-right"><p>0.613704</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Attention U-Net</p></td>
<td class="text-right"><p>0.419051</p></td>
<td class="text-right"><p>0.265063</p></td>
<td class="text-right"><p>0.606627</p></td>
<td class="text-right"><p>0.320079</p></td>
<td class="text-right"><p>0.693322</p></td>
<td class="text-right"><p>169.426</p></td>
<td class="text-right"><p>0.655152</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Mask R-CNN</p></td>
<td class="text-right"><p>0.470088</p></td>
<td class="text-right"><p>0.307264</p></td>
<td class="text-right"><p>0.352909</p></td>
<td class="text-right"><p>0.703762</p></td>
<td class="text-right"><p>0.821497</p></td>
<td class="text-right"><p>141.302</p></td>
<td class="text-right"><p>0.821497</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>ResUNet</p></td>
<td class="text-right"><p>0.213921</p></td>
<td class="text-right"><p>0.119772</p></td>
<td class="text-right"><p>0.599759</p></td>
<td class="text-right"><p>0.130176</p></td>
<td class="text-right"><p>0.572269</p></td>
<td class="text-right"><p>229.339</p></td>
<td class="text-right"><p>0.563043</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>PSPNet</p></td>
<td class="text-right"><p>0.44008</p></td>
<td class="text-right"><p>0.282117</p></td>
<td class="text-right"><p>0.394733</p></td>
<td class="text-right"><p>0.497198</p></td>
<td class="text-right"><p>0.849936</p></td>
<td class="text-right"><p>175.857</p></td>
<td class="text-right"><p>0.730648</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>FCN</p></td>
<td class="text-right"><p>0.412624</p></td>
<td class="text-right"><p>0.259941</p></td>
<td class="text-right"><p>0.508075</p></td>
<td class="text-right"><p>0.347366</p></td>
<td class="text-right"><p>0.771486</p></td>
<td class="text-right"><p>192.942</p></td>
<td class="text-right"><p>0.665764</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Swin U-Net</p></td>
<td class="text-right"><p>0.474762</p></td>
<td class="text-right"><p>0.311271</p></td>
<td class="text-right"><p>0.487593</p></td>
<td class="text-right"><p>0.462588</p></td>
<td class="text-right"><p>0.759238</p></td>
<td class="text-right"><p>155.103</p></td>
<td class="text-right"><p>0.719848</p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p><strong>Dice Coefficient (Coeficiente de Dice)</strong></p></li>
</ul>
<p>Fórmula:</p>
<div class="math notranslate nohighlight">
\[
Dice = \frac{2 \cdot TP}{2 \cdot TP + FP + FN}
\]</div>
<p>Qué mide: Similitud entre el área predicha y la verdadera.</p>
<p>Interpretación:</p>
<p><code class="docutils literal notranslate"><span class="pre">0.0</span></code>: sin superposición</p>
<p><code class="docutils literal notranslate"><span class="pre">1.0</span></code>: superposición perfecta</p>
<ul class="simple">
<li><p><strong>IoU (Intersection over Union)</strong></p></li>
</ul>
<p>Fórmula:</p>
<div class="math notranslate nohighlight">
\[
IoU = \frac{TP}{TP + FP + FN}
\]</div>
<p>También conocido como: Jaccard Index.</p>
<p>Comparación: Similar a Dice, pero más estricto.</p>
<ul class="simple">
<li><p><strong>Precisión (Precision)</strong></p></li>
</ul>
<p>Fórmula:</p>
<div class="math notranslate nohighlight">
\[
Precision = \frac{TP}{TP + FP}
\]</div>
<p>Qué mide: De las regiones predichas como positivas, ¿cuántas lo eran realmente?</p>
<p>Alta precisión: pocos falsos positivos.</p>
<ul class="simple">
<li><p><strong>Recall (Sensibilidad o Exhaustividad)</strong></p></li>
</ul>
<p>Fórmula:</p>
<div class="math notranslate nohighlight">
\[
Recall = \frac{TP}{TP + FN}
\]</div>
<p>Qué mide: De los verdaderos vasos, ¿cuántos fueron detectados?</p>
<p>Alta sensibilidad: pocos falsos negativos.</p>
<ul class="simple">
<li><p><strong>AUC (Área Bajo la Curva ROC)</strong></p></li>
</ul>
<p>Qué mide: Capacidad del modelo para distinguir entre clases (vaso vs no vaso).</p>
<p>Valores típicos:</p>
<p><code class="docutils literal notranslate"><span class="pre">0.5</span></code>: predicción aleatoria</p>
<p><code class="docutils literal notranslate"><span class="pre">1.0</span></code>: separación perfecta</p>
<p>Útil cuando el modelo entrega probabilidades.</p>
<ul class="simple">
<li><p><strong>Hausdorff Distance</strong></p></li>
</ul>
<p>Qué mide: Qué tan lejos están los bordes predichos respecto a los reales.</p>
<p>Valor bajo = mejor.</p>
<p>Importante: en tareas médicas donde los bordes son clínicamente relevantes.</p>
<ul class="simple">
<li><p><strong>Balanced Accuracy (Precisión Balanceada)</strong></p></li>
</ul>
<p>Fórmula:</p>
<div class="math notranslate nohighlight">
\[
\text{BAcc} = \frac{Recall_{class1} + Recall_{class0}}{2}
\]</div>
<p>Funcion: Manejar el desbalance de clases (por ejemplo, mucho fondo y pocos vasos).</p>
<ul class="simple">
<li><p>Interpretación general</p></li>
</ul>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Métrica</p></th>
<th class="head"><p>Evalúa principalmente…</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Dice / IoU</p></td>
<td><p>Superposición entre predicción y verdad</p></td>
</tr>
<tr class="row-odd"><td><p>Precisión</p></td>
<td><p>Ausencia de falsos positivos</p></td>
</tr>
<tr class="row-even"><td><p>Recall</p></td>
<td><p>Ausencia de falsos negativos</p></td>
</tr>
<tr class="row-odd"><td><p>AUC</p></td>
<td><p>Separabilidad general entre clases</p></td>
</tr>
<tr class="row-even"><td><p>Hausdorff</p></td>
<td><p>Precisión en los bordes</p></td>
</tr>
<tr class="row-odd"><td><p>Balanced Acc.</p></td>
<td><p>Desempeño equilibrado en clases</p></td>
</tr>
</tbody>
</table>
</div>
<p>Entre los modelos evaluados, <code class="docutils literal notranslate"><span class="pre">Mask</span> <span class="pre">R-CNN</span></code> y <code class="docutils literal notranslate"><span class="pre">Swin</span> <span class="pre">U-Net</span></code> presentan los mejores desempeños globales. <code class="docutils literal notranslate"><span class="pre">Mask</span> <span class="pre">R-CNN</span></code> logra un equilibrio notable entre las métricas, obteniendo la mayor puntuación en Sensibilidad (0.70), la menor Distancia de Hausdorff (141.30) y la mayor Precisión Balanceada (0.82). <code class="docutils literal notranslate"><span class="pre">Swin</span> <span class="pre">U-Net</span></code>, por su parte, presenta el mayor Coeficiente Dice (0.47) y la mayor IoU (0.31), además de una precisión y sensibilidad competitivas. Esto indica que ambos modelos son capaces de segmentar con precisión y coherencia espacial los vasos sanguíneos, incluso en condiciones computacionales restringidas.</p>
<p>El modelo <code class="docutils literal notranslate"><span class="pre">PSPNet</span></code> también se destaca, particularmente en el área bajo la curva ROC (0.85) y una buena sensibilidad, lo que lo convierte en una opción viable cuando se busca maximizar la detección sin importar tanto la precisión de las fronteras. Por otro lado, modelos como V-Net y DeepLabV3+ muestran desempeños significativamente inferiores en la mayoría de métricas. En estos casos, las puntuaciones bajas de Dice e IoU, combinadas con una precisión reducida, indican dificultades para adaptarse a la estructura del problema y a la escala de entrada de los tiles.</p>
<p><code class="docutils literal notranslate"><span class="pre">U-Net</span></code>, <code class="docutils literal notranslate"><span class="pre">Attention</span> <span class="pre">U-Net</span></code>, <code class="docutils literal notranslate"><span class="pre">FCN</span></code> y <code class="docutils literal notranslate"><span class="pre">SegNet</span></code> muestran desempeños intermedios, siendo opciones aceptables dependiendo del contexto específico, aunque en términos generales fueron superados por las variantes más recientes.</p>
</section>
<section id="parte-c">
<h3>Parte C<a class="headerlink" href="#parte-c" title="Link to this heading">#</a></h3>
<section id="boxplots">
<h4>Boxplots<a class="headerlink" href="#boxplots" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Boxplot para Dice</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;Dice&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Boxplot - Dice&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Boxplot para IoU</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;IoU&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Boxplot - IoU&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Boxplot para Precisión</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;Precisión&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Boxplot - Precisión&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Boxplot para Recall</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;Recall&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Boxplot - Recall&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Boxplot para AUC</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;AUC&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Boxplot - AUC&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Boxplot para Hausdorff</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;Hausdorff&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Boxplot - Hausdorff&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Boxplot para Balanced Accuracy</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;Balanced Acc.&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Boxplot - Balanced Accuracy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/adce8b3464d192d939330e70c05c3f95cd14d468e97c7bd1efa38bf733c6fd3f.png" src="_images/adce8b3464d192d939330e70c05c3f95cd14d468e97c7bd1efa38bf733c6fd3f.png" />
<img alt="_images/86c8b9cdc2c1dab8d9aa0965bed3296f2dad12038dd3fc650c57662a7394a72b.png" src="_images/86c8b9cdc2c1dab8d9aa0965bed3296f2dad12038dd3fc650c57662a7394a72b.png" />
<img alt="_images/c059d5eba3ee5c021aa44d7c09caa8498e302e76e2c7318c42013e787018aed4.png" src="_images/c059d5eba3ee5c021aa44d7c09caa8498e302e76e2c7318c42013e787018aed4.png" />
<img alt="_images/5ebf54772a714b11a83eda9d7496663b55fd4e9bcfab13eb758cd4897a89245a.png" src="_images/5ebf54772a714b11a83eda9d7496663b55fd4e9bcfab13eb758cd4897a89245a.png" />
<img alt="_images/dad632798ab43c97d7fbbf07342d6f127c4dbebed8bc6f0f4f3e70f2fe6ace70.png" src="_images/dad632798ab43c97d7fbbf07342d6f127c4dbebed8bc6f0f4f3e70f2fe6ace70.png" />
<img alt="_images/1ed9118186a522fe6249a68eae5a3e97b54fd0c917f4398df1201bf3df87c712.png" src="_images/1ed9118186a522fe6249a68eae5a3e97b54fd0c917f4398df1201bf3df87c712.png" />
<img alt="_images/7a22f4f33b90b4e67b9bc72f8b3b44d5cbdff1170545685a9f8546e8e14bd2ea.png" src="_images/7a22f4f33b90b4e67b9bc72f8b3b44d5cbdff1170545685a9f8546e8e14bd2ea.png" />
</div>
</div>
<ol class="arabic simple">
<li><p>Coeficiente Dice</p></li>
</ol>
<p>El boxplot de Dice muestra una distribución relativamente amplia con valores entre aproximadamente 0.12 y 0.47, y una mediana cercana a 0.39.
Esto indica que aunque algunos modelos logran segmentaciones relativamente precisas (por encima de 0.45), hay otros cuya capacidad de superposición entre predicción y verdad de terreno es bastante limitada. La dispersión sugiere diferencias marcadas en el rendimiento de los modelos.</p>
<ol class="arabic simple" start="2">
<li><p>IoU (Intersección sobre la Unión)</p></li>
</ol>
<p>La distribución de IoU sigue una tendencia similar a la del Dice, aunque con valores naturalmente más bajos (dado que IoU es una métrica más estricta).
El rango va desde aproximadamente 0.07 hasta 0.31, con una mediana cercana a 0.24.
El hecho de que existan valores tan bajos sugiere que algunos modelos están teniendo dificultades para cubrir adecuadamente las regiones de interés.</p>
<ol class="arabic simple" start="3">
<li><p>Precisión</p></li>
</ol>
<p>El boxplot de Precisión muestra una dispersión considerable, con valores que oscilan entre 0.07 y 0.61, y una mediana cercana a 0.45.
Esto indica que si bien algunos modelos son muy conservadores y predicen pocas regiones (generando alta precisión), otros pueden tener un mayor número de falsos positivos. La variabilidad también puede deberse a diferencias en las estrategias de regularización o umbral de predicción.</p>
<ol class="arabic simple" start="4">
<li><p>Recall (Sensibilidad)</p></li>
</ol>
<p>El Recall presenta un comportamiento opuesto al de la Precisión, con un rango de 0.13 a 0.70 y una mediana de aproximadamente 0.41.
Esto sugiere que mientras algunos modelos tienden a cubrir la mayoría de las regiones relevantes (con mayor recall), lo hacen a expensas de una menor precisión. La dispersión alta también indica un posible desbalance en el aprendizaje de los modelos frente a clases poco representadas.</p>
<ol class="arabic simple" start="5">
<li><p>AUC (Área bajo la curva ROC)</p></li>
</ol>
<p>La AUC muestra valores más concentrados entre 0.57 y 0.85, con una mediana cercana a 0.70.
Esto indica un desempeño general aceptable en términos de discriminación entre clases, aunque también refleja que no todos los modelos manejan bien el trade-off entre sensibilidad y especificidad. Es una métrica más global, menos influenciada por umbrales individuales.</p>
<ol class="arabic simple" start="6">
<li><p>Distancia de Hausdorff</p></li>
</ol>
<p>La métrica Hausdorff presenta una dispersión muy marcada, con valores entre 140 y 230 aproximadamente.
Al tratarse de una métrica sensible a errores puntuales en los bordes, los valores altos indican modelos que cometen errores más severos en la localización o en la forma de las regiones segmentadas. La mediana parece rondar los 180, lo cual es alto en contextos médicos, y sugiere margen importante de mejora en la fidelidad geométrica.</p>
<ol class="arabic simple" start="7">
<li><p>Precisión Balanceada</p></li>
</ol>
<p>La Precisión Balanceada, que considera tanto la sensibilidad como la especificidad, muestra una distribución entre 0.56 y 0.82, con una mediana cercana a 0.65.
Esta métrica es particularmente útil en contextos con clases desbalanceadas como en segmentación médica. Su dispersión relativamente baja, en comparación con otras métricas, indica que la mayoría de los modelos alcanzan un rendimiento razonablemente equilibrado entre las clases.</p>
</section>
<section id="histogramas">
<h4>Histogramas<a class="headerlink" href="#histogramas" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Histograma para Dice</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;Dice&quot;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histograma - Dice&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Dice&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Histograma para IoU</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;IoU&quot;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histograma - IoU&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;IoU&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Histograma para Precisión</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;Precisión&quot;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histograma - Precisión&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Precisión&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Histograma para Recall</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;Recall&quot;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histograma - Recall&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Recall&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Histograma para AUC</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;AUC&quot;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histograma - AUC&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;AUC&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Histograma para Hausdorff</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;Hausdorff&quot;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histograma - Hausdorff&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Hausdorff&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Histograma para Balanced Accuracy</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;Balanced Acc.&quot;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histograma - Balanced Accuracy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Balanced Accuracy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/df535aec48c923638d5bb53f8b3aea78a45c364a847c2e53019ca0e4754deb40.png" src="_images/df535aec48c923638d5bb53f8b3aea78a45c364a847c2e53019ca0e4754deb40.png" />
<img alt="_images/25c20a3f41c9025dddea6e4087ba5739b803543952a22ee16f04ed87cad4dfe5.png" src="_images/25c20a3f41c9025dddea6e4087ba5739b803543952a22ee16f04ed87cad4dfe5.png" />
<img alt="_images/ea0b9e2a841ba8eec278bab8e15904340ae7fb1d60b60d9aad913a0abdf4259f.png" src="_images/ea0b9e2a841ba8eec278bab8e15904340ae7fb1d60b60d9aad913a0abdf4259f.png" />
<img alt="_images/188be23919cad4cbc3a0d1200ee9763139f8bd978b59bc62c5d5e32d8e55fa01.png" src="_images/188be23919cad4cbc3a0d1200ee9763139f8bd978b59bc62c5d5e32d8e55fa01.png" />
<img alt="_images/e946cbb9f39b2fab0c43fa71eaeb127c065ff74c3178e7f3651118f86861443b.png" src="_images/e946cbb9f39b2fab0c43fa71eaeb127c065ff74c3178e7f3651118f86861443b.png" />
<img alt="_images/f803b7696db04fcb952b5628439152a7f85321411ed55b48d85b82ccefd448ea.png" src="_images/f803b7696db04fcb952b5628439152a7f85321411ed55b48d85b82ccefd448ea.png" />
<img alt="_images/8e4c6ba469ad9240daf6c4d0d9f0d94ff6e14d620157539cc39ad42c354e0074.png" src="_images/8e4c6ba469ad9240daf6c4d0d9f0d94ff6e14d620157539cc39ad42c354e0074.png" />
</div>
</div>
<p><strong>Análisis de Distribución</strong></p>
<ul class="simple">
<li><p>Dice e IoU: Presentan distribuciones bimodales con acumulaciones en los rangos más bajos (por debajo de 0.25) y en valores altos (superiores a 0.40). Esto refuerza la idea de que algunos modelos tienen dificultades significativas, mientras otros alcanzan buenos desempeños.</p></li>
<li><p>Precisión: Muestra una distribución sesgada a la derecha, con valores agrupados cerca de 0.6. Esto sugiere que varios modelos son conservadores al momento de predecir regiones, favoreciendo precisión sobre recall.</p></li>
<li><p>Recall: Tiene una distribución más uniforme, lo cual indica mayor diversidad en la capacidad de los modelos para identificar todos los píxeles positivos. Algunos modelos presentan un comportamiento mucho más sensible.</p></li>
<li><p>AUC: Su distribución se centra entre 0.65 y 0.85, lo cual indica que los modelos, en promedio, logran un desempeño aceptable en cuanto a discriminación entre clases.</p></li>
<li><p>Hausdorff: Tiene una distribución relativamente simétrica, con una leve tendencia hacia valores más altos. Esto sugiere que algunos modelos cometen errores notables en la ubicación precisa de las fronteras.</p></li>
<li><p>Balanced Accuracy: La mayoría de los modelos se agrupan entre 0.60 y 0.75, lo cual indica un comportamiento relativamente estable y equilibrado en cuanto a la predicción de ambas clases.</p></li>
</ul>
</section>
<section id="comparacion-visual-de-imagenes">
<h4>Comparacion Visual de Imagenes<a class="headerlink" href="#comparacion-visual-de-imagenes" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;unet_pred.npz&quot;</span><span class="p">)</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span>       <span class="c1"># probabilidades (float32)</span>
<span class="n">truth</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">]</span>       <span class="c1"># ground-truth</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tifffile</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tiff</span>

<span class="k">def</span><span class="w"> </span><span class="nf">mostrar_comparacion</span><span class="p">(</span><span class="n">tid</span><span class="p">,</span> <span class="n">img_folder</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">ruta_npz</span><span class="o">=</span><span class="s2">&quot;unet_pred.npz&quot;</span><span class="p">,</span> <span class="n">indice</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="c1"># Cargar imagen original</span>
    <span class="n">img_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">img_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tid</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">tiff</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>

    <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">img</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># convertir a RGB</span>

    <span class="c1"># Ground Truth</span>
    <span class="n">gt</span> <span class="o">=</span> <span class="n">HuBMAP</span><span class="p">([])</span><span class="o">.</span><span class="n">_mask</span><span class="p">(</span><span class="n">tid</span><span class="p">)</span>

    <span class="c1"># Cargar predicción del modelo</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ruta_npz</span><span class="p">)</span>
    <span class="n">pred_prob</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">][</span><span class="n">indice</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>   <span class="c1"># [512,512]</span>
    <span class="n">pred_bin</span> <span class="o">=</span> <span class="p">(</span><span class="n">pred_prob</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Imagen Original&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gt</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Ground Truth&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pred_bin</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Predicción (Binarizada)&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">mostrar_comparacion</span><span class="p">(</span><span class="s2">&quot;0006ff2aa7cd&quot;</span><span class="p">,</span> <span class="n">ruta_npz</span><span class="o">=</span><span class="s2">&quot;swin_unet_pred.npz&quot;</span><span class="p">,</span> <span class="n">indice</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9df04b9c79bd4742b73caa9aab505c731457c801660a8f14f8b41cff908951be.png" src="_images/9df04b9c79bd4742b73caa9aab505c731457c801660a8f14f8b41cff908951be.png" />
</div>
</div>
</section>
<section id="curvas-roc-y-precision-recall">
<h4>Curvas ROC y Precision-Recall<a class="headerlink" href="#curvas-roc-y-precision-recall" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Curva ROC (Receiver Operating Characteristic): mide la capacidad del modelo para distinguir entre clases. Un AUC cercano a 1 indica un modelo muy discriminativo, mientras que un valor cercano a 0.5 indica un comportamiento aleatorio.</p></li>
<li><p>Curva Precision-Recall: evalúa el balance entre precisión y sensibilidad, especialmente útil cuando las clases están desbalanceadas (como en segmentación médica). Una buena curva PR se caracteriza por una área grande, especialmente cuando la clase positiva es escasa.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">precision_recall_curve</span><span class="p">,</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="n">ruta_npz</span><span class="p">,</span> <span class="n">nombre_modelo</span><span class="o">=</span><span class="s2">&quot;Modelo&quot;</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ruta_npz</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># predicciones como probabilidades (float)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># ground truth binarizado</span>

    <span class="c1"># ROC Curve</span>
    <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">roc_auc</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>

    <span class="c1"># Precision-Recall Curve</span>
    <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">pr_auc</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>

    <span class="c1"># Graficar</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="c1"># Curva ROC</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;AUC = </span><span class="si">{</span><span class="n">roc_auc</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;k--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Aleatorio&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Curva ROC - </span><span class="si">{</span><span class="n">nombre_modelo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;FPR&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;TPR&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># Curva PR</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;AUC = </span><span class="si">{</span><span class="n">pr_auc</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Curva Precision-Recall - </span><span class="si">{</span><span class="n">nombre_modelo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Recall&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Precision&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="s2">&quot;unet_pred.npz&quot;</span><span class="p">,</span> <span class="s2">&quot;U-Net&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c24e33b1ecbaf447a78cb9f90287b24a85459db0117052af787cbbb6640abf21.png" src="_images/c24e33b1ecbaf447a78cb9f90287b24a85459db0117052af787cbbb6640abf21.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="s2">&quot;vnet_pred.npz&quot;</span><span class="p">,</span> <span class="s2">&quot;V-Net&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e76f525551ff0873ec0720d49417f86aef22a1cba0649f57ddaf2f91adc70614.png" src="_images/e76f525551ff0873ec0720d49417f86aef22a1cba0649f57ddaf2f91adc70614.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="s2">&quot;segnet_pred.npz&quot;</span><span class="p">,</span> <span class="s2">&quot;SegNet&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Pumacens\AppData\Local\Temp\ipykernel_21124\1317268308.py:38: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  plt.tight_layout()
C:\Users\Pumacens\AppData\Roaming\Python\Python312\site-packages\IPython\core\pylabtools.py:170: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/2b5872ab18644598cf72dd92fad4217f8f52013078fbc74899d1f65410d03779.png" src="_images/2b5872ab18644598cf72dd92fad4217f8f52013078fbc74899d1f65410d03779.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="s2">&quot;deeplab_pred.npz&quot;</span><span class="p">,</span> <span class="s2">&quot;DeepLabV3+&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Pumacens\AppData\Local\Temp\ipykernel_21124\1317268308.py:38: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  plt.tight_layout()
C:\Users\Pumacens\AppData\Roaming\Python\Python312\site-packages\IPython\core\pylabtools.py:170: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/ff3384c157cf4b50855c6a1328fb0bf539756717027d3b68c8f123073941ed34.png" src="_images/ff3384c157cf4b50855c6a1328fb0bf539756717027d3b68c8f123073941ed34.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="s2">&quot;attention_unet_pred.npz&quot;</span><span class="p">,</span> <span class="s2">&quot;Attention U-Net&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Pumacens\AppData\Local\Temp\ipykernel_21124\1317268308.py:38: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  plt.tight_layout()
C:\Users\Pumacens\AppData\Roaming\Python\Python312\site-packages\IPython\core\pylabtools.py:170: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/b56b329df1dc76a2e1d6baf3ed5f8bc57f4ab2fc36ad41d4c1790daa061b06b8.png" src="_images/b56b329df1dc76a2e1d6baf3ed5f8bc57f4ab2fc36ad41d4c1790daa061b06b8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="s2">&quot;maskrcnn_pred.npz&quot;</span><span class="p">,</span> <span class="s2">&quot;Mask R-CNN&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7c31e3d53d0453db3256768841f8c9b780e7306fb91189ef5e38df3c6e93d3a3.png" src="_images/7c31e3d53d0453db3256768841f8c9b780e7306fb91189ef5e38df3c6e93d3a3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="s2">&quot;resunet_pred.npz&quot;</span><span class="p">,</span> <span class="s2">&quot;ResUNet&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/da8d8862b41ab9ba41219d626bda7a40bedafe4d55c90ea8b3e4f5d6b3ff363b.png" src="_images/da8d8862b41ab9ba41219d626bda7a40bedafe4d55c90ea8b3e4f5d6b3ff363b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="s2">&quot;pspnet_pred.npz&quot;</span><span class="p">,</span> <span class="s2">&quot;PSPNet&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Pumacens\AppData\Local\Temp\ipykernel_21124\1317268308.py:38: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  plt.tight_layout()
C:\Users\Pumacens\AppData\Roaming\Python\Python312\site-packages\IPython\core\pylabtools.py:170: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/8bf10ee418823eb30f154c6fdb3065c9c6457cee0ce9c52d6aa7cb4c76776ddc.png" src="_images/8bf10ee418823eb30f154c6fdb3065c9c6457cee0ce9c52d6aa7cb4c76776ddc.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="s2">&quot;fcn_pred.npz&quot;</span><span class="p">,</span> <span class="s2">&quot;FCN&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Pumacens\AppData\Local\Temp\ipykernel_21124\1317268308.py:38: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  plt.tight_layout()
C:\Users\Pumacens\AppData\Roaming\Python\Python312\site-packages\IPython\core\pylabtools.py:170: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/0f6eeb1eab4709a2233f72813769e416f73658c5e7c835142c48d4fa9e137365.png" src="_images/0f6eeb1eab4709a2233f72813769e416f73658c5e7c835142c48d4fa9e137365.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="s2">&quot;swin_unet_pred.npz&quot;</span><span class="p">,</span> <span class="s2">&quot;Swin U-Net&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Pumacens\AppData\Roaming\Python\Python312\site-packages\IPython\core\pylabtools.py:170: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/456b5c6344c75de4be64624f5f23435ba3c2a04335878ebdb9847bd1d45a6e6c.png" src="_images/456b5c6344c75de4be64624f5f23435ba3c2a04335878ebdb9847bd1d45a6e6c.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>U-Net</strong></p>
<ul>
<li><p>ROC AUC = 0.698: desempeño moderado, con capacidad discriminativa aceptable.</p></li>
<li><p>PR AUC = 0.297: baja. El modelo tiende a sacrificar precisión a medida que aumenta el recall.</p></li>
<li><p>Comentario: U-Net logra un equilibrio aceptable en clasificación general, pero sufre para mantener precisión cuando intenta cubrir más área positiva.</p></li>
</ul>
</li>
<li><p><strong>V-Net</strong></p>
<ul>
<li><p>ROC AUC = 0.631: cercano al azar, indica baja discriminación.</p></li>
<li><p>PR AUC = 0.134: extremadamente baja, lo que indica que el modelo produce muchos falsos positivos.</p></li>
<li><p>Comentario: Este modelo presenta un rendimiento muy pobre en segmentación; incluso al aumentar el recall, la precisión colapsa.</p></li>
</ul>
</li>
<li><p><strong>SegNet</strong></p>
<ul>
<li><p>ROC AUC = 0.641: desempeño bajo, pero por encima del azar. La capacidad de distinguir entre píxeles positivos y negativos es limitada.</p></li>
<li><p>PR AUC = 0.182: muy baja. El modelo presenta dificultades significativas para mantener una buena precisión cuando intenta aumentar el recall.</p></li>
<li><p>Comentario: SegNet tiene un comportamiento débil en términos de segmentación vascular. Aunque discrimina ligeramente mejor que V-Net, el modelo comete muchos falsos positivos y no logra un buen compromiso entre precisión y sensibilidad, lo cual se refleja claramente en la curva Precision-Recall.</p></li>
</ul>
</li>
<li><p><strong>DeepLabV3+</strong></p>
<ul>
<li><p>ROC AUC = 0.670: levemente mejor que V-Net, pero aún débil.</p></li>
<li><p>PR AUC = 0.206: igualmente baja.</p></li>
<li><p>Comentario: El modelo no logra un buen balance entre detección y precisión, similar a V-Net.</p></li>
</ul>
</li>
<li><p><strong>Attention U-Net</strong></p>
<ul>
<li><p>ROC AUC = 0.693: similar a U-Net, pero no superior.</p></li>
<li><p>PR AUC = 0.349: mejor que U-Net y DeepLabV3+, aunque sigue siendo limitado.</p></li>
<li><p>Comentario: El uso de atención mejora ligeramente la calidad de la segmentación en términos de precisión y recall.</p></li>
</ul>
</li>
<li><p><strong>Mask R-CNN</strong></p>
<ul>
<li><p>ROC AUC = 0.821: el más alto entre todos los modelos.</p></li>
<li><p>PR AUC = 0.535: también el mejor valor.</p></li>
<li><p>Comentario: Este modelo tiene un rendimiento sobresaliente, identificando correctamente una gran proporción de verdaderos positivos sin perder precisión. Se adapta bien a la tarea incluso con clases desbalanceadas.</p></li>
</ul>
</li>
<li><p><strong>ResUNet</strong></p>
<ul>
<li><p>ROC AUC = 0.572: el peor valor ROC de todos los modelos.</p></li>
<li><p>PR AUC = 0.194: también bajo.</p></li>
<li><p>Comentario: Aunque tiene buena precisión puntual en métricas previas, el modelo no logra detectar correctamente los vasos a nivel de recall, lo cual se evidencia aquí.</p></li>
</ul>
</li>
<li><p><strong>PSPNet</strong></p>
<ul>
<li><p>ROC AUC = 0.850: el mejor valor ROC.</p></li>
<li><p>PR AUC = 0.436: también alto.</p></li>
<li><p>Comentario: PSPNet presenta uno de los mejores compromisos entre sensibilidad y precisión, especialmente para clases pequeñas. Ideal para segmentación detallada.</p></li>
</ul>
</li>
<li><p><strong>FCN</strong></p>
<ul>
<li><p>ROC AUC = 0.771: alto y consistente.</p></li>
<li><p>PR AUC = 0.374: valor intermedio, por encima de muchos modelos clásicos.</p></li>
<li><p>Comentario: FCN ofrece un rendimiento sólido y consistente. No destaca como PSPNet o Mask R-CNN, pero claramente supera a U-Net y DeepLabV3+.</p></li>
</ul>
</li>
<li><p><strong>Swin U-Net</strong></p>
<ul>
<li><p>ROC AUC = 0.759: alto.</p></li>
<li><p>PR AUC = 0.390: también bueno.</p></li>
<li><p>Comentario: El modelo Swin U-Net mantiene una muy buena discriminación general y una buena relación precisión-recall. Su arquitectura basada en transformers parece efectiva incluso en este dataset reducido.</p></li>
</ul>
</li>
</ul>
<p>Los modelos Mask R-CNN, PSPNet y Swin U-Net presentan las mejores curvas, tanto en ROC como en Precision-Recall. Modelos como V-Net, DeepLabV3+ y ResUNet muestran curvas planas o con caídas abruptas, señal de mala capacidad de generalización y muchos errores de tipo I o II. La curva Precision-Recall fue especialmente útil para identificar el verdadero poder del modelo en este problema desbalanceado.</p>
</section>
<section id="mapa-de-error">
<h4>Mapa de Error<a class="headerlink" href="#mapa-de-error" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tifffile</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tiff</span>

<span class="k">def</span><span class="w"> </span><span class="nf">mostrar_mapa_error</span><span class="p">(</span><span class="n">tid</span><span class="p">,</span> <span class="n">ruta_npz</span><span class="p">,</span> <span class="n">indice</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ruta_imagen</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">):</span>
    <span class="c1"># Cargar imagen original</span>
    <span class="n">img_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ruta_imagen</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tid</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">tiff</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>
    <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">img</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># convertir a RGB</span>

    <span class="c1"># Cargar predicciones</span>
    <span class="n">datos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ruta_npz</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">datos</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">][</span><span class="n">indice</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">datos</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">][</span><span class="n">indice</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="n">pred</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">gt</span> <span class="o">=</span> <span class="n">HuBMAP</span><span class="p">([])</span><span class="o">.</span><span class="n">_mask</span><span class="p">(</span><span class="n">tid</span><span class="p">)</span>

    <span class="c1"># Calcular FP y FN</span>
    <span class="n">FP</span> <span class="o">=</span> <span class="p">(</span><span class="n">pred</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">gt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">FN</span> <span class="o">=</span> <span class="p">(</span><span class="n">pred</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">gt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Crear imagen en blanco (RGB) del error</span>
    <span class="n">error_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">error_img</span><span class="p">[</span><span class="n">FP</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>   <span class="c1"># Rojo para FP</span>
    <span class="n">error_img</span><span class="p">[</span><span class="n">FN</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>   <span class="c1"># Azul para FN</span>

    <span class="c1"># Mostrar imagen original, GT, predicción y mapa de error</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Imagen Original&quot;</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gt</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Ground Truth&quot;</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Predicción&quot;</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">error_img</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Mapa de Error</span><span class="se">\n</span><span class="s2">Rojo = FP | Azul = FN&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Ejemplo de uso:</span>
<span class="n">mostrar_mapa_error</span><span class="p">(</span><span class="s2">&quot;0006ff2aa7cd&quot;</span><span class="p">,</span> <span class="s2">&quot;swin_unet_pred.npz&quot;</span><span class="p">,</span> <span class="n">indice</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a70987117eb95834774b6cd38171afe80dfd10dbeff9bf7907b24a69fae881e3.png" src="_images/a70987117eb95834774b6cd38171afe80dfd10dbeff9bf7907b24a69fae881e3.png" />
</div>
</div>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="modelos_regresion.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Ejercicio 3. Modelos de Regresión</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#punto-4">Punto 4</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parte-a">Parte A</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parte-b">Parte B</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parte-c">Parte C</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplots">Boxplots</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#histogramas">Histogramas</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#comparacion-visual-de-imagenes">Comparacion Visual de Imagenes</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#curvas-roc-y-precision-recall">Curvas ROC y Precision-Recall</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mapa-de-error">Mapa de Error</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Angélica Sepúlveda, Andrés Pedraza y Jefry Llerena
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>