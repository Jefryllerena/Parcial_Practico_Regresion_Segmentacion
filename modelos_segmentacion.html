

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Ejercicio 4. Modelos de Segmentaci√≥n &#8212; jbook_Parcial_Practico</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'modelos_segmentacion';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Ejercicio 3. Modelos de Regresi√≥n" href="modelos_regresion.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="descripcion_del_proyecto.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo-uninorte.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo-uninorte.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="descripcion_del_proyecto.html">
                    Por: Ang√©lica Sep√∫lveda, Andr√©s Pedraza y Jefry Llerena
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="eda.html">Ejercicio 1. An√°lisis Exploratorio de Datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="modelos_clasificacion.html">Ejercicio 2. Modelos de Clasificaci√≥n</a></li>
<li class="toctree-l1"><a class="reference internal" href="modelos_regresion.html">Ejercicio 3. Modelos de Regresi√≥n</a></li>


<li class="toctree-l1 current active"><a class="current reference internal" href="#">Ejercicio 4. Modelos de Segmentaci√≥n</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fmodelos_segmentacion.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/modelos_segmentacion.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Ejercicio 4. Modelos de Segmentaci√≥n</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parte-a">Parte A</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parte-b">Parte B</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parte-c">Parte C</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplots">Boxplots</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#histogramas">Histogramas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparacion-visual-de-imagenes">Comparacion Visual de Imagenes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#curvas-roc-y-precision-recall">Curvas ROC y Precision-Recall</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mapa-de-error">Mapa de Error</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="ejercicio-4-modelos-de-segmentacion">
<h1>Ejercicio 4. Modelos de Segmentaci√≥n<a class="headerlink" href="#ejercicio-4-modelos-de-segmentacion" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># !pip install segmentation_models segmentation_models_pytorch timm monai medpy torchmetrics albumentations imagecodecs einops</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="kn">import</span> <span class="nn">itertools</span><span class="o">,</span> <span class="nn">warnings</span><span class="o">,</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">gc</span><span class="o">,</span> <span class="nn">pandas</span><span class="o">,</span> <span class="nn">numpy</span><span class="o">,</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span><span class="o">,</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span><span class="o">,</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span><span class="o">,</span> <span class="nn">cv2</span><span class="o">,</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span><span class="o">,</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">precision_recall_curve</span><span class="p">,</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span><span class="p">,</span> <span class="n">balanced_accuracy_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">torch</span><span class="o">,</span> <span class="nn">tifffile</span> <span class="k">as</span> <span class="nn">tiff</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">optim</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">DataLoader</span>
<span class="kn">from</span> <span class="nn">torchvision.transforms</span> <span class="kn">import</span> <span class="n">functional</span> <span class="k">as</span> <span class="n">TF</span>
<span class="kn">from</span> <span class="nn">torchvision.models.detection</span> <span class="kn">import</span> <span class="n">maskrcnn_resnet50_fpn</span>
<span class="kn">import</span> <span class="nn">segmentation_models_pytorch</span> <span class="k">as</span> <span class="nn">smp</span><span class="o">,</span> <span class="nn">timm</span><span class="o">,</span> <span class="nn">monai</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">KFold</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">balanced_accuracy_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span>
<span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">import</span> <span class="n">directed_hausdorff</span>
<span class="kn">from</span> <span class="nn">medpy.metric.binary</span> <span class="kn">import</span> <span class="n">hd95</span>
<span class="kn">from</span> <span class="nn">skimage.draw</span> <span class="kn">import</span> <span class="n">polygon</span>
<span class="kn">import</span> <span class="nn">torch.multiprocessing</span> <span class="k">as</span> <span class="nn">mp</span>

<span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">benchmark</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">mp</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">device</span>
</pre></div>
</div>
</div>
</div>
<section id="parte-a">
<h2>Parte A<a class="headerlink" href="#parte-a" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">meta_tiles</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;tile_meta.csv&#39;</span><span class="p">)</span>
<span class="n">meta_wsi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;wsi_meta.csv&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;polygons.jsonl&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">anotaciones</span> <span class="o">=</span> <span class="p">[</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">f</span><span class="p">]</span>

<span class="n">df_anot</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">anotaciones</span><span class="p">,</span> <span class="s1">&#39;annotations&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
<span class="n">df_anot</span><span class="p">[</span><span class="s1">&#39;area_px&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_anot</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ls</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">contourArea</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ls</span><span class="p">))</span>

<span class="n">df_anot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>type</th>
      <th>coordinates</th>
      <th>id</th>
      <th>area_px</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>glomerulus</td>
      <td>[[[167, 249], [166, 249], [165, 249], [164, 24...</td>
      <td>0006ff2aa7cd</td>
      <td>55942.5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>blood_vessel</td>
      <td>[[[283, 109], [282, 109], [281, 109], [280, 10...</td>
      <td>0006ff2aa7cd</td>
      <td>521.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>blood_vessel</td>
      <td>[[[104, 292], [103, 292], [102, 292], [101, 29...</td>
      <td>0006ff2aa7cd</td>
      <td>939.5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>blood_vessel</td>
      <td>[[[505, 442], [504, 442], [503, 442], [502, 44...</td>
      <td>0006ff2aa7cd</td>
      <td>928.5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>blood_vessel</td>
      <td>[[[375, 477], [374, 477], [373, 477], [372, 47...</td>
      <td>0006ff2aa7cd</td>
      <td>963.5</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>17513</th>
      <td>blood_vessel</td>
      <td>[[[184, 308], [183, 308], [182, 308], [181, 30...</td>
      <td>ffd3d193c71e</td>
      <td>360.0</td>
    </tr>
    <tr>
      <th>17514</th>
      <td>blood_vessel</td>
      <td>[[[42, 92], [41, 92], [40, 92], [39, 92], [38,...</td>
      <td>ffd3d193c71e</td>
      <td>661.0</td>
    </tr>
    <tr>
      <th>17515</th>
      <td>blood_vessel</td>
      <td>[[[287, 480], [286, 480], [285, 480], [284, 48...</td>
      <td>ffd3d193c71e</td>
      <td>342.5</td>
    </tr>
    <tr>
      <th>17516</th>
      <td>blood_vessel</td>
      <td>[[[493, 388], [492, 388], [491, 388], [490, 38...</td>
      <td>ffd3d193c71e</td>
      <td>1643.5</td>
    </tr>
    <tr>
      <th>17517</th>
      <td>blood_vessel</td>
      <td>[[[64, 15], [63, 15], [62, 15], [61, 15], [61,...</td>
      <td>ffd3d193c71e</td>
      <td>158.5</td>
    </tr>
  </tbody>
</table>
<p>17518 rows √ó 4 columns</p>
</div></div></div>
</div>
<div style="border-left: 6px solid #2ecc71; border-radius: 6px; overflow: hidden;"> <div style="background-color: #d4f8e8; padding: 8px 12px;"> <strong>üí° An√°lisis</strong> </div> <div style="background-color: #f5fdf9; padding: 12px;"> La tabla <code>df_anot</code> contiene 17,518 anotaciones de estructuras anat√≥micas segmentadas, principalmente de tipo <code>blood_vessel</code> y <code>glomerulus</code>. Cada fila representa una regi√≥n poligonal identificada dentro de una imagen (<code>id</code>), junto con su √°rea en p√≠xeles (<code>area_px</code>). Se observa una gran variabilidad en el tama√±o de las estructuras, desde √°reas peque√±as (‚âà158 px¬≤) hasta muy grandes (m√°s de 55,000 px¬≤), lo que sugiere diferencias marcadas entre tipos de tejidos. Este conjunto permite realizar un an√°lisis por tipo de estructura (por ejemplo, conteo y √°rea total por tipo), por imagen (cu√°ntas estructuras hay por <code>id</code>), y detectar posibles <i>outliers</i> en las √°reas. Un siguiente paso l√≥gico ser√≠a visualizar la distribuci√≥n del √°rea por tipo con histogramas o <i>boxplots</i>, y eventualmente superponer las coordenadas sobre las im√°genes originales para validar las segmentaciones. </div> </div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">meta_tiles</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>source_wsi</th>
      <th>dataset</th>
      <th>i</th>
      <th>j</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0006ff2aa7cd</td>
      <td>2</td>
      <td>2</td>
      <td>16896</td>
      <td>16420</td>
    </tr>
    <tr>
      <th>1</th>
      <td>000e79e206b7</td>
      <td>6</td>
      <td>3</td>
      <td>10240</td>
      <td>29184</td>
    </tr>
    <tr>
      <th>2</th>
      <td>00168d1b7522</td>
      <td>2</td>
      <td>2</td>
      <td>14848</td>
      <td>14884</td>
    </tr>
    <tr>
      <th>3</th>
      <td>00176a88fdb0</td>
      <td>7</td>
      <td>3</td>
      <td>14848</td>
      <td>25088</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0033bbc76b6b</td>
      <td>1</td>
      <td>1</td>
      <td>10240</td>
      <td>43008</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7028</th>
      <td>ffd37b5c6598</td>
      <td>13</td>
      <td>3</td>
      <td>13824</td>
      <td>21504</td>
    </tr>
    <tr>
      <th>7029</th>
      <td>ffd3d193c71e</td>
      <td>3</td>
      <td>2</td>
      <td>7680</td>
      <td>16896</td>
    </tr>
    <tr>
      <th>7030</th>
      <td>ffd77e2517af</td>
      <td>13</td>
      <td>3</td>
      <td>15872</td>
      <td>28160</td>
    </tr>
    <tr>
      <th>7031</th>
      <td>ffe3cbb81f72</td>
      <td>10</td>
      <td>3</td>
      <td>15456</td>
      <td>23000</td>
    </tr>
    <tr>
      <th>7032</th>
      <td>ffe40e3bc324</td>
      <td>9</td>
      <td>3</td>
      <td>13824</td>
      <td>19456</td>
    </tr>
  </tbody>
</table>
<p>7033 rows √ó 5 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">meta_wsi</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>source_wsi</th>
      <th>age</th>
      <th>sex</th>
      <th>race</th>
      <th>height</th>
      <th>weight</th>
      <th>bmi</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>58</td>
      <td>F</td>
      <td>W</td>
      <td>160.0</td>
      <td>59.0</td>
      <td>23.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>56</td>
      <td>F</td>
      <td>W</td>
      <td>175.2</td>
      <td>139.6</td>
      <td>45.5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>73</td>
      <td>F</td>
      <td>W</td>
      <td>162.3</td>
      <td>87.5</td>
      <td>33.2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>53</td>
      <td>M</td>
      <td>B</td>
      <td>166.0</td>
      <td>73.0</td>
      <td>26.5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_anot_agr</span> <span class="o">=</span> <span class="n">df_anot</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">])[</span><span class="s1">&#39;area_px&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_anot_agr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>type</th>
      <th>id</th>
      <th>blood_vessel</th>
      <th>glomerulus</th>
      <th>unsure</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0006ff2aa7cd</td>
      <td>10051.0</td>
      <td>55942.5</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>00168d1b7522</td>
      <td>1557.5</td>
      <td>20416.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0033bbc76b6b</td>
      <td>2891.0</td>
      <td>0.0</td>
      <td>2619.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>003504460b3a</td>
      <td>1969.5</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>004daf1cbe75</td>
      <td>4886.5</td>
      <td>37870.5</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1628</th>
      <td>ff434af74304</td>
      <td>5495.5</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1629</th>
      <td>ff4897b3eda6</td>
      <td>7093.5</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1630</th>
      <td>ff66dec71c4c</td>
      <td>21842.0</td>
      <td>2035.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1631</th>
      <td>ff99cdef0f2a</td>
      <td>3630.5</td>
      <td>3017.5</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1632</th>
      <td>ffd3d193c71e</td>
      <td>3165.5</td>
      <td>141444.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>1633 rows √ó 4 columns</p>
</div></div></div>
</div>
<div style="border-left: 6px solid #2ecc71; border-radius: 6px; overflow: hidden;"> <div style="background-color: #d4f8e8; padding: 8px 12px;"> <strong>üí° An√°lisis</strong> </div> <div style="background-color: #f5fdf9; padding: 12px;"> Se visualizaron tres tablas importantes en el flujo de trabajo actual: <ul> <li><strong>meta_tiles</strong>: contiene 7033 filas y 5 columnas (<code>id</code>, <code>source_wsi</code>, <code>dataset</code>, <code>i</code> y <code>j</code>).</li> <ul> <li><code>id</code> es un identificador √∫nico para cada tile (peque√±a imagen extra√≠da de una WSI).</li> <li><code>source_wsi</code> indica de qu√© imagen completa (WSI) proviene cada tile.</li> <li><code>dataset</code> podr√≠a representar a qu√© partici√≥n o tipo de conjunto pertenece (entrenamiento, validaci√≥n, etc.).</li> <li><code>i</code> y <code>j</code> representan posiciones dentro de la imagen original (coordenadas).</li> </ul>
php-template
Copiar
Editar
  <li><strong>meta_wsi</strong>: contiene la informaci√≥n cl√≠nica de cada imagen <code>source_wsi</code>.</li>
  <ul>
    <li>Incluye variables como <code>age</code>, <code>sex</code>, <code>race</code>, <code>height</code>, <code>weight</code> y <code>bmi</code>.</li>
    <li>Permite asociar la metadata cl√≠nica a los tiles v√≠a el campo <code>source_wsi</code>.</li>
  </ul>
  <li><strong>df_anot_agr</strong>: agrupa la informaci√≥n de anotaciones sobre los tiles.</li>
  <ul>
    <li>Est√° basado en el √°rea en p√≠xeles (<code>area_px</code>) para cada tipo de estructura anat√≥mica.</li>
    <li>Se resumen las √°reas correspondientes a tres categor√≠as: <code>blood_vessel</code>, <code>glomerulus</code> y <code>unsure</code>.</li>
    <li>Los datos fueron agregados por <code>id</code> y reestructurados usando <code>unstack</code>.</li>
  </ul>
</ul>
<p><strong>Inferencias:</strong></p>
<ul>
  <li>Se dispone de suficiente informaci√≥n para fusionar las tres fuentes de datos (<code>tiles</code>, <code>wsi</code> y <code>anotaciones</code>) usando <code>id</code> o <code>source_wsi</code> como claves principales.</li>
  <li>La estructura actual facilitar√° crear datasets enriquecidos para tareas de clasificaci√≥n o segmentaci√≥n en im√°genes m√©dicas.</li>
</ul><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Estad√≠sticas globales&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total tiles&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">meta_tiles</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total WSIs&#39;</span><span class="p">,</span> <span class="n">meta_tiles</span><span class="p">[</span><span class="s1">&#39;source_wsi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">())</span>


<span class="n">meta_tiles</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Estad√≠sticas globales
Total tiles 7033
Total WSIs 13
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dataset
3    5400
2    1211
1     422
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">meta_tiles</span><span class="p">[[</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;j&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>i</th>
      <th>j</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>7033.000000</td>
      <td>7033.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>14296.542585</td>
      <td>23227.014930</td>
    </tr>
    <tr>
      <th>std</th>
      <td>5946.054578</td>
      <td>10644.032931</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1536.000000</td>
      <td>2560.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>9728.000000</td>
      <td>15265.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>13824.000000</td>
      <td>22528.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>18944.000000</td>
      <td>29656.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>30208.000000</td>
      <td>52753.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Distribuci√≥n de anotaciones por tipo&#39;</span><span class="p">)</span>
<span class="n">df_anot</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Distribuci√≥n de anotaciones por tipo
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>type
blood_vessel    16054
unsure            897
glomerulus        567
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<div style="border-left: 6px solid #2ecc71; border-radius: 6px; overflow: hidden;"> <div style="background-color: #d4f8e8; padding: 8px 12px;"> <strong>üí° An√°lisis</strong> </div> <div style="background-color: #f5fdf9; padding: 12px;"> <ul> <li><strong>Resumen general de meta_tiles:</strong></li> <ul> <li>Total de tiles disponibles: <strong>7033</strong></li> <li>Total de im√°genes WSI √∫nicas: <strong>13</strong></li> </ul>
php-template
Copiar
Editar
  <li><strong>Distribuci√≥n por dataset:</strong></li>
  <ul>
    <li><code>Dataset 3</code>: 5400 tiles (mayor√≠a de los datos)</li>
    <li><code>Dataset 2</code>: 1211 tiles</li>
    <li><code>Dataset 1</code>: 422 tiles</li>
  </ul>
  <p>Esto muestra un desequilibrio importante en la cantidad de muestras entre conjuntos.</p>
  <li><strong>Descripci√≥n de coordenadas <code>i</code> y <code>j</code>:</strong></li>
  <ul>
    <li><code>i</code> (posici√≥n horizontal) ‚Äì valores entre 1536 y 30208, con media 14296.5</li>
    <li><code>j</code> (posici√≥n vertical) ‚Äì valores entre 2560 y 52753, con media 23227.0</li>
  </ul>
  <p>Las posiciones son muy variables, indicando que los tiles se distribuyen de forma amplia en las im√°genes originales.</p>
  <li><strong>Distribuci√≥n de anotaciones por tipo (df_anot):</strong></li>
  <ul>
    <li><code>blood_vessel</code> (vasos sangu√≠neos): 16,054 anotaciones (mayor√≠a clara)</li>
    <li><code>unsure</code> (anotaciones inciertas): 897 anotaciones</li>
    <li><code>glomerulus</code> (glom√©rulos): 567 anotaciones</li>
  </ul>
  <p>El tipo de anotaci√≥n predominante son vasos sangu√≠neos. Hay pocos glom√©rulos, lo cual podr√≠a complicar el aprendizaje si no se balancea el dataset adecuadamente.</p>
</ul>
<p><strong>Observaciones clave:</strong></p>
<ul>
  <li>Existe un desbalance tanto en la cantidad de tiles por dataset como en el n√∫mero de anotaciones por tipo anat√≥mico.</li>
  <li>Podr√≠a ser necesario realizar t√©cnicas de balanceo (submuestreo o sobremuestreo) antes de modelar.</li>
  <li>El amplio rango de posiciones <code>i</code> y <code>j</code> sugiere que hay tiles provenientes de distintas zonas anat√≥micas.</li>
</ul>
</div> </div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cobertura promedio de m√°scara por tile&#39;</span><span class="p">)</span>
<span class="n">df_anot_agr</span><span class="p">[[</span><span class="s1">&#39;blood_vessel&#39;</span><span class="p">,</span> <span class="s1">&#39;glomerulus&#39;</span><span class="p">,</span> <span class="s1">&#39;unsure&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="mi">512</span> <span class="o">*</span> <span class="mi">512</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cobertura promedio de m√°scara por tile
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>type
blood_vessel    0.043463
glomerulus      0.045918
unsure          0.004662
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sin_mask</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">meta_tiles</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">df_anot</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Tiles sin m√°scara&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sin_mask</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tiles sin m√°scara 5400
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_anot_agr</span><span class="p">[</span><span class="s1">&#39;ratio_bv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_anot_agr</span><span class="p">[</span><span class="s1">&#39;blood_vessel&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">512</span> <span class="o">*</span> <span class="mi">512</span><span class="p">)</span>
<span class="n">an_bajas</span> <span class="o">=</span> <span class="n">df_anot_agr</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;ratio_bv &lt; 0.0005 and ratio_bv &gt; 0&#39;</span><span class="p">)</span>
<span class="n">an_altas</span> <span class="o">=</span> <span class="n">df_anot_agr</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;ratio_bv &gt; 0.9&#39;</span><span class="p">)</span>

<span class="n">df_anot_agr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>type</th>
      <th>id</th>
      <th>blood_vessel</th>
      <th>glomerulus</th>
      <th>unsure</th>
      <th>ratio_bv</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0006ff2aa7cd</td>
      <td>10051.0</td>
      <td>55942.5</td>
      <td>0.0</td>
      <td>0.038342</td>
    </tr>
    <tr>
      <th>1</th>
      <td>00168d1b7522</td>
      <td>1557.5</td>
      <td>20416.0</td>
      <td>0.0</td>
      <td>0.005941</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0033bbc76b6b</td>
      <td>2891.0</td>
      <td>0.0</td>
      <td>2619.0</td>
      <td>0.011028</td>
    </tr>
    <tr>
      <th>3</th>
      <td>003504460b3a</td>
      <td>1969.5</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.007513</td>
    </tr>
    <tr>
      <th>4</th>
      <td>004daf1cbe75</td>
      <td>4886.5</td>
      <td>37870.5</td>
      <td>0.0</td>
      <td>0.018641</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1628</th>
      <td>ff434af74304</td>
      <td>5495.5</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.020964</td>
    </tr>
    <tr>
      <th>1629</th>
      <td>ff4897b3eda6</td>
      <td>7093.5</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.027060</td>
    </tr>
    <tr>
      <th>1630</th>
      <td>ff66dec71c4c</td>
      <td>21842.0</td>
      <td>2035.0</td>
      <td>0.0</td>
      <td>0.083321</td>
    </tr>
    <tr>
      <th>1631</th>
      <td>ff99cdef0f2a</td>
      <td>3630.5</td>
      <td>3017.5</td>
      <td>0.0</td>
      <td>0.013849</td>
    </tr>
    <tr>
      <th>1632</th>
      <td>ffd3d193c71e</td>
      <td>3165.5</td>
      <td>141444.0</td>
      <td>0.0</td>
      <td>0.012075</td>
    </tr>
  </tbody>
</table>
<p>1633 rows √ó 5 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">an_bajas</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>type</th>
      <th>id</th>
      <th>blood_vessel</th>
      <th>glomerulus</th>
      <th>unsure</th>
      <th>ratio_bv</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1139</th>
      <td>b3ee5e7bcf74</td>
      <td>85.5</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000326</td>
    </tr>
    <tr>
      <th>1232</th>
      <td>c35d853b0cd2</td>
      <td>93.5</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000357</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">an_altas</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>type</th>
      <th>id</th>
      <th>blood_vessel</th>
      <th>glomerulus</th>
      <th>unsure</th>
      <th>ratio_bv</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Posibles anomal√≠as baja cobertura&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">an_bajas</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Posibles anomal√≠as alta cobertura&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">an_altas</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Posibles anomal√≠as baja cobertura 2
Posibles anomal√≠as alta cobertura 0
</pre></div>
</div>
</div>
</div>
<div style="border-left: 6px solid #2ecc71; border-radius: 6px; overflow: hidden;"> <div style="background-color: #d4f8e8; padding: 8px 12px;"> <strong>üí° An√°lisis</strong> </div> <div style="background-color: #f5fdf9; padding: 12px;"> El conjunto <code>meta_tiles</code> contiene un total de 7,033 tiles derivados de 13 WSIs. La mayor√≠a de los tiles pertenecen al dataset 3 (5,400), seguido por el 2 (1,211) y el 1 (422). Las coordenadas espaciales (<code>i</code>, <code>j</code>) muestran gran variabilidad, con valores m√°ximos de hasta 30,208 y 52,753 respectivamente, indicando diferencias en resoluci√≥n o tama√±o de las im√°genes originales. <br><br> La distribuci√≥n de anotaciones revela un fuerte desbalance: <code>blood_vessel</code> domina con 16,054 registros, mientras que <code>glomerulus</code> apenas cuenta con 567 y <code>unsure</code> con 897. La cobertura promedio de m√°scara por tile es baja: 4.3% para vasos, 4.6% para glom√©rulos y solo 0.46% para regiones inciertas. Esto sugiere que la mayor√≠a del contenido en los tiles no est√° segmentado. <br><br> Al cruzar los <code>id</code> de los tiles con las anotaciones, se identificaron 5,400 tiles (‚âà76%) sin ninguna m√°scara, lo que implica que podr√≠an usarse como negativos o ejemplos de fondo en entrenamientos supervisados. Por otro lado, se detectaron 2 posibles anomal√≠as de baja cobertura, con proporciones de <code>blood_vessel</code> menores al 0.05% del √°rea del tile (considerando un tile de 512x512). No se identificaron casos de cobertura excesiva (&gt; 90%), lo que sugiere buena calidad general en el etiquetado. </div> </div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cargar_imagen</span><span class="p">(</span><span class="n">tile_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;train/</span><span class="si">{</span><span class="n">tile_id</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">generar_mascara</span><span class="p">(</span><span class="n">lista_poligonos</span><span class="p">):</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">lista_poligonos</span><span class="p">:</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">fillPoly</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">[</span><span class="n">pts</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mask</span>

<span class="k">def</span> <span class="nf">mostrar_ejemplo</span><span class="p">(</span><span class="n">tile_id</span><span class="p">):</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cargar_imagen</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
    <span class="n">sub</span> <span class="o">=</span> <span class="n">df_anot</span><span class="p">[</span><span class="n">df_anot</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tile_id</span><span class="p">]</span>
    <span class="n">mask_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">fila</span> <span class="ow">in</span> <span class="n">sub</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">mask_total</span> <span class="o">|=</span> <span class="n">generar_mascara</span><span class="p">(</span><span class="n">fila</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">])</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Imagen </span><span class="si">{</span><span class="n">tile_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask_total</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;M√°scara&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
        <span class="n">a</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">muestras</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_anot_agr</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]),</span> <span class="nb">min</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">meta_tiles</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">tid</span> <span class="ow">in</span> <span class="n">muestras</span><span class="p">:</span>
    <span class="n">mostrar_ejemplo</span><span class="p">(</span><span class="n">tid</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2b6a09c6edaa59f555cd94a7033d11140de28bcf21e50771c842ceb8f9a8db1f.png" src="_images/2b6a09c6edaa59f555cd94a7033d11140de28bcf21e50771c842ceb8f9a8db1f.png" />
<img alt="_images/0dd4097b34f90d16d1d4e306bda0b5caba003c0b46efd4204d3048d4dc68b5be.png" src="_images/0dd4097b34f90d16d1d4e306bda0b5caba003c0b46efd4204d3048d4dc68b5be.png" />
<img alt="_images/120b2606f2b1aef51c75df4b24842290603be8fa93d05823596bd8c9f5b4ae94.png" src="_images/120b2606f2b1aef51c75df4b24842290603be8fa93d05823596bd8c9f5b4ae94.png" />
<img alt="_images/11252ca501ca168509354ad04301572b35aa37b9f5c5f2350687def33240d01d.png" src="_images/11252ca501ca168509354ad04301572b35aa37b9f5c5f2350687def33240d01d.png" />
<img alt="_images/699bde48b772782bd605366dde8a30da727e27646b050133933fed45357c1ea8.png" src="_images/699bde48b772782bd605366dde8a30da727e27646b050133933fed45357c1ea8.png" />
<img alt="_images/2c009b5d0babf27db3ea34f4191c9415eef358ed641248c16b7f0f066e3b80d3.png" src="_images/2c009b5d0babf27db3ea34f4191c9415eef358ed641248c16b7f0f066e3b80d3.png" />
<img alt="_images/93de2f0ecef018a0f2dc2692661849c17312bd4280f12c7f886c462439ca6aa9.png" src="_images/93de2f0ecef018a0f2dc2692661849c17312bd4280f12c7f886c462439ca6aa9.png" />
<img alt="_images/75a742c5e0ddf273598526b7afba3b5e986405573b11001a8213c669a8e0fbb9.png" src="_images/75a742c5e0ddf273598526b7afba3b5e986405573b11001a8213c669a8e0fbb9.png" />
<img alt="_images/e6080c578621c4c1aeb360a85d8c7996e5f658e114c958c0fe7f89726eca4075.png" src="_images/e6080c578621c4c1aeb360a85d8c7996e5f658e114c958c0fe7f89726eca4075.png" />
</div>
</div>
<div style="border-left: 6px solid #2ecc71; border-radius: 6px; overflow: hidden;"> <div style="background-color: #d4f8e8; padding: 8px 12px;"> <strong>üí° An√°lisis</strong> </div> <div style="background-color: #f5fdf9; padding: 12px;"> Se implementaron funciones para cargar im√°genes originales (<code>cargar_imagen</code>) y generar sus respectivas m√°scaras binarias a partir de anotaciones poligonales (<code>generar_mascara</code>). Posteriormente, la funci√≥n <code>mostrar_ejemplo</code> superpone las m√°scaras sobre las im√°genes correspondientes, permitiendo una evaluaci√≥n visual directa de la calidad del etiquetado. <br><br> Al observar los ejemplos aleatorios generados, se confirma que las regiones segmentadas (en rojo) se alinean adecuadamente con las estructuras visibles en las im√°genes histol√≥gicas, en su mayor√≠a correspondientes a vasos sangu√≠neos. La variedad de formas, tama√±os y orientaciones resalta la heterogeneidad del tejido, lo que representa un desaf√≠o relevante para modelos de segmentaci√≥n. <br><br> Esta visualizaci√≥n no solo valida la calidad de las anotaciones, sino que tambi√©n permite identificar ejemplos extremos (como tiles con muy poca o mucha segmentaci√≥n), facilitando la selecci√≥n de muestras para balanceo, validaci√≥n o an√°lisis m√°s detallado. Adem√°s, este procedimiento es esencial antes de entrenar modelos supervisados, ya que asegura que las m√°scaras se correspondan correctamente con las regiones anat√≥micas relevantes en las im√°genes originales. </div> </div></section>
<section id="parte-b">
<h2>Parte B<a class="headerlink" href="#parte-b" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">meta_tiles</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;tile_meta.csv&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;polygons.jsonl&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">anotaciones</span> <span class="o">=</span> <span class="p">{</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">l</span><span class="p">)[</span><span class="s2">&quot;id&quot;</span><span class="p">]:</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">l</span><span class="p">)[</span><span class="s2">&quot;annotations&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">f</span><span class="p">}</span>

<span class="n">ids_anotados</span> <span class="o">=</span> <span class="p">[</span><span class="n">tid</span> <span class="k">for</span> <span class="n">tid</span> <span class="ow">in</span> <span class="n">meta_tiles</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">if</span> <span class="n">tid</span> <span class="ow">in</span> <span class="n">anotaciones</span><span class="p">]</span>
<span class="n">kfold</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HuBMAP</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">aug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gris</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ids</span> <span class="o">=</span> <span class="n">ids</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">aug</span> <span class="o">=</span> <span class="n">aug</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">gris</span> <span class="o">=</span> <span class="n">gris</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tid</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">anotaciones</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">512</span><span class="p">,</span><span class="mi">512</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">512</span><span class="p">,</span><span class="mi">512</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">anotaciones</span><span class="p">[</span><span class="n">tid</span><span class="p">]:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">rr</span><span class="p">,</span> <span class="n">cc</span> <span class="o">=</span> <span class="n">polygon</span><span class="p">(</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;blood_vessel&quot;</span><span class="p">:</span>
                <span class="n">m</span><span class="p">[</span><span class="n">rr</span><span class="p">,</span> <span class="n">cc</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">a</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;glomerulus&quot;</span><span class="p">:</span>
                <span class="n">m</span><span class="p">[</span><span class="n">rr</span><span class="p">,</span> <span class="n">cc</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">m</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">tid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">img_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;train/</span><span class="si">{</span><span class="n">tid</span><span class="si">}</span><span class="s2">.tif&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">img_path</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>

            <span class="n">img</span> <span class="o">=</span> <span class="n">tiff</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>
            <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># img = np.repeat(img[..., None], 3, 2)</span>
                <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">gris</span><span class="p">:</span>                         <span class="c1"># convertir</span>
                <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">msk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span><span class="p">(</span><span class="n">tid</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aug</span> <span class="ow">and</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
                <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">msk</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="n">img</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span>
            <span class="n">msk</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">msk</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="n">msk</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Excepci√≥n en tile </span><span class="si">{</span><span class="n">tid</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>
</pre></div>
</div>
</div>
</div>
<div style="border-left: 6px solid #2ecc71; border-radius: 6px; overflow: hidden;"> <div style="background-color: #d4f8e8; padding: 8px 12px;"> <strong>üí° An√°lisis</strong> </div> <div style="background-color: #f5fdf9; padding: 12px;"> <ul> <li><strong>Lectura de datos:</strong></li> <ul> <li>Se carga el archivo <code>tile_meta.csv</code> en <code>meta_tiles</code>.</li> <li>Se carga el archivo <code>polygons.jsonl</code> para obtener las anotaciones de pol√≠gonos por tile.</li> <li>Se filtran los <code>ids</code> que tienen anotaciones v√°lidas en <code>ids_anotados</code>.</li> </ul>
php-template
Copiar
Editar
  <li><strong>Preparaci√≥n de validaci√≥n cruzada:</strong></li>
  <ul>
    <li>Se configura un <code>KFold</code> con 2 particiones, mezcla de datos (<code>shuffle=True</code>) y semilla fija (<code>random_state=0</code>) para asegurar reproducibilidad.</li>
  </ul>
  <li><strong>Definici√≥n de la clase <code>HuBMAP(Dataset)</code>:</strong></li>
  <ul>
    <li><strong>__init__:</strong> almacena los IDs, una bandera de augmentaci√≥n y otra para si la imagen debe ser en escala de grises.</li>
    <li><strong>__len__:</strong> retorna el n√∫mero de elementos (tiles) disponibles.</li>
    <li><strong>_mask:</strong> genera una m√°scara binaria de 512x512:
      <ul>
        <li>Si no hay anotaciones para el tile, crea una m√°scara de ceros.</li>
        <li>Si existen anotaciones:
          <ul>
            <li>Se usa la funci√≥n <code>polygon</code> para llenar los p√≠xeles dentro de cada pol√≠gono.</li>
            <li><code>blood_vessel</code> (vaso sangu√≠neo) ‚Üí valor 1.</li>
            <li><code>glomerulus</code> (glom√©rulo) ‚Üí valor 0 expl√≠cito (aunque en la inicializaci√≥n ya ser√≠a cero).</li>
          </ul>
        </li>
      </ul>
    </li>
    <li><strong>__getitem__:</strong> prepara un par (imagen, m√°scara) para entrenamiento:
      <ul>
        <li>Lee la imagen desde <code>train/{tid}.tif</code>.</li>
        <li>Normaliza el pixelado entre 0 y 1 dividiendo entre 255.</li>
        <li>Si la imagen es monocrom√°tica, le a√±ade un canal extra.</li>
        <li>Si <code>gris=True</code>, convierte la imagen a escala de grises promedio.</li>
        <li>Aplica una posible augmentaci√≥n de flipping horizontal aleatorio.</li>
        <li>Convierte imagen y m√°scara a tensores de <code>torch</code> listos para redes neuronales.</li>
      </ul>
    </li>
  </ul>
  <li><strong>Manejo de errores:</strong></li>
  <ul>
    <li>Si falla la carga de la imagen, imprime una advertencia indicando el ID problem√°tico antes de relanzar la excepci√≥n.</li>
  </ul>
</ul>
<p><strong>Observaciones clave:</strong></p>
<ul>
  <li>El dise√±o es robusto, maneja errores de archivos faltantes y prepara de forma adecuada los datos para entrenamiento.</li>
  <li>El tratamiento de im√°genes en escala de grises puede ser √∫til para redes ligeras o tareas donde el color no es relevante.</li>
  <li>La generaci√≥n de m√°scaras directamente en la carga del dato evita necesidad de almacenarlas f√≠sicamente, ahorrando almacenamiento.</li>
  <li>La augmentaci√≥n b√°sica (flip horizontal) podr√≠a ser ampliada posteriormente con m√°s t√©cnicas de aumento de datos.</li>
</ul>
</div> </div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dice_loss</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
    <span class="n">p</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">inter</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">();</span> <span class="k">return</span> <span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">inter</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="n">t</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">entrenar_modelo</span><span class="p">(</span><span class="n">modelo</span><span class="p">,</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">epocas</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">lote</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">gris</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">inicio</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">preds</span><span class="p">,</span> <span class="n">truth</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">vl</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kfold</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">ids_anotados</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fold </span><span class="si">{</span><span class="n">f</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">dl_tr</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">HuBMAP</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ids_anotados</span><span class="p">)[</span><span class="n">tr</span><span class="p">],</span> <span class="n">aug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gris</span><span class="o">=</span><span class="n">gris</span><span class="p">),</span>
                           <span class="n">batch_size</span><span class="o">=</span><span class="n">lote</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pin_memory</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop_last</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dl_vl</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">HuBMAP</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ids_anotados</span><span class="p">)[</span><span class="n">vl</span><span class="p">],</span> <span class="n">gris</span><span class="o">=</span><span class="n">gris</span><span class="p">),</span>
                           <span class="n">batch_size</span><span class="o">=</span><span class="n">lote</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pin_memory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">modelo</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">modelo</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="mf">1e-3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epocas</span><span class="p">):</span>
            <span class="n">modelo</span><span class="o">.</span><span class="n">train</span><span class="p">();</span> <span class="n">ltr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">dl_tr</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">y</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
                <span class="n">opt</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
                <span class="n">o</span> <span class="o">=</span> <span class="n">modelo</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">dice_loss</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="n">l</span><span class="o">.</span><span class="n">backward</span><span class="p">();</span> <span class="n">opt</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="n">ltr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;√âpoca </span><span class="si">{</span><span class="n">e</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> p√©rdida </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ltr</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">modelo</span><span class="o">.</span><span class="n">eval</span><span class="p">();</span> <span class="n">pl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">dl_vl</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
                <span class="n">o</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">modelo</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
                <span class="n">pl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">);</span> <span class="n">truth</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
        <span class="n">preds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">pl</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">();</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nombre</span><span class="si">}</span><span class="s2">_pred.npz&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                                     <span class="n">t</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">truth</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tiempo total </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">inicio</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div style="border-left: 6px solid #2ecc71; border-radius: 6px; overflow: hidden;"> <div style="background-color: #d4f8e8; padding: 8px 12px;"> <strong>üí° An√°lisis</strong> </div> <div style="background-color: #f5fdf9; padding: 12px;"> <ul> <li><strong>Definici√≥n de funci√≥n <code>dice_loss(p, t)</code>:</strong></li> <ul> <li>Calcula la funci√≥n de p√©rdida basada en el <strong>Dice coefficient</strong>, ideal para segmentaci√≥n donde interesa el solapamiento entre la predicci√≥n (<code>p</code>) y la verdad de terreno (<code>t</code>).</li> <li>Aplica una funci√≥n sigmoide a la salida del modelo antes de evaluar la p√©rdida.</li> </ul>
php-template
Copiar
Editar
  <li><strong>Definici√≥n de funci√≥n <code>entrenar_modelo</code>:</strong></li>
  <ul>
    <li>Realiza todo el ciclo de entrenamiento y validaci√≥n para un modelo de segmentaci√≥n de im√°genes.</li>
  </ul>
  <li><strong>Procedimiento:</strong></li>
  <ul>
    <li>Inicializa cron√≥metro (<code>inicio</code>) para medir el tiempo total de entrenamiento.</li>
    <li>Divide el conjunto anotado usando <code>KFold</code> para validaci√≥n cruzada.</li>
    <li>Por cada fold:</li>
    <ul>
      <li>Configura los <code>DataLoader</code> de entrenamiento (<code>dl_tr</code>) y validaci√≥n (<code>dl_vl</code>).</li>
      <li>Inicializa el optimizador Adam con tasa de aprendizaje 0.001.</li>
      <li>Por cada √©poca de entrenamiento:</li>
      <ul>
        <li>Para cada lote de entrenamiento:</li>
        <ul>
          <li>Se pasa la imagen y m√°scara a la GPU (<code>device</code>).</li>
          <li>Se calcula la predicci√≥n del modelo y la p√©rdida de Dice.</li>
          <li>Se realiza retropropagaci√≥n (<code>backward</code>) y optimizaci√≥n (<code>step</code>).</li>
          <li>Se guarda el valor de la p√©rdida por lote.</li>
        </ul>
        <li>Se imprime la p√©rdida promedio por √©poca.</li>
      </ul>
      <li>En modo evaluaci√≥n (<code>torch.no_grad()</code>), se obtienen las predicciones del modelo aplicando sigmoide y se almacenan.</li>
    </ul>
  </ul>
  <li><strong>Resultados:</strong></li>
  <ul>
    <li>Guarda las predicciones y verdades verdaderas (<code>p</code> y <code>t</code>) en un archivo <code>.npz</code> para an√°lisis posterior.</li>
    <li>Imprime el tiempo total de entrenamiento.</li>
  </ul>
  <li><strong>Detalles adicionales:</strong></li>
  <ul>
    <li>El par√°metro <code>gris</code> permite usar im√°genes convertidas a escala de grises si se desea.</li>
    <li>La estrategia <code>gc.collect()</code> y <code>torch.cuda.empty_cache()</code> al final de cada fold ayuda a liberar memoria GPU para evitar cuellos de botella.</li>
  </ul>
</ul>
<p><strong>Observaciones clave:</strong></p>
<ul>
  <li>El flujo de entrenamiento est√° correctamente organizado, ideal para entrenamiento r√°pido sobre un dataset relativamente peque√±o.</li>
  <li>El uso de validaci√≥n cruzada permite evaluar la robustez general del modelo.</li>
  <li>El m√©todo de guardar las predicciones reales y estimadas por fold es excelente para calcular m√©tricas despu√©s, como AUC, IoU, Dice global, etc.</li>
  <li>Podr√≠a ser mejorable agregar un scheduler de tasa de aprendizaje o EarlyStopping en ciclos de entrenamiento largos.</li>
</ul>
</div> </div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calcular_metricas</span><span class="p">(</span><span class="n">ruta</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ruta</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span>                      <span class="c1"># probabilidades (float32)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">]</span>                      <span class="c1"># ground‚Äëtruth (float32)</span>

    <span class="c1"># binarizamos</span>
    <span class="n">pb</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">gt</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="c1"># planos 1‚ÄëD para m√©tricas escalar‚Äëescalares</span>
    <span class="n">pb_flat</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">gt_flat</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">inter</span> <span class="o">=</span> <span class="p">(</span><span class="n">pb</span> <span class="o">&amp;</span> <span class="n">gt</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">union</span> <span class="o">=</span> <span class="p">(</span><span class="n">pb</span> <span class="o">|</span> <span class="n">gt</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="n">dice</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">inter</span> <span class="o">/</span> <span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">gt</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-7</span><span class="p">)</span>
    <span class="n">iou</span>  <span class="o">=</span> <span class="n">inter</span> <span class="o">/</span> <span class="p">(</span><span class="n">union</span> <span class="o">+</span> <span class="mf">1e-7</span><span class="p">)</span>
    <span class="n">prec</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">gt_flat</span><span class="p">,</span> <span class="n">pb_flat</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">rec</span>  <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">gt_flat</span><span class="p">,</span> <span class="n">pb_flat</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">auc</span>  <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">gt_flat</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># Hausdorff medio (ignora pares vac√≠os)</span>
    <span class="n">hds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pb</span><span class="p">)):</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">pb</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">gt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">sum</span><span class="p">():</span>
            <span class="n">hds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hd95</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="n">hd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">hds</span><span class="p">)</span> <span class="k">if</span> <span class="n">hds</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="n">bal</span> <span class="o">=</span> <span class="n">balanced_accuracy_score</span><span class="p">(</span><span class="n">gt_flat</span><span class="p">,</span> <span class="n">pb_flat</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dice</span><span class="p">,</span> <span class="n">iou</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">rec</span><span class="p">,</span> <span class="n">auc</span><span class="p">,</span> <span class="n">hd</span><span class="p">,</span> <span class="n">bal</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="o">=</span><span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<div style="border-left: 6px solid #2ecc71; border-radius: 6px; overflow: hidden;"> <div style="background-color: #d4f8e8; padding: 8px 12px;"> <strong>üí° An√°lisis</strong> </div> <div style="background-color: #f5fdf9; padding: 12px;"> <ul> <li><strong>Definici√≥n de funci√≥n <code>calcular_metricas(ruta)</code>:</strong></li> <ul> <li>Carga un archivo <code>.npz</code> que contiene predicciones (<code>p</code>) y etiquetas verdaderas (<code>t</code>).</li> <li>Binariza las predicciones aplicando un umbral de 0.5.</li> <li>Reestructura las matrices en vectores 1-D para facilitar el c√°lculo de m√©tricas.</li> </ul>
php-template
Copiar
Editar
  <li><strong>M√©tricas calculadas:</strong></li>
  <ul>
    <li><strong>Dice coefficient (dice):</strong> Mide la superposici√≥n entre predicciones y ground truth. Usado com√∫nmente en segmentaci√≥n.</li>
    <li><strong>IoU (Intersection over Union):</strong> Eval√∫a qu√© tanto se solapan las predicciones con las etiquetas verdaderas.</li>
    <li><strong>Precision:</strong> Proporci√≥n de verdaderos positivos sobre todos los positivos predichos.</li>
    <li><strong>Recall:</strong> Proporci√≥n de verdaderos positivos sobre todos los positivos reales.</li>
    <li><strong>AUC (Area Under ROC Curve):</strong> Mide la capacidad de separaci√≥n del modelo (usa las probabilidades crudas, no binarizadas).</li>
    <li><strong>Hausdorff Distance promedio (hd):</strong> Calcula la distancia m√°xima entre predicci√≥n y ground truth para cada imagen. Ignora casos vac√≠os.</li>
    <li><strong>Balanced Accuracy:</strong> Promedio del recall entre clases, √∫til para datasets desbalanceados.</li>
  </ul>
  <li><strong>Notas adicionales:</strong></li>
  <ul>
    <li>Se agrega una correcci√≥n m√≠nima (<code>+1e-7</code>) en divisiones para evitar divisiones por cero.</li>
    <li>La funci√≥n <code>hd95</code> que se invoca no est√° mostrada aqu√≠, pero t√≠picamente calcula la distancia de Hausdorff al percentil 95, robusta a outliers.</li>
    <li>El diccionario vac√≠o <code>resultados = {}</code> indica que despu√©s se ir√°n acumulando los resultados de m√∫ltiples evaluaciones.</li>
  </ul>
  <li><strong>Ventajas de este enfoque:</strong></li>
  <ul>
    <li>Permite evaluar el desempe√±o de los modelos en m√∫ltiples dimensiones (solapamiento, precisi√≥n, robustez espacial).</li>
    <li>Facilita la comparaci√≥n sistem√°tica entre diferentes modelos, folds, o versiones de entrenamiento.</li>
    <li>El manejo expl√≠cito de casos vac√≠os evita errores num√©ricos en m√©tricas espaciales como Hausdorff.</li>
  </ul>
</ul>
<p><strong>Observaciones clave:</strong></p>
<ul>
  <li>Esta funci√≥n es ideal para evaluar modelos de segmentaci√≥n binaria.</li>
  <li>El conjunto de m√©tricas est√° bien equilibrado entre medidas de superposici√≥n, clasificaci√≥n y distancia espacial.</li>
  <li>Un paso siguiente l√≥gico ser√≠a guardar estos resultados en un DataFrame para hacer reportes o visualizaciones de desempe√±o.</li>
</ul>
</div> </div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># unet = smp.Unet(&quot;resnet18&quot;, classes=1, encoder_weights=None, in_channels=3)</span>
<span class="c1"># entrenar_modelo(unet, &quot;unet&quot;)</span>
</pre></div>
</div>
</div>
</div>
<p>Fold 1</p>
<p>√âpoca 1 p√©rdida 0.7357</p>
<p>√âpoca 2 p√©rdida 0.5802</p>
<p>Fold 2</p>
<p>√âpoca 1 p√©rdida 0.5490</p>
<p>√âpoca 2 p√©rdida 0.5209</p>
<p>Tiempo total 2960.1s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resultados[&quot;U-Net&quot;]=calcular_metricas(&quot;unet_pred.npz&quot;)</span>
<span class="c1"># print(resultados[&quot;U-Net&quot;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="p">[</span><span class="s2">&quot;U-Net&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.3657676171209982</span><span class="p">,</span> <span class="mf">0.223816160390012</span><span class="p">,</span> <span class="mf">0.5818459552217784</span><span class="p">,</span> <span class="mf">0.2667175449525134</span><span class="p">,</span> <span class="mf">0.6976392639819838</span><span class="p">,</span> <span class="mf">214.9718765130667</span><span class="p">,</span> <span class="mf">0.6288454613023772</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># vnet = monai.networks.nets.VNet(</span>
<span class="c1">#     spatial_dims=2,    # 2‚ÄëD porque los tiles son 512√ó512</span>
<span class="c1">#     in_channels=1,</span>
<span class="c1">#     out_channels=1,</span>
<span class="c1">#     act=&quot;relu&quot;</span>
<span class="c1"># )</span>
<span class="c1"># entrenar_modelo(vnet,&quot;vnet&quot;)</span>
</pre></div>
</div>
</div>
</div>
<p>Fold 1</p>
<p>√âpoca 1 p√©rdida 0.9191</p>
<p>√âpoca 2 p√©rdida 0.9154</p>
<p>Fold 2</p>
<p>√âpoca 1 p√©rdida 0.9092</p>
<p>√âpoca 2 p√©rdida 0.9039</p>
<p>Tiempo total 5797.5s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resultados[&quot;V_Net&quot;]=calcular_metricas(&quot;vnet_pred.npz&quot;)</span>
<span class="c1"># print(resultados[&quot;V_Net&quot;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="p">[</span><span class="s2">&quot;V_Net&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.12536624099297586</span><span class="p">,</span> <span class="mf">0.06687505780296049</span><span class="p">,</span> <span class="mf">0.07091400658766504</span><span class="p">,</span> <span class="mf">0.5400525739978579</span><span class="p">,</span> <span class="mf">0.6305296480084055</span><span class="p">,</span> <span class="mf">206.19146433752485</span><span class="p">,</span> <span class="mf">0.6034261555389702</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># class SegNet(nn.Module):</span>
<span class="c1">#     def __init__(self):</span>
<span class="c1">#         super().__init__()</span>
<span class="c1">#         self.encoder=nn.Sequential(</span>
<span class="c1">#             nn.Conv2d(3,32,3,1,1),nn.BatchNorm2d(32),nn.ReLU(),nn.MaxPool2d(2),</span>
<span class="c1">#             nn.Conv2d(32,64,3,1,1),nn.BatchNorm2d(64),nn.ReLU(),nn.MaxPool2d(2))</span>
<span class="c1">#         self.decoder=nn.Sequential(</span>
<span class="c1">#             nn.ConvTranspose2d(64,32,2,2),nn.BatchNorm2d(32),nn.ReLU(),</span>
<span class="c1">#             nn.ConvTranspose2d(32,1,2,2))</span>
<span class="c1">#     def forward(self,x): return self.decoder(self.encoder(x))</span>

<span class="c1"># segnet=SegNet()</span>
<span class="c1"># entrenar_modelo(segnet,&quot;segnet&quot;)</span>
</pre></div>
</div>
</div>
</div>
<p>Fold 1</p>
<p>√âpoca 1 p√©rdida 0.8839</p>
<p>√âpoca 2 p√©rdida 0.8024</p>
<p>Fold 2</p>
<p>√âpoca 1 p√©rdida 0.7536</p>
<p>√âpoca 2 p√©rdida 0.7436</p>
<p>Tiempo total 973.7s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resultados[&quot;SegNet&quot;]=calcular_metricas(&quot;segnet_pred.npz&quot;)</span>
<span class="c1"># print(resultados[&quot;SegNet&quot;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="p">[</span><span class="s2">&quot;SegNet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.22675554542990525</span><span class="p">,</span> <span class="mf">0.12787607757379385</span><span class="p">,</span> <span class="mf">0.2369690363294747</span><span class="p">,</span> <span class="mf">0.21738608988773034</span><span class="p">,</span> <span class="mf">0.6405428333526553</span><span class="p">,</span> <span class="mf">179.0008254925285</span><span class="p">,</span> <span class="mf">0.5922115075397454</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># deeplab=smp.DeepLabV3Plus(&quot;resnet34&quot;,classes=1,encoder_weights=None,in_channels=3)</span>
<span class="c1"># entrenar_modelo(deeplab,&quot;deeplab&quot;)</span>
</pre></div>
</div>
</div>
</div>
<p>Fold 1</p>
<p>√âpoca 1 p√©rdida 0.7330</p>
<p>√âpoca 2 p√©rdida 0.5968</p>
<p>Fold 2</p>
<p>√âpoca 1 p√©rdida 0.5733</p>
<p>√âpoca 2 p√©rdida 0.5476</p>
<p>Tiempo total 3653.1s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resultados[&quot;DeepLabV3+&quot;]=calcular_metricas(&quot;deeplab_pred.npz&quot;)</span>
<span class="c1"># print(resultados[&quot;DeepLabV3+&quot;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="p">[</span><span class="s2">&quot;DeepLabV3+&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.14195539539967134</span><span class="p">,</span> <span class="mf">0.07640042389090353</span><span class="p">,</span> <span class="mf">0.08360187760641055</span><span class="p">,</span> <span class="mf">0.4700399423804192</span><span class="p">,</span> <span class="mf">0.6695391203753587</span><span class="p">,</span> <span class="mf">182.82947204832968</span><span class="p">,</span> <span class="mf">0.6137039010102096</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># att_unet=smp.Unet(&quot;resnet18&quot;,classes=1,encoder_weights=None,in_channels=3,decoder_attention_type=&quot;scse&quot;)</span>
<span class="c1"># entrenar_modelo(att_unet,&quot;attention_unet&quot;)</span>
</pre></div>
</div>
</div>
</div>
<p>Fold 1</p>
<p>√âpoca 1 p√©rdida 0.6994</p>
<p>√âpoca 2 p√©rdida 0.5708</p>
<p>Fold 2</p>
<p>√âpoca 1 p√©rdida 0.5381</p>
<p>√âpoca 2 p√©rdida 0.5229</p>
<p>Tiempo total 3646.5s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resultados[&quot;Attention U-Net&quot;]=calcular_metricas(&quot;attention_unet_pred.npz&quot;)</span>
<span class="c1"># print(resultados[&quot;Attention U-Net&quot;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="p">[</span><span class="s2">&quot;Attention U-Net&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.4190511078853865</span><span class="p">,</span> <span class="mf">0.26506303269859705</span><span class="p">,</span> <span class="mf">0.606627315675494</span><span class="p">,</span> <span class="mf">0.320078973709521</span><span class="p">,</span> <span class="mf">0.6933218467927132</span><span class="p">,</span> <span class="mf">169.42644471092657</span><span class="p">,</span> <span class="mf">0.6551523467114649</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div style="border-left: 6px solid #2ecc71; border-radius: 6px; overflow: hidden;"> <div style="background-color: #d4f8e8; padding: 8px 12px;"> <strong>üí° An√°lisis</strong> </div> <div style="background-color: #f5fdf9; padding: 12px;"> Se ha implementado un pipeline completo para entrenar y evaluar modelos de segmentaci√≥n de im√°genes m√©dicas sobre el conjunto HuBMAP. La clase <code>HuBMAP</code> act√∫a como <i>Dataset</i> personalizado, cargando tanto las im√°genes como sus respectivas m√°scaras desde disco. Se contemplan casos sin anotaciones, se genera la m√°scara correspondiente a cada tipo (vaso o glom√©rulo), y se aplica aumento por inversi√≥n horizontal condicionalmente. <br><br> El entrenamiento se realiza con validaci√≥n cruzada (<code>KFold</code>) sobre las im√°genes anotadas. Cada modelo es entrenado durante 2 √©pocas, usando la funci√≥n de p√©rdida <code>dice_loss</code>, adecuada para segmentaci√≥n binaria. Los resultados por fold se almacenan y eval√∫an usando un conjunto de m√©tricas: Dice, IoU, Precisi√≥n, Recall, AUC, Hausdorff y Precisi√≥n Balanceada. <br><br> Comparando el rendimiento de los modelos ya evaluados, se observa que <strong>Attention U-Net</strong> logr√≥ los mejores resultados globales con un Dice de <code>0.41</code> y AUC de <code>0.69</code>, seguido de cerca por <strong>U-Net</strong> tradicional. Por el contrario, modelos como <strong>V-Net</strong> y <strong>SegNet</strong> mostraron m√©tricas sustancialmente m√°s bajas, lo que sugiere menor capacidad de generalizaci√≥n o ajuste sub√≥ptimo a los datos. <br><br> El tiempo de entrenamiento vari√≥ significativamente entre modelos, con <code>U-Net</code> tardando casi 50 minutos, mientras que <code>SegNet</code> complet√≥ el proceso en poco m√°s de 16 minutos. Este factor debe considerarse al balancear rendimiento vs. eficiencia computacional. <br><br> Este flujo de trabajo permite extender f√°cilmente la comparaci√≥n a otros modelos (como Mask R-CNN, Swin U-Net o ResUNet) simplemente instanciando la arquitectura e invocando la funci√≥n <code>entrenar_modelo()</code>. Adem√°s, las m√©tricas calculadas son consistentes con las requeridas en el ejercicio (Dice, IoU, Recall, etc.), facilitando su incorporaci√≥n en una tabla comparativa. </div> </div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># from skimage.measure import label, regionprops</span>


<span class="c1"># def colar(batch):</span>
<span class="c1">#     imgs, tgts, gts = zip(*batch)</span>
<span class="c1">#     return list(imgs), list(tgts), list(gts)</span>


<span class="c1"># class HuBMAPMaskRCNN(Dataset):</span>
<span class="c1">#     def __init__(self, ids, aug=False):</span>
<span class="c1">#         self.base = HuBMAP(ids, aug=aug, gris=False)</span>

<span class="c1">#     def __len__(self): return len(self.base)</span>

<span class="c1">#     def __getitem__(self, idx):</span>
<span class="c1">#         img, sem = self.base[idx]            # sem = (1,512,512) uint8</span>
<span class="c1">#         m = sem.squeeze(0).numpy()</span>
<span class="c1">#         inst = label(m, connectivity=1)</span>
<span class="c1">#         props = regionprops(inst)</span>

<span class="c1">#         if len(props)==0:                    # tile sin vasos</span>
<span class="c1">#             target = {</span>
<span class="c1">#                 &quot;boxes&quot;:  torch.zeros((0,4), dtype=torch.float32),</span>
<span class="c1">#                 &quot;labels&quot;: torch.zeros((0,),  dtype=torch.int64),</span>
<span class="c1">#                 &quot;masks&quot;:  torch.zeros((0,512,512), dtype=torch.uint8),</span>
<span class="c1">#                 &quot;image_id&quot;: torch.tensor([idx]),</span>
<span class="c1">#                 &quot;area&quot;:    torch.zeros((0,),  dtype=torch.float32),</span>
<span class="c1">#                 &quot;iscrowd&quot;: torch.zeros((0,),  dtype=torch.int64),</span>
<span class="c1">#             }</span>
<span class="c1">#             return img, target, sem</span>

<span class="c1">#         boxes, masks = [], []</span>
<span class="c1">#         for p in props:</span>
<span class="c1">#             y1,x1,y2,x2 = p.bbox</span>
<span class="c1">#             boxes.append([x1,y1,x2,y2])</span>
<span class="c1">#             masks.append((inst==p.label).astype(np.uint8))</span>

<span class="c1">#         target = {</span>
<span class="c1">#             &quot;boxes&quot;:  torch.as_tensor(boxes, dtype=torch.float32),</span>
<span class="c1">#             &quot;labels&quot;: torch.ones((len(boxes),), dtype=torch.int64),</span>
<span class="c1">#             &quot;masks&quot;:  torch.as_tensor(masks, dtype=torch.uint8),</span>
<span class="c1">#             &quot;image_id&quot;: torch.tensor([idx]),</span>
<span class="c1">#             &quot;area&quot;:   torch.as_tensor([(b[2]-b[0])*(b[3]-b[1]) for b in boxes], dtype=torch.float32),</span>
<span class="c1">#             &quot;iscrowd&quot;:torch.zeros((len(boxes),), dtype=torch.int64),</span>
<span class="c1">#         }</span>
<span class="c1">#         return img, target, sem</span>


<span class="c1"># def entrenar_maskrcnn(modelo, nombre, epocas=2, lote=2):</span>
<span class="c1">#     inicio=time.time(); preds, truth = [], []</span>
<span class="c1">#     for f,(tr,vl) in enumerate(kfold.split(ids_anotados)):</span>
<span class="c1">#         print(f&quot;[Mask] Fold {f+1}&quot;)</span>
<span class="c1">#         dl_tr = DataLoader(</span>
<span class="c1">#             HuBMAPMaskRCNN(np.array(ids_anotados)[tr], aug=True),</span>
<span class="c1">#             batch_size=lote, shuffle=True, num_workers=0,</span>
<span class="c1">#             pin_memory=True, drop_last=True, collate_fn=colar</span>
<span class="c1">#         )</span>
<span class="c1">#         dl_vl = DataLoader(</span>
<span class="c1">#             HuBMAPMaskRCNN(np.array(ids_anotados)[vl]),</span>
<span class="c1">#             batch_size=1, shuffle=False, num_workers=0,</span>
<span class="c1">#             pin_memory=True, collate_fn=colar</span>
<span class="c1">#         )</span>

<span class="c1">#         modelo.to(device).train()</span>
<span class="c1">#         opt = optim.Adam(modelo.parameters(), 1e-4)</span>

<span class="c1">#         for e in range(epocas):</span>
<span class="c1">#             ltr=[]</span>
<span class="c1">#             for imgs, tgts, _ in dl_tr:</span>
<span class="c1">#                 imgs = [i.to(device) for i in imgs]</span>
<span class="c1">#                 tgts = [{k:(v.to(device) if torch.is_tensor(v) else v)</span>
<span class="c1">#                          for k,v in t.items()} for t in tgts]</span>
<span class="c1">#                 loss = sum(modelo(imgs, tgts).values())</span>
<span class="c1">#                 opt.zero_grad(); loss.backward(); opt.step()</span>
<span class="c1">#                 ltr.append(loss.item())</span>
<span class="c1">#             print(f&quot;  √âpoca {e+1} p√©rdida {np.mean(ltr):.4f}&quot;)</span>

<span class="c1">#         modelo.eval(); pl=[]</span>
<span class="c1">#         with torch.no_grad():</span>
<span class="c1">#             for imgs, _, gts in dl_vl:</span>
<span class="c1">#                 out = modelo([imgs[0].to(device)])[0]</span>
<span class="c1">#                 mpred = torch.zeros_like(gts[0][0])</span>
<span class="c1">#                 keep = out[&quot;scores&quot;] &gt; 0.3</span>
<span class="c1">#                 for m in out[&quot;masks&quot;][keep]:</span>
<span class="c1">#                     mpred = torch.maximum(mpred, (m[0]&gt;0.5).cpu().to(torch.uint8))</span>
<span class="c1">#                 pl.append(mpred.numpy()); truth.append(gts[0].numpy())</span>
<span class="c1">#         preds.append(np.stack(pl,0))</span>
<span class="c1">#         gc.collect(); torch.cuda.empty_cache()</span>

<span class="c1">#     np.savez(f&quot;{nombre}_pred.npz&quot;, p=np.concatenate(preds,0),</span>
<span class="c1">#                                  t=np.concatenate(truth,0))</span>
<span class="c1">#     print(f&quot;Tiempo total {time.time()-inicio:.1f}s&quot;)</span>



<span class="c1"># maskrcnn = maskrcnn_resnet50_fpn(weights=None, num_classes=2)</span>
<span class="c1"># entrenar_maskrcnn(maskrcnn, &quot;maskrcnn&quot;)</span>
</pre></div>
</div>
</div>
</div>
<p>√âpoca 1 p√©rdida 1.4263</p>
<p>√âpoca 2 p√©rdida 1.2548</p>
<p>[Mask] Fold 2</p>
<p>√âpoca 1 p√©rdida 1.1962</p>
<p>√âpoca 2 p√©rdida 1.1006</p>
<p>Tiempo total 21688.6s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resultados[&quot;Mask R-CNN&quot;]=calcular_metricas(&quot;maskrcnn_pred.npz&quot;)</span>
<span class="c1"># print(resultados[&quot;Mask R-CNN&quot;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="p">[</span><span class="s2">&quot;Mask R-CNN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.4700875588981105</span><span class="p">,</span> <span class="mf">0.30726435465779933</span><span class="p">,</span> <span class="mf">0.35290892473696067</span><span class="p">,</span> <span class="mf">0.7037623147102636</span><span class="p">,</span> <span class="mf">0.8214972106265819</span><span class="p">,</span> <span class="mf">141.30209424083768</span><span class="p">,</span> <span class="mf">0.8214972106265819</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resunet=smp.Unet(&quot;resnet18&quot;,classes=1,encoder_weights=None,in_channels=3)</span>
<span class="c1"># entrenar_modelo(resunet,&quot;resunet&quot;)</span>
</pre></div>
</div>
</div>
</div>
<p>Fold 1</p>
<p>√âpoca 1 p√©rdida 0.7333</p>
<p>√âpoca 2 p√©rdida 0.5781</p>
<p>Fold 2</p>
<p>√âpoca 1 p√©rdida 0.5626</p>
<p>√âpoca 2 p√©rdida 0.5336</p>
<p>Tiempo total 2984.7s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resultados[&quot;ResUNet&quot;]=calcular_metricas(&quot;resunet_pred.npz&quot;)</span>
<span class="c1"># print(resultados[&quot;ResUNet&quot;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="p">[</span><span class="s2">&quot;ResUNet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.21392137692719543</span><span class="p">,</span> <span class="mf">0.11977153422236302</span><span class="p">,</span> <span class="mf">0.5997590162502497</span><span class="p">,</span> <span class="mf">0.13017624791565846</span><span class="p">,</span> <span class="mf">0.5722688012534252</span><span class="p">,</span> <span class="mf">229.33932011038922</span><span class="p">,</span> <span class="mf">0.5630426595288168</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># psp=smp.PSPNet(&quot;mobilenet_v2&quot;,classes=1,encoder_weights=None,in_channels=3)</span>
<span class="c1"># entrenar_modelo(psp,&quot;pspnet&quot;)</span>
</pre></div>
</div>
</div>
</div>
<p>Fold 1</p>
<p>√âpoca 1 p√©rdida 0.6465</p>
<p>√âpoca 2 p√©rdida 0.5530</p>
<p>Fold 2</p>
<p>√âpoca 1 p√©rdida 0.5336</p>
<p>√âpoca 2 p√©rdida 0.5074</p>
<p>Tiempo total 993.4s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resultados[&quot;PSPNet&quot;]=calcular_metricas(&quot;pspnet_pred.npz&quot;)</span>
<span class="c1"># print(resultados[&quot;PSPNet&quot;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="p">[</span><span class="s2">&quot;PSPNet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.4400795696195428</span><span class="p">,</span> <span class="mf">0.28211667790786576</span><span class="p">,</span> <span class="mf">0.3947327118913157</span><span class="p">,</span> <span class="mf">0.4971975822547149</span><span class="p">,</span> <span class="mf">0.8499361504748153</span><span class="p">,</span> <span class="mf">175.85728472086944</span><span class="p">,</span> <span class="mf">0.7306477970888254</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fcn=smp.FPN(&quot;mobilenet_v2&quot;,classes=1,encoder_weights=None,in_channels=3)</span>
<span class="c1"># entrenar_modelo(fcn,&quot;fcn&quot;)</span>
</pre></div>
</div>
</div>
</div>
<p>Fold 1</p>
<p>√âpoca 1 p√©rdida 0.7297</p>
<p>√âpoca 2 p√©rdida 0.6134</p>
<p>Fold 2</p>
<p>√âpoca 1 p√©rdida 0.5754</p>
<p>√âpoca 2 p√©rdida 0.5436</p>
<p>Tiempo total 2075.8s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resultados[&quot;FCN&quot;]=calcular_metricas(&quot;fcn_pred.npz&quot;)</span>
<span class="c1"># print(resultados[&quot;FCN&quot;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="p">[</span><span class="s2">&quot;FCN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.4126242842557098</span><span class="p">,</span> <span class="mf">0.2599411595900837</span><span class="p">,</span> <span class="mf">0.5080749616815667</span><span class="p">,</span> <span class="mf">0.3473656359026521</span><span class="p">,</span> <span class="mf">0.7714862508142828</span><span class="p">,</span> <span class="mf">192.9422429572784</span><span class="p">,</span> <span class="mf">0.6657637622551611</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># from monai.networks.nets import SwinUNETR</span>

<span class="c1"># swin_unet = SwinUNETR(</span>
<span class="c1">#     img_size=(512,512),</span>
<span class="c1">#     in_channels=3,</span>
<span class="c1">#     out_channels=1,</span>
<span class="c1">#     spatial_dims=2,          # ‚Üê 2‚ÄëD tiles</span>
<span class="c1">#     feature_size=24          # modelo peque√±o y r√°pido</span>
<span class="c1"># )</span>

<span class="c1"># entrenar_modelo(swin_unet,&quot;swin_unet&quot;)</span>
</pre></div>
</div>
</div>
</div>
<p>Fold 1</p>
<p>√âpoca 1 p√©rdida 0.8214</p>
<p>√âpoca 2 p√©rdida 0.6322</p>
<p>Fold 2</p>
<p>√âpoca 1 p√©rdida 0.5621</p>
<p>√âpoca 2 p√©rdida 0.5310</p>
<p>Tiempo total 5929.9s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resultados[&quot;Swin U-Net&quot;]=calcular_metricas(&quot;swin_unet_pred.npz&quot;)</span>
<span class="c1"># print(resultados[&quot;Swin U-Net&quot;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span><span class="p">[</span><span class="s2">&quot;Swin U-Net&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.474761716926587</span><span class="p">,</span> <span class="mf">0.3112705222491033</span><span class="p">,</span> <span class="mf">0.4875930075492259</span><span class="p">,</span> <span class="mf">0.4625884359955025</span><span class="p">,</span> <span class="mf">0.7592380966148162</span><span class="p">,</span> <span class="mf">155.10278622208094</span><span class="p">,</span> <span class="mf">0.7198478485162607</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div style="border-left: 6px solid #2ecc71; border-radius: 6px; overflow: hidden;"> <div style="background-color: #d4f8e8; padding: 8px 12px;"> <strong>üí° An√°lisis</strong> </div> <div style="background-color: #f5fdf9; padding: 12px;"> En la segunda tanda de modelos evaluados se destaca el enfoque orientado a instancias de <strong>Mask R-CNN</strong>, que implementa detecci√≥n de objetos con generaci√≥n de bounding boxes, m√°scaras y etiquetas por regi√≥n. Aunque su rendimiento es robusto (Dice ‚âà 0.47, IoU ‚âà 0.30, Balanced Accuracy ‚âà 0.82), el tiempo de entrenamiento fue considerablemente alto (m√°s de 6 horas), lo que puede limitar su uso pr√°ctico en pipelines r√°pidos o recursos limitados. <br><br> Por otro lado, <strong>ResUNet</strong> y <strong>Swin U-Net</strong> ofrecieron un rendimiento m√°s equilibrado entre precisi√≥n y eficiencia. Swin U-Net se posiciona como uno de los modelos con mejores m√©tricas globales (Dice ‚âà 0.47, Hausdorff ‚âà 155), destacando por su dise√±o eficiente basado en transformers. <br><br> Modelos como <strong>PSPNet</strong> y <strong>FCN</strong> tambi√©n mostraron desempe√±os competitivos, con Dice cercanos a 0.44 y AUC superiores a 0.76, indicando buena capacidad para separar estructuras segmentadas. Aunque su precisi√≥n puede no ser la m√°s alta, se entrenan m√°s r√°pidamente y pueden ser √∫tiles como punto de partida o modelos base. <br><br> En resumen, Swin U-Net y Mask R-CNN lideran en m√©tricas generales, pero el primero destaca por su balance entre precisi√≥n, rapidez y estabilidad. La arquitectura FCN, al ser m√°s ligera, tambi√©n puede ser √∫til para tareas en tiempo real o entornos con restricciones computacionales. Todos los modelos evaluados siguen una estructura com√∫n, permitiendo su comparaci√≥n sistem√°tica a trav√©s de las m√©tricas clave exigidas en el taller. </div> </div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Dice&quot;</span><span class="p">,</span><span class="s2">&quot;IoU&quot;</span><span class="p">,</span><span class="s2">&quot;Precisi√≥n&quot;</span><span class="p">,</span><span class="s2">&quot;Recall&quot;</span><span class="p">,</span><span class="s2">&quot;AUC&quot;</span><span class="p">,</span><span class="s2">&quot;Hausdorff&quot;</span><span class="p">,</span><span class="s2">&quot;Balanced Acc.&quot;</span><span class="p">]</span>

<span class="n">tabla_resultados_modelos</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resultados</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">tabla_resultados_modelos</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Dice</th>
      <th>IoU</th>
      <th>Precisi√≥n</th>
      <th>Recall</th>
      <th>AUC</th>
      <th>Hausdorff</th>
      <th>Balanced Acc.</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>U-Net</th>
      <td>0.365768</td>
      <td>0.223816</td>
      <td>0.581846</td>
      <td>0.266718</td>
      <td>0.697639</td>
      <td>214.971877</td>
      <td>0.628845</td>
    </tr>
    <tr>
      <th>V_Net</th>
      <td>0.125366</td>
      <td>0.066875</td>
      <td>0.070914</td>
      <td>0.540053</td>
      <td>0.630530</td>
      <td>206.191464</td>
      <td>0.603426</td>
    </tr>
    <tr>
      <th>SegNet</th>
      <td>0.226756</td>
      <td>0.127876</td>
      <td>0.236969</td>
      <td>0.217386</td>
      <td>0.640543</td>
      <td>179.000825</td>
      <td>0.592212</td>
    </tr>
    <tr>
      <th>DeepLabV3+</th>
      <td>0.141955</td>
      <td>0.076400</td>
      <td>0.083602</td>
      <td>0.470040</td>
      <td>0.669539</td>
      <td>182.829472</td>
      <td>0.613704</td>
    </tr>
    <tr>
      <th>Attention U-Net</th>
      <td>0.419051</td>
      <td>0.265063</td>
      <td>0.606627</td>
      <td>0.320079</td>
      <td>0.693322</td>
      <td>169.426445</td>
      <td>0.655152</td>
    </tr>
    <tr>
      <th>Mask R-CNN</th>
      <td>0.470088</td>
      <td>0.307264</td>
      <td>0.352909</td>
      <td>0.703762</td>
      <td>0.821497</td>
      <td>141.302094</td>
      <td>0.821497</td>
    </tr>
    <tr>
      <th>ResUNet</th>
      <td>0.213921</td>
      <td>0.119772</td>
      <td>0.599759</td>
      <td>0.130176</td>
      <td>0.572269</td>
      <td>229.339320</td>
      <td>0.563043</td>
    </tr>
    <tr>
      <th>PSPNet</th>
      <td>0.440080</td>
      <td>0.282117</td>
      <td>0.394733</td>
      <td>0.497198</td>
      <td>0.849936</td>
      <td>175.857285</td>
      <td>0.730648</td>
    </tr>
    <tr>
      <th>FCN</th>
      <td>0.412624</td>
      <td>0.259941</td>
      <td>0.508075</td>
      <td>0.347366</td>
      <td>0.771486</td>
      <td>192.942243</td>
      <td>0.665764</td>
    </tr>
    <tr>
      <th>Swin U-Net</th>
      <td>0.474762</td>
      <td>0.311271</td>
      <td>0.487593</td>
      <td>0.462588</td>
      <td>0.759238</td>
      <td>155.102786</td>
      <td>0.719848</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">tabla_resultados_modelos</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>|                 |     Dice |       IoU |   Precisi√≥n |   Recall |      AUC |   Hausdorff |   Balanced Acc. |
|:----------------|---------:|----------:|------------:|---------:|---------:|------------:|----------------:|
| U-Net           | 0.365768 | 0.223816  |   0.581846  | 0.266718 | 0.697639 |     214.972 |        0.628845 |
| V_Net           | 0.125366 | 0.0668751 |   0.070914  | 0.540053 | 0.63053  |     206.191 |        0.603426 |
| SegNet          | 0.226756 | 0.127876  |   0.236969  | 0.217386 | 0.640543 |     179.001 |        0.592212 |
| DeepLabV3+      | 0.141955 | 0.0764004 |   0.0836019 | 0.47004  | 0.669539 |     182.829 |        0.613704 |
| Attention U-Net | 0.419051 | 0.265063  |   0.606627  | 0.320079 | 0.693322 |     169.426 |        0.655152 |
| Mask R-CNN      | 0.470088 | 0.307264  |   0.352909  | 0.703762 | 0.821497 |     141.302 |        0.821497 |
| ResUNet         | 0.213921 | 0.119772  |   0.599759  | 0.130176 | 0.572269 |     229.339 |        0.563043 |
| PSPNet          | 0.44008  | 0.282117  |   0.394733  | 0.497198 | 0.849936 |     175.857 |        0.730648 |
| FCN             | 0.412624 | 0.259941  |   0.508075  | 0.347366 | 0.771486 |     192.942 |        0.665764 |
| Swin U-Net      | 0.474762 | 0.311271  |   0.487593  | 0.462588 | 0.759238 |     155.103 |        0.719848 |
</pre></div>
</div>
</div>
</div>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p></p></th>
<th class="head text-right"><p>Dice</p></th>
<th class="head text-right"><p>IoU</p></th>
<th class="head text-right"><p>Precisi√≥n</p></th>
<th class="head text-right"><p>Recall</p></th>
<th class="head text-right"><p>AUC</p></th>
<th class="head text-right"><p>Hausdorff</p></th>
<th class="head text-right"><p>Balanced Acc.</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>U-Net</p></td>
<td class="text-right"><p>0.365768</p></td>
<td class="text-right"><p>0.223816</p></td>
<td class="text-right"><p>0.581846</p></td>
<td class="text-right"><p>0.266718</p></td>
<td class="text-right"><p>0.697639</p></td>
<td class="text-right"><p>214.972</p></td>
<td class="text-right"><p>0.628845</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>V_Net</p></td>
<td class="text-right"><p>0.125366</p></td>
<td class="text-right"><p>0.0668751</p></td>
<td class="text-right"><p>0.070914</p></td>
<td class="text-right"><p>0.540053</p></td>
<td class="text-right"><p>0.63053</p></td>
<td class="text-right"><p>206.191</p></td>
<td class="text-right"><p>0.603426</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>SegNet</p></td>
<td class="text-right"><p>0.226756</p></td>
<td class="text-right"><p>0.127876</p></td>
<td class="text-right"><p>0.236969</p></td>
<td class="text-right"><p>0.217386</p></td>
<td class="text-right"><p>0.640543</p></td>
<td class="text-right"><p>179.001</p></td>
<td class="text-right"><p>0.592212</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>DeepLabV3+</p></td>
<td class="text-right"><p>0.141955</p></td>
<td class="text-right"><p>0.0764004</p></td>
<td class="text-right"><p>0.0836019</p></td>
<td class="text-right"><p>0.47004</p></td>
<td class="text-right"><p>0.669539</p></td>
<td class="text-right"><p>182.829</p></td>
<td class="text-right"><p>0.613704</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Attention U-Net</p></td>
<td class="text-right"><p>0.419051</p></td>
<td class="text-right"><p>0.265063</p></td>
<td class="text-right"><p>0.606627</p></td>
<td class="text-right"><p>0.320079</p></td>
<td class="text-right"><p>0.693322</p></td>
<td class="text-right"><p>169.426</p></td>
<td class="text-right"><p>0.655152</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Mask R-CNN</p></td>
<td class="text-right"><p>0.470088</p></td>
<td class="text-right"><p>0.307264</p></td>
<td class="text-right"><p>0.352909</p></td>
<td class="text-right"><p>0.703762</p></td>
<td class="text-right"><p>0.821497</p></td>
<td class="text-right"><p>141.302</p></td>
<td class="text-right"><p>0.821497</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>ResUNet</p></td>
<td class="text-right"><p>0.213921</p></td>
<td class="text-right"><p>0.119772</p></td>
<td class="text-right"><p>0.599759</p></td>
<td class="text-right"><p>0.130176</p></td>
<td class="text-right"><p>0.572269</p></td>
<td class="text-right"><p>229.339</p></td>
<td class="text-right"><p>0.563043</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>PSPNet</p></td>
<td class="text-right"><p>0.44008</p></td>
<td class="text-right"><p>0.282117</p></td>
<td class="text-right"><p>0.394733</p></td>
<td class="text-right"><p>0.497198</p></td>
<td class="text-right"><p>0.849936</p></td>
<td class="text-right"><p>175.857</p></td>
<td class="text-right"><p>0.730648</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>FCN</p></td>
<td class="text-right"><p>0.412624</p></td>
<td class="text-right"><p>0.259941</p></td>
<td class="text-right"><p>0.508075</p></td>
<td class="text-right"><p>0.347366</p></td>
<td class="text-right"><p>0.771486</p></td>
<td class="text-right"><p>192.942</p></td>
<td class="text-right"><p>0.665764</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Swin U-Net</p></td>
<td class="text-right"><p>0.474762</p></td>
<td class="text-right"><p>0.311271</p></td>
<td class="text-right"><p>0.487593</p></td>
<td class="text-right"><p>0.462588</p></td>
<td class="text-right"><p>0.759238</p></td>
<td class="text-right"><p>155.103</p></td>
<td class="text-right"><p>0.719848</p></td>
</tr>
</tbody>
</table>
<div style="border-left: 6px solid #2ecc71; border-radius: 6px; overflow: hidden;"> <div style="background-color: #d4f8e8; padding: 8px 12px;"> <strong>üí° An√°lisis</strong> </div> <div style="background-color: #f5fdf9; padding: 12px;"> La tabla de resultados permite comparar el rendimiento de diez modelos de segmentaci√≥n m√©dica a partir de siete m√©tricas clave. El modelo <strong>Swin U-Net</strong> lidera el ranking general, con el mayor valor de <code>Dice</code> (0.47), buena precisi√≥n (<code>0.48</code>), <code>AUC</code> (0.76) y un bajo <code>Hausdorff</code> (155), lo cual indica segmentaciones precisas y estables. Le sigue <strong>Mask R-CNN</strong>, que destaca en <code>Recall</code> (0.70) y <code>Balanced Accuracy</code> (0.82), ideal para minimizar falsos negativos en contextos cl√≠nicos. <br><br> Por otro lado, <strong>Attention U-Net</strong> y <strong>FCN</strong> tambi√©n ofrecen un buen equilibrio entre precisi√≥n y cobertura, con valores competitivos de <code>IoU</code> y <code>Balanced Accuracy</code>. Modelos como <strong>V-Net</strong>, <strong>SegNet</strong> y <strong>DeepLabV3+</strong> se ubicaron en los rangos inferiores, con m√©tricas bajas de <code>Dice</code> e <code>IoU</code>, lo cual sugiere un desempe√±o limitado para este tipo de im√°genes histol√≥gicas. <br><br> En resumen, <strong>Swin U-Net</strong> se posiciona como el modelo m√°s robusto del conjunto evaluado, seguido de cerca por <strong>Mask R-CNN</strong> y <strong>PSPNet</strong>, dependiendo del balance deseado entre precisi√≥n, sensibilidad y tiempo de c√≥mputo. Esta tabla es fundamental para seleccionar el modelo final a desplegar en escenarios cl√≠nicos o investigaciones biom√©dicas. </div> </div><ul class="simple">
<li><p><strong>Dice Coefficient (Coeficiente de Dice)</strong></p></li>
</ul>
<p>F√≥rmula:</p>
<div class="math notranslate nohighlight">
\[
Dice = \frac{2 \cdot TP}{2 \cdot TP + FP + FN}
\]</div>
<p>Qu√© mide: Similitud entre el √°rea predicha y la verdadera.</p>
<p>Interpretaci√≥n:</p>
<p><code class="docutils literal notranslate"><span class="pre">0.0</span></code>: sin superposici√≥n</p>
<p><code class="docutils literal notranslate"><span class="pre">1.0</span></code>: superposici√≥n perfecta</p>
<ul class="simple">
<li><p><strong>IoU (Intersection over Union)</strong></p></li>
</ul>
<p>F√≥rmula:</p>
<div class="math notranslate nohighlight">
\[
IoU = \frac{TP}{TP + FP + FN}
\]</div>
<p>Tambi√©n conocido como: Jaccard Index.</p>
<p>Comparaci√≥n: Similar a Dice, pero m√°s estricto.</p>
<ul class="simple">
<li><p><strong>Precisi√≥n (Precision)</strong></p></li>
</ul>
<p>F√≥rmula:</p>
<div class="math notranslate nohighlight">
\[
Precision = \frac{TP}{TP + FP}
\]</div>
<p>Qu√© mide: De las regiones predichas como positivas, ¬øcu√°ntas lo eran realmente?</p>
<p>Alta precisi√≥n: pocos falsos positivos.</p>
<ul class="simple">
<li><p><strong>Recall (Sensibilidad o Exhaustividad)</strong></p></li>
</ul>
<p>F√≥rmula:</p>
<div class="math notranslate nohighlight">
\[
Recall = \frac{TP}{TP + FN}
\]</div>
<p>Qu√© mide: De los verdaderos vasos, ¬øcu√°ntos fueron detectados?</p>
<p>Alta sensibilidad: pocos falsos negativos.</p>
<ul class="simple">
<li><p><strong>AUC (√Årea Bajo la Curva ROC)</strong></p></li>
</ul>
<p>Qu√© mide: Capacidad del modelo para distinguir entre clases (vaso vs no vaso).</p>
<p>Valores t√≠picos:</p>
<p><code class="docutils literal notranslate"><span class="pre">0.5</span></code>: predicci√≥n aleatoria</p>
<p><code class="docutils literal notranslate"><span class="pre">1.0</span></code>: separaci√≥n perfecta</p>
<p>√ötil cuando el modelo entrega probabilidades.</p>
<ul class="simple">
<li><p><strong>Hausdorff Distance</strong></p></li>
</ul>
<p>Qu√© mide: Qu√© tan lejos est√°n los bordes predichos respecto a los reales.</p>
<p>Valor bajo = mejor.</p>
<p>Importante: en tareas m√©dicas donde los bordes son cl√≠nicamente relevantes.</p>
<ul class="simple">
<li><p><strong>Balanced Accuracy (Precisi√≥n Balanceada)</strong></p></li>
</ul>
<p>F√≥rmula:</p>
<div class="math notranslate nohighlight">
\[
\text{BAcc} = \frac{Recall_{class1} + Recall_{class0}}{2}
\]</div>
<p>Funcion: Manejar el desbalance de clases (por ejemplo, mucho fondo y pocos vasos).</p>
<ul class="simple">
<li><p>Interpretaci√≥n general</p></li>
</ul>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>M√©trica</p></th>
<th class="head"><p>Eval√∫a principalmente‚Ä¶</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Dice / IoU</p></td>
<td><p>Superposici√≥n entre predicci√≥n y verdad</p></td>
</tr>
<tr class="row-odd"><td><p>Precisi√≥n</p></td>
<td><p>Ausencia de falsos positivos</p></td>
</tr>
<tr class="row-even"><td><p>Recall</p></td>
<td><p>Ausencia de falsos negativos</p></td>
</tr>
<tr class="row-odd"><td><p>AUC</p></td>
<td><p>Separabilidad general entre clases</p></td>
</tr>
<tr class="row-even"><td><p>Hausdorff</p></td>
<td><p>Precisi√≥n en los bordes</p></td>
</tr>
<tr class="row-odd"><td><p>Balanced Acc.</p></td>
<td><p>Desempe√±o equilibrado en clases</p></td>
</tr>
</tbody>
</table>
<p>Entre los modelos evaluados, <code class="docutils literal notranslate"><span class="pre">Mask</span> <span class="pre">R-CNN</span></code> y <code class="docutils literal notranslate"><span class="pre">Swin</span> <span class="pre">U-Net</span></code> presentan los mejores desempe√±os globales. <code class="docutils literal notranslate"><span class="pre">Mask</span> <span class="pre">R-CNN</span></code> logra un equilibrio notable entre las m√©tricas, obteniendo la mayor puntuaci√≥n en Sensibilidad (0.70), la menor Distancia de Hausdorff (141.30) y la mayor Precisi√≥n Balanceada (0.82). <code class="docutils literal notranslate"><span class="pre">Swin</span> <span class="pre">U-Net</span></code>, por su parte, presenta el mayor Coeficiente Dice (0.47) y la mayor IoU (0.31), adem√°s de una precisi√≥n y sensibilidad competitivas. Esto indica que ambos modelos son capaces de segmentar con precisi√≥n y coherencia espacial los vasos sangu√≠neos, incluso en condiciones computacionales restringidas.</p>
<p>El modelo <code class="docutils literal notranslate"><span class="pre">PSPNet</span></code> tambi√©n se destaca, particularmente en el √°rea bajo la curva ROC (0.85) y una buena sensibilidad, lo que lo convierte en una opci√≥n viable cuando se busca maximizar la detecci√≥n sin importar tanto la precisi√≥n de las fronteras. Por otro lado, modelos como V-Net y DeepLabV3+ muestran desempe√±os significativamente inferiores en la mayor√≠a de m√©tricas. En estos casos, las puntuaciones bajas de Dice e IoU, combinadas con una precisi√≥n reducida, indican dificultades para adaptarse a la estructura del problema y a la escala de entrada de los tiles.</p>
<p><code class="docutils literal notranslate"><span class="pre">U-Net</span></code>, <code class="docutils literal notranslate"><span class="pre">Attention</span> <span class="pre">U-Net</span></code>, <code class="docutils literal notranslate"><span class="pre">FCN</span></code> y <code class="docutils literal notranslate"><span class="pre">SegNet</span></code> muestran desempe√±os intermedios, siendo opciones aceptables dependiendo del contexto espec√≠fico, aunque en t√©rminos generales fueron superados por las variantes m√°s recientes.</p>
<div style="border-left: 6px solid #2ecc71; border-radius: 6px; overflow: hidden;"> <div style="background-color: #d4f8e8; padding: 8px 12px;"> <strong>üí° An√°lisis</strong> </div> <div style="background-color: #f5fdf9; padding: 12px;"> Las m√©tricas presentadas permiten evaluar de forma integral el desempe√±o de los modelos de segmentaci√≥n aplicados sobre im√°genes histol√≥gicas. <strong>Dice</strong> e <strong>IoU</strong> miden la superposici√≥n entre las m√°scaras predichas y las reales, siendo <code>Dice</code> m√°s tolerante que <code>IoU</code>. <strong>Precisi√≥n</strong> y <strong>Recall</strong> abordan el tipo de error: la primera penaliza falsos positivos, y la segunda, falsos negativos. <strong>AUC</strong> eval√∫a la capacidad del modelo para discriminar entre clases (vaso vs no vaso), y es especialmente √∫til cuando se predicen probabilidades. <br><br> Por su parte, la <strong>Distancia de Hausdorff</strong> mide errores en los bordes, lo que es cl√≠nicamente relevante en anatom√≠a de estructuras. Finalmente, la <strong>Precisi√≥n Balanceada</strong> (<code>Balanced Accuracy</code>) resulta esencial en contextos con clases desbalanceadas, como ocurre cuando la mayor√≠a del tile corresponde a fondo. <br><br> En conjunto, estas m√©tricas proporcionan una visi√≥n detallada del comportamiento de los modelos. Por ejemplo, un modelo con alta precisi√≥n pero bajo recall puede estar siendo demasiado conservador, mientras que uno con alta recall pero baja precisi√≥n puede estar sobresegmentando. El an√°lisis conjunto permite seleccionar el modelo m√°s adecuado para el objetivo cl√≠nico o computacional espec√≠fico. </div> </div></section>
<section id="parte-c">
<h2>Parte C<a class="headerlink" href="#parte-c" title="Permalink to this heading">#</a></h2>
<section id="boxplots">
<h3>Boxplots<a class="headerlink" href="#boxplots" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Boxplot para Dice</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;Dice&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Boxplot - Dice&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Boxplot para IoU</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;IoU&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Boxplot - IoU&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Boxplot para Precisi√≥n</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;Precisi√≥n&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Boxplot - Precisi√≥n&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Boxplot para Recall</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;Recall&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Boxplot - Recall&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Boxplot para AUC</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;AUC&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Boxplot - AUC&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Boxplot para Hausdorff</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;Hausdorff&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Boxplot - Hausdorff&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Boxplot para Balanced Accuracy</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;Balanced Acc.&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Boxplot - Balanced Accuracy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/adce8b3464d192d939330e70c05c3f95cd14d468e97c7bd1efa38bf733c6fd3f.png" src="_images/adce8b3464d192d939330e70c05c3f95cd14d468e97c7bd1efa38bf733c6fd3f.png" />
<img alt="_images/86c8b9cdc2c1dab8d9aa0965bed3296f2dad12038dd3fc650c57662a7394a72b.png" src="_images/86c8b9cdc2c1dab8d9aa0965bed3296f2dad12038dd3fc650c57662a7394a72b.png" />
<img alt="_images/c059d5eba3ee5c021aa44d7c09caa8498e302e76e2c7318c42013e787018aed4.png" src="_images/c059d5eba3ee5c021aa44d7c09caa8498e302e76e2c7318c42013e787018aed4.png" />
<img alt="_images/5ebf54772a714b11a83eda9d7496663b55fd4e9bcfab13eb758cd4897a89245a.png" src="_images/5ebf54772a714b11a83eda9d7496663b55fd4e9bcfab13eb758cd4897a89245a.png" />
<img alt="_images/dad632798ab43c97d7fbbf07342d6f127c4dbebed8bc6f0f4f3e70f2fe6ace70.png" src="_images/dad632798ab43c97d7fbbf07342d6f127c4dbebed8bc6f0f4f3e70f2fe6ace70.png" />
<img alt="_images/1ed9118186a522fe6249a68eae5a3e97b54fd0c917f4398df1201bf3df87c712.png" src="_images/1ed9118186a522fe6249a68eae5a3e97b54fd0c917f4398df1201bf3df87c712.png" />
<img alt="_images/7a22f4f33b90b4e67b9bc72f8b3b44d5cbdff1170545685a9f8546e8e14bd2ea.png" src="_images/7a22f4f33b90b4e67b9bc72f8b3b44d5cbdff1170545685a9f8546e8e14bd2ea.png" />
</div>
</div>
<ol class="arabic simple">
<li><p>Coeficiente Dice</p></li>
</ol>
<p>El boxplot de Dice muestra una distribuci√≥n relativamente amplia con valores entre aproximadamente 0.12 y 0.47, y una mediana cercana a 0.39.
Esto indica que aunque algunos modelos logran segmentaciones relativamente precisas (por encima de 0.45), hay otros cuya capacidad de superposici√≥n entre predicci√≥n y verdad de terreno es bastante limitada. La dispersi√≥n sugiere diferencias marcadas en el rendimiento de los modelos.</p>
<ol class="arabic simple" start="2">
<li><p>IoU (Intersecci√≥n sobre la Uni√≥n)</p></li>
</ol>
<p>La distribuci√≥n de IoU sigue una tendencia similar a la del Dice, aunque con valores naturalmente m√°s bajos (dado que IoU es una m√©trica m√°s estricta).
El rango va desde aproximadamente 0.07 hasta 0.31, con una mediana cercana a 0.24.
El hecho de que existan valores tan bajos sugiere que algunos modelos est√°n teniendo dificultades para cubrir adecuadamente las regiones de inter√©s.</p>
<ol class="arabic simple" start="3">
<li><p>Precisi√≥n</p></li>
</ol>
<p>El boxplot de Precisi√≥n muestra una dispersi√≥n considerable, con valores que oscilan entre 0.07 y 0.61, y una mediana cercana a 0.45.
Esto indica que si bien algunos modelos son muy conservadores y predicen pocas regiones (generando alta precisi√≥n), otros pueden tener un mayor n√∫mero de falsos positivos. La variabilidad tambi√©n puede deberse a diferencias en las estrategias de regularizaci√≥n o umbral de predicci√≥n.</p>
<ol class="arabic simple" start="4">
<li><p>Recall (Sensibilidad)</p></li>
</ol>
<p>El Recall presenta un comportamiento opuesto al de la Precisi√≥n, con un rango de 0.13 a 0.70 y una mediana de aproximadamente 0.41.
Esto sugiere que mientras algunos modelos tienden a cubrir la mayor√≠a de las regiones relevantes (con mayor recall), lo hacen a expensas de una menor precisi√≥n. La dispersi√≥n alta tambi√©n indica un posible desbalance en el aprendizaje de los modelos frente a clases poco representadas.</p>
<ol class="arabic simple" start="5">
<li><p>AUC (√Årea bajo la curva ROC)</p></li>
</ol>
<p>La AUC muestra valores m√°s concentrados entre 0.57 y 0.85, con una mediana cercana a 0.70.
Esto indica un desempe√±o general aceptable en t√©rminos de discriminaci√≥n entre clases, aunque tambi√©n refleja que no todos los modelos manejan bien el trade-off entre sensibilidad y especificidad. Es una m√©trica m√°s global, menos influenciada por umbrales individuales.</p>
<ol class="arabic simple" start="6">
<li><p>Distancia de Hausdorff</p></li>
</ol>
<p>La m√©trica Hausdorff presenta una dispersi√≥n muy marcada, con valores entre 140 y 230 aproximadamente.
Al tratarse de una m√©trica sensible a errores puntuales en los bordes, los valores altos indican modelos que cometen errores m√°s severos en la localizaci√≥n o en la forma de las regiones segmentadas. La mediana parece rondar los 180, lo cual es alto en contextos m√©dicos, y sugiere margen importante de mejora en la fidelidad geom√©trica.</p>
<ol class="arabic simple" start="7">
<li><p>Precisi√≥n Balanceada</p></li>
</ol>
<p>La Precisi√≥n Balanceada, que considera tanto la sensibilidad como la especificidad, muestra una distribuci√≥n entre 0.56 y 0.82, con una mediana cercana a 0.65.
Esta m√©trica es particularmente √∫til en contextos con clases desbalanceadas como en segmentaci√≥n m√©dica. Su dispersi√≥n relativamente baja, en comparaci√≥n con otras m√©tricas, indica que la mayor√≠a de los modelos alcanzan un rendimiento razonablemente equilibrado entre las clases.</p>
<div style="border-left: 6px solid #2ecc71; border-radius: 6px; overflow: hidden;">
  <div style="background-color: #d4f8e8; padding: 8px 12px;">
    <strong>üí° An√°lisis</strong>
  </div>
  <div style="background-color: #f5fdf9; padding: 12px;">
    El an√°lisis de m√©tricas de evaluaci√≥n muestra una comparaci√≥n integral del desempe√±o de distintos modelos de segmentaci√≥n aplicados a im√°genes histol√≥gicas. Seg√∫n los resultados consolidados, los modelos <strong>Mask R-CNN</strong> y <strong>Swin U-Net</strong> se destacan con los valores m√°s altos en m√©tricas clave como <code>Dice</code>, <code>IoU</code>, <code>AUC</code> y <code>Balanced Accuracy</code>, reflejando una alta superposici√≥n con la verdad de terreno y un buen equilibrio entre clases. Por otro lado, modelos como <strong>V-Net</strong> y <strong>SegNet</strong> presentan desempe√±os inferiores, con menor precisi√≥n y valores de Dice e IoU significativamente m√°s bajos. <br><br> Al observar los <strong>boxplots</strong>, se nota una variabilidad moderada entre modelos, siendo <code>Precision</code> y <code>Recall</code> las m√©tricas con mayor dispersi√≥n, lo que sugiere diferencias importantes en la capacidad de los modelos para identificar correctamente regiones positivas (vasos). El <code>Hausdorff</code> muestra mayor variabilidad tambi√©n, indicando que algunos modelos presentan errores considerables en la localizaci√≥n de bordes. En contraste, m√©tricas como <code>AUC</code> y <code>Balanced Accuracy</code> presentan menor dispersi√≥n, reflejando mayor consistencia entre modelos.<br><br> En resumen, modelos basados en arquitecturas modernas como <strong>Swin U-Net</strong> y <strong>Mask R-CNN</strong> ofrecen ventajas notables para segmentaci√≥n precisa en este contexto, mientras que los modelos m√°s cl√°sicos tienden a ser menos efectivos, particularmente en presencia de clases desbalanceadas o estructuras peque√±as como vasos sangu√≠neos.
  </div>
</div>
</section>
<section id="histogramas">
<h3>Histogramas<a class="headerlink" href="#histogramas" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Histograma para Dice</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;Dice&quot;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histograma - Dice&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Dice&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Histograma para IoU</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;IoU&quot;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histograma - IoU&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;IoU&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Histograma para Precisi√≥n</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;Precisi√≥n&quot;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histograma - Precisi√≥n&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Precisi√≥n&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Histograma para Recall</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;Recall&quot;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histograma - Recall&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Recall&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Histograma para AUC</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;AUC&quot;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histograma - AUC&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;AUC&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Histograma para Hausdorff</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;Hausdorff&quot;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histograma - Hausdorff&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Hausdorff&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Histograma para Balanced Accuracy</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">tabla_resultados_modelos</span><span class="p">[</span><span class="s2">&quot;Balanced Acc.&quot;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histograma - Balanced Accuracy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Balanced Accuracy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/df535aec48c923638d5bb53f8b3aea78a45c364a847c2e53019ca0e4754deb40.png" src="_images/df535aec48c923638d5bb53f8b3aea78a45c364a847c2e53019ca0e4754deb40.png" />
<img alt="_images/25c20a3f41c9025dddea6e4087ba5739b803543952a22ee16f04ed87cad4dfe5.png" src="_images/25c20a3f41c9025dddea6e4087ba5739b803543952a22ee16f04ed87cad4dfe5.png" />
<img alt="_images/ea0b9e2a841ba8eec278bab8e15904340ae7fb1d60b60d9aad913a0abdf4259f.png" src="_images/ea0b9e2a841ba8eec278bab8e15904340ae7fb1d60b60d9aad913a0abdf4259f.png" />
<img alt="_images/188be23919cad4cbc3a0d1200ee9763139f8bd978b59bc62c5d5e32d8e55fa01.png" src="_images/188be23919cad4cbc3a0d1200ee9763139f8bd978b59bc62c5d5e32d8e55fa01.png" />
<img alt="_images/e946cbb9f39b2fab0c43fa71eaeb127c065ff74c3178e7f3651118f86861443b.png" src="_images/e946cbb9f39b2fab0c43fa71eaeb127c065ff74c3178e7f3651118f86861443b.png" />
<img alt="_images/f803b7696db04fcb952b5628439152a7f85321411ed55b48d85b82ccefd448ea.png" src="_images/f803b7696db04fcb952b5628439152a7f85321411ed55b48d85b82ccefd448ea.png" />
<img alt="_images/8e4c6ba469ad9240daf6c4d0d9f0d94ff6e14d620157539cc39ad42c354e0074.png" src="_images/8e4c6ba469ad9240daf6c4d0d9f0d94ff6e14d620157539cc39ad42c354e0074.png" />
</div>
</div>
<p><strong>An√°lisis de Distribuci√≥n</strong></p>
<ul class="simple">
<li><p>Dice e IoU: Presentan distribuciones bimodales con acumulaciones en los rangos m√°s bajos (por debajo de 0.25) y en valores altos (superiores a 0.40). Esto refuerza la idea de que algunos modelos tienen dificultades significativas, mientras otros alcanzan buenos desempe√±os.</p></li>
<li><p>Precisi√≥n: Muestra una distribuci√≥n sesgada a la derecha, con valores agrupados cerca de 0.6. Esto sugiere que varios modelos son conservadores al momento de predecir regiones, favoreciendo precisi√≥n sobre recall.</p></li>
<li><p>Recall: Tiene una distribuci√≥n m√°s uniforme, lo cual indica mayor diversidad en la capacidad de los modelos para identificar todos los p√≠xeles positivos. Algunos modelos presentan un comportamiento mucho m√°s sensible.</p></li>
<li><p>AUC: Su distribuci√≥n se centra entre 0.65 y 0.85, lo cual indica que los modelos, en promedio, logran un desempe√±o aceptable en cuanto a discriminaci√≥n entre clases.</p></li>
<li><p>Hausdorff: Tiene una distribuci√≥n relativamente sim√©trica, con una leve tendencia hacia valores m√°s altos. Esto sugiere que algunos modelos cometen errores notables en la ubicaci√≥n precisa de las fronteras.</p></li>
<li><p>Balanced Accuracy: La mayor√≠a de los modelos se agrupan entre 0.60 y 0.75, lo cual indica un comportamiento relativamente estable y equilibrado en cuanto a la predicci√≥n de ambas clases.</p></li>
</ul>
<div style="border-left: 6px solid #2ecc71; border-radius: 6px; overflow: hidden;">
  <div style="background-color: #d4f8e8; padding: 8px 12px;">
    <strong>üí° An√°lisis</strong>
  </div>
  <div style="background-color: #f5fdf9; padding: 12px;">
    Los histogramas permiten observar la distribuci√≥n de las m√©tricas entre los distintos modelos de segmentaci√≥n. <br><br>
    En particular, <strong>Dice</strong> e <strong>IoU</strong> muestran una distribuci√≥n sesgada hacia valores bajos, lo que sugiere que varios modelos a√∫n enfrentan dificultades para lograr una alta superposici√≥n con la verdad de terreno. Sin embargo, hay algunos picos notables cerca del 0.45 en Dice y del 0.30 en IoU, que corresponden a los modelos m√°s precisos.<br><br>
    <strong>Precision</strong> y <strong>Recall</strong> presentan mayor variabilidad, lo que indica que algunos modelos son buenos en detectar vasos pero a costa de cometer errores falsos positivos o negativos, dependiendo del enfoque. Por su parte, <strong>AUC</strong> tiene una distribuci√≥n m√°s sim√©trica con valores relativamente altos, sugiriendo que muchos modelos logran una buena discriminaci√≥n entre clases. <br><br>
    Finalmente, <strong>Hausdorff</strong> presenta una dispersi√≥n amplia, reflejando diferencias importantes en la calidad de los bordes segmentados. <strong>Balanced Accuracy</strong> mantiene una tendencia m√°s centrada, lo que confirma un desempe√±o m√°s equilibrado entre clases positivas y negativas.
  </div>
</div><div style="border-left: 6px solid #f1c40f; border-radius: 6px; overflow: hidden;">
  <div style="background-color: #fff9d6; padding: 8px 12px;">
    <strong>‚ö†Ô∏è Interpretaci√≥n de M√©tricas</strong>
  </div>
  <div style="background-color: #fffef0; padding: 12px;">
    El an√°lisis comparativo de los modelos revela diferencias sustanciales en el desempe√±o de las arquitecturas de segmentaci√≥n. 
    <strong>Mask R-CNN</strong> y <strong>Swin U-Net</strong> se destacan como los modelos con mejor rendimiento general. Ambos muestran altos valores de <code>Dice</code> (‚âà 0.47), <code>IoU</code> (> 0.30), y <code>Balanced Accuracy</code> (> 0.71), adem√°s de bajos valores de <code>Hausdorff</code>, lo que indica buena precisi√≥n espacial en la segmentaci√≥n.
    <br><br>
    El modelo <strong>PSPNet</strong> tambi√©n obtiene resultados competitivos, especialmente en <code>AUC</code> (0.8499), lo que sugiere una fuerte capacidad para discriminar entre clases, aunque con un leve descenso en <code>Dice</code> y <code>Recall</code>. 
    <br><br>
    Por otro lado, <strong>V-Net</strong> y <strong>SegNet</strong> obtienen los resultados m√°s bajos en m√©tricas clave como <code>Dice</code>, <code>IoU</code> y <code>Precisi√≥n</code>, evidenciando limitaciones en su capacidad de segmentaci√≥n en este conjunto de datos. 
    <br><br>
    <strong>Attention U-Net</strong> muestra un rendimiento s√≥lido y balanceado, con una precisi√≥n alta (0.6066) y una <code>Balanced Accuracy</code> de 0.6552, lo que lo convierte en una buena alternativa para tareas donde se requiera una segmentaci√≥n equilibrada.
    <br><br>
    En conclusi√≥n, modelos modernos como <strong>Mask R-CNN</strong>, <strong>Swin U-Net</strong> y <strong>PSPNet</strong> sobresalen por su combinaci√≥n de precisi√≥n y consistencia, lo que los hace m√°s adecuados para aplicaciones cl√≠nicas o investigaciones con necesidad de segmentaci√≥n fiable.
  </div>
</div>
</section>
<section id="comparacion-visual-de-imagenes">
<h3>Comparacion Visual de Imagenes<a class="headerlink" href="#comparacion-visual-de-imagenes" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;unet_pred.npz&quot;</span><span class="p">)</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span>       <span class="c1"># probabilidades (float32)</span>
<span class="n">truth</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">]</span>       <span class="c1"># ground-truth</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">tifffile</span> <span class="k">as</span> <span class="nn">tiff</span>

<span class="k">def</span> <span class="nf">mostrar_comparacion</span><span class="p">(</span><span class="n">tid</span><span class="p">,</span> <span class="n">img_folder</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">ruta_npz</span><span class="o">=</span><span class="s2">&quot;unet_pred.npz&quot;</span><span class="p">,</span> <span class="n">indice</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="c1"># Cargar imagen original</span>
    <span class="n">img_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">img_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tid</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">tiff</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>

    <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">img</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># convertir a RGB</span>

    <span class="c1"># Ground Truth</span>
    <span class="n">gt</span> <span class="o">=</span> <span class="n">HuBMAP</span><span class="p">([])</span><span class="o">.</span><span class="n">_mask</span><span class="p">(</span><span class="n">tid</span><span class="p">)</span>

    <span class="c1"># Cargar predicci√≥n del modelo</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ruta_npz</span><span class="p">)</span>
    <span class="n">pred_prob</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">][</span><span class="n">indice</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>   <span class="c1"># [512,512]</span>
    <span class="n">pred_bin</span> <span class="o">=</span> <span class="p">(</span><span class="n">pred_prob</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Imagen Original&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gt</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Ground Truth&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pred_bin</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Predicci√≥n (Binarizada)&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">mostrar_comparacion</span><span class="p">(</span><span class="s2">&quot;0006ff2aa7cd&quot;</span><span class="p">,</span> <span class="n">ruta_npz</span><span class="o">=</span><span class="s2">&quot;swin_unet_pred.npz&quot;</span><span class="p">,</span> <span class="n">indice</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9df04b9c79bd4742b73caa9aab505c731457c801660a8f14f8b41cff908951be.png" src="_images/9df04b9c79bd4742b73caa9aab505c731457c801660a8f14f8b41cff908951be.png" />
</div>
</div>
<div style="border-left: 6px solid #2ecc71; border-radius: 6px; overflow: hidden;">
  <div style="background-color: #d4f8e8; padding: 8px 12px;">
    <strong>üí° An√°lisis</strong>
  </div>
  <div style="background-color: #f5fdf9; padding: 12px;">
    <strong>üèÜ Rendimiento Destacado<strong><br><br>
    <strong>Mask R-CNN<strong> y <strong>Swin U-Net<strong> se destacan con los mejores puntajes globales:<br><br>
<ul class="simple">
<li><p><strong>Mask R-CNN<strong> obtiene los valores m√°s altos en <code class="docutils literal notranslate"><span class="pre">Recall</span></code> (0.7038), <code class="docutils literal notranslate"><span class="pre">IoU</span></code> (0.3073), <code class="docutils literal notranslate"><span class="pre">AUC</span></code> (0.8215) y <code class="docutils literal notranslate"><span class="pre">Balanced</span> <span class="pre">Accuracy</span></code> (0.8215), mostrando un excelente desempe√±o en detecci√≥n de vasos y discriminaci√≥n entre clases.</p></li>
<li><p><strong>Swin U-Net<strong> alcanza el mejor <code class="docutils literal notranslate"><span class="pre">Dice</span></code> (0.4748), un alto <code class="docutils literal notranslate"><span class="pre">AUC</span></code> (0.7592) y <code class="docutils literal notranslate"><span class="pre">Balanced</span> <span class="pre">Accuracy</span></code> (0.7198), combinando precisi√≥n y robustez.</p></li>
</ul>
<hr class="docutils" />
<p><strong>‚ö†Ô∏è Modelos con Bajo Rendimiento<strong><br><br></p>
<p><strong>V-Net<strong>, <strong>SegNet<strong> y <strong>DeepLabV3+<strong> muestran m√©tricas significativamente m√°s bajas en <code class="docutils literal notranslate"><span class="pre">Dice</span></code>, <code class="docutils literal notranslate"><span class="pre">IoU</span></code> y <code class="docutils literal notranslate"><span class="pre">Precisi√≥n</span></code>, indicando limitaciones en la segmentaci√≥n exacta de vasos.</p>
<hr class="docutils" />
<p><strong>üìä M√©tricas Relevantes<strong><br><br></p>
<ul class="simple">
<li><p><strong>PSPNet<strong> obtiene el mayor <code class="docutils literal notranslate"><span class="pre">AUC</span></code> (0.8499), sugiriendo alta capacidad para distinguir entre clases.</p></li>
<li><p><strong>Attention U-Net<strong> y <strong>FCN<strong> muestran buen equilibrio general, con valores s√≥lidos en casi todas las m√©tricas.</p></li>
<li><p>El <code class="docutils literal notranslate"><span class="pre">Hausdorff</span></code> m√°s bajo lo tiene <strong>Mask R-CNN<strong> (141.30), indicando precisi√≥n en la localizaci√≥n de bordes.</p></li>
<li><p><strong>ResUNet<strong>, pese a una buena <code class="docutils literal notranslate"><span class="pre">Precisi√≥n</span></code> (0.5998), presenta bajo <code class="docutils literal notranslate"><span class="pre">Recall</span></code> (0.1302), lo cual puede ser cr√≠tico en contextos donde se requiere alta sensibilidad.<br><br></p></li>
</ul>
<hr class="docutils" />
<p>En conjunto, los modelos basados en arquitecturas modernas como strong&gt;Mask R-CNNstrong&gt;, strong&gt;Swin U-Netstrong&gt; y strong&gt;PSPNetstrong&gt; presentan ventajas competitivas sobre arquitecturas m√°s tradicionales, demostrando ser mejores candidatos para aplicaciones cl√≠nicas exigentes.</p>
  </div>
</div></section>
<section id="curvas-roc-y-precision-recall">
<h3>Curvas ROC y Precision-Recall<a class="headerlink" href="#curvas-roc-y-precision-recall" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Curva ROC (Receiver Operating Characteristic): mide la capacidad del modelo para distinguir entre clases. Un AUC cercano a 1 indica un modelo muy discriminativo, mientras que un valor cercano a 0.5 indica un comportamiento aleatorio.</p></li>
<li><p>Curva Precision-Recall: eval√∫a el balance entre precisi√≥n y sensibilidad, especialmente √∫til cuando las clases est√°n desbalanceadas (como en segmentaci√≥n m√©dica). Una buena curva PR se caracteriza por una √°rea grande, especialmente cuando la clase positiva es escasa.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_curve</span><span class="p">,</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="n">ruta_npz</span><span class="p">,</span> <span class="n">nombre_modelo</span><span class="o">=</span><span class="s2">&quot;Modelo&quot;</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ruta_npz</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># predicciones como probabilidades (float)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># ground truth binarizado</span>

    <span class="c1"># ROC Curve</span>
    <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">roc_auc</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>

    <span class="c1"># Precision-Recall Curve</span>
    <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">pr_auc</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>

    <span class="c1"># Graficar</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="c1"># Curva ROC</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;AUC = </span><span class="si">{</span><span class="n">roc_auc</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;k--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Aleatorio&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Curva ROC - </span><span class="si">{</span><span class="n">nombre_modelo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;FPR&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;TPR&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># Curva PR</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;AUC = </span><span class="si">{</span><span class="n">pr_auc</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Curva Precision-Recall - </span><span class="si">{</span><span class="n">nombre_modelo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Recall&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Precision&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="s2">&quot;unet_pred.npz&quot;</span><span class="p">,</span> <span class="s2">&quot;U-Net&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c24e33b1ecbaf447a78cb9f90287b24a85459db0117052af787cbbb6640abf21.png" src="_images/c24e33b1ecbaf447a78cb9f90287b24a85459db0117052af787cbbb6640abf21.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="s2">&quot;vnet_pred.npz&quot;</span><span class="p">,</span> <span class="s2">&quot;V-Net&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e76f525551ff0873ec0720d49417f86aef22a1cba0649f57ddaf2f91adc70614.png" src="_images/e76f525551ff0873ec0720d49417f86aef22a1cba0649f57ddaf2f91adc70614.png" />
</div>
</div>
<div style="border-left: 6px solid #2ecc71; border-radius: 6px; overflow: hidden;">
  <div style="background-color: #d4f8e8; padding: 8px 12px;">
    <strong>üìâ Evaluaci√≥n de Curvas ROC y Precision-Recall</strong>
  </div>
  <div style="background-color: #f5fdf9; padding: 12px;">
    Las curvas ROC y Precision-Recall muestran diferencias claras en la capacidad discriminativa de los modelos evaluados:<br><br>
  <ul>
      <li>
        <strong>U-Net</strong> logra un AUC-ROC de <code>0.698</code>, indicando una capacidad moderada para distinguir vasos de fondo. Sin embargo, el AUC de la curva Precision-Recall es solo <code>0.297</code>, lo cual refleja una ca√≠da considerable en entornos desbalanceados. Esto sugiere que el modelo puede identificar vasos, pero con bajo nivel de precisi√≥n cuando estos son poco frecuentes.
      </li>
      <li>
        <strong>V-Net</strong> presenta un AUC-ROC m√°s bajo, de <code>0.631</code>, y un rendimiento a√∫n menor en la curva Precision-Recall con un AUC de apenas <code>0.134</code>. Esto revela una pobre sensibilidad frente a clases positivas, lo cual lo posiciona como un modelo menos confiable en contextos m√©dicos donde es crucial detectar estructuras peque√±as como vasos.
      </li>
  </ul>
<p>En conjunto, los resultados sugieren que <strong>U-Net</strong> es superior a <strong>V-Net</strong> en tareas de segmentaci√≥n de vasos, aunque a√∫n existen limitaciones significativas en t√©rminos de precisi√≥n cuando se eval√∫a con clases desbalanceadas. Para mejorar estos resultados, podr√≠an explorarse t√©cnicas de reponderaci√≥n de clases o modelos m√°s sofisticados con atenci√≥n o aprendizaje focalizado.</p>
  </div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="s2">&quot;segnet_pred.npz&quot;</span><span class="p">,</span> <span class="s2">&quot;SegNet&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Pumacens\AppData\Local\Temp\ipykernel_21124\1317268308.py:38: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  plt.tight_layout()
C:\Users\Pumacens\AppData\Roaming\Python\Python312\site-packages\IPython\core\pylabtools.py:170: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/2b5872ab18644598cf72dd92fad4217f8f52013078fbc74899d1f65410d03779.png" src="_images/2b5872ab18644598cf72dd92fad4217f8f52013078fbc74899d1f65410d03779.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="s2">&quot;deeplab_pred.npz&quot;</span><span class="p">,</span> <span class="s2">&quot;DeepLabV3+&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Pumacens\AppData\Local\Temp\ipykernel_21124\1317268308.py:38: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  plt.tight_layout()
C:\Users\Pumacens\AppData\Roaming\Python\Python312\site-packages\IPython\core\pylabtools.py:170: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/ff3384c157cf4b50855c6a1328fb0bf539756717027d3b68c8f123073941ed34.png" src="_images/ff3384c157cf4b50855c6a1328fb0bf539756717027d3b68c8f123073941ed34.png" />
</div>
</div>
<div style="border-left: 6px solid #2ecc71; border-radius: 6px; overflow: hidden;">
  <div style="background-color: #d4f8e8; padding: 8px 12px;">
    <strong>üí° An√°lisis</strong>
  </div>
  <div style="background-color: #f5fdf9; padding: 12px;">
<p><strong>üîç SegNet</strong><br><br>
El modelo <strong>SegNet</strong> muestra un AUC-ROC de <code>0.641</code>, lo que indica una capacidad limitada pero aceptable para discriminar entre clases. Sin embargo, su rendimiento en la curva Precision-Recall es bajo (<code>AUC = 0.182</code>), lo cual revela debilidades importantes al enfrentar clases desbalanceadas. En especial, tiene dificultades en mantener una precisi√≥n adecuada a medida que aumenta el recall, lo que puede implicar muchos falsos positivos en contextos cl√≠nicos.<br><br></p>
<p><strong>üîç DeepLabV3+</strong><br><br>
El modelo <strong>DeepLabV3+</strong> obtiene un AUC-ROC ligeramente mejor que SegNet (<code>0.670</code>), pero su curva Precision-Recall tambi√©n es d√©bil (<code>AUC = 0.206</code>). Aunque su curva ROC indica un desempe√±o aceptable en la clasificaci√≥n general, la baja precisi√≥n en condiciones de recall alto puede limitar su utilidad pr√°ctica en tareas donde la detecci√≥n completa de vasos es cr√≠tica. <br><br></p>
<p>En conjunto, ambos modelos tienen limitaciones claras en entornos con clases desbalanceadas. Aunque DeepLabV3+ presenta una ligera ventaja sobre SegNet en la m√©trica ROC, ninguno de los dos destaca en t√©rminos de precisi√≥n-recall, lo que sugiere la necesidad de aplicar t√©cnicas adicionales de optimizaci√≥n o usar modelos m√°s avanzados.</p>
  </div>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="s2">&quot;attention_unet_pred.npz&quot;</span><span class="p">,</span> <span class="s2">&quot;Attention U-Net&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Pumacens\AppData\Local\Temp\ipykernel_21124\1317268308.py:38: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  plt.tight_layout()
C:\Users\Pumacens\AppData\Roaming\Python\Python312\site-packages\IPython\core\pylabtools.py:170: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/b56b329df1dc76a2e1d6baf3ed5f8bc57f4ab2fc36ad41d4c1790daa061b06b8.png" src="_images/b56b329df1dc76a2e1d6baf3ed5f8bc57f4ab2fc36ad41d4c1790daa061b06b8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="s2">&quot;maskrcnn_pred.npz&quot;</span><span class="p">,</span> <span class="s2">&quot;Mask R-CNN&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7c31e3d53d0453db3256768841f8c9b780e7306fb91189ef5e38df3c6e93d3a3.png" src="_images/7c31e3d53d0453db3256768841f8c9b780e7306fb91189ef5e38df3c6e93d3a3.png" />
</div>
</div>
<div style="border-left: 6px solid #2ecc71; border-radius: 6px; overflow: hidden;">
  <div style="background-color: #d4f8e8; padding: 8px 12px;">
    <strong>üí° An√°lisis</strong>
  </div>
  <div style="background-color: #f5fdf9; padding: 12px;">
<p><strong>üîç Attention U-Net</strong><br><br>
El modelo <strong>Attention U-Net</strong> presenta un AUC-ROC de <code>0.693</code>, mostrando una capacidad razonable para clasificar correctamente entre clases. Sin embargo, su desempe√±o en la curva Precision-Recall es limitado, con un AUC de <code>0.349</code>. Esto indica que, aunque es capaz de identificar correctamente muchas regiones, su precisi√≥n disminuye r√°pidamente a medida que se busca mayor sensibilidad, lo que puede derivar en un incremento de falsos positivos.<br><br></p>
<p><strong>üîç Mask R-CNN</strong><br><br>
El modelo <strong>Mask R-CNN</strong> sobresale con un AUC-ROC de <code>0.821</code>, destac√°ndose como uno de los mejores en esta m√©trica. Adem√°s, alcanza un excelente rendimiento en la curva Precision-Recall, con un AUC de <code>0.535</code>, lo cual indica un balance adecuado entre precisi√≥n y sensibilidad. Esta combinaci√≥n lo posiciona como una opci√≥n robusta y confiable, especialmente en contextos cl√≠nicos donde es crucial minimizar errores en ambas direcciones.</p>
  </div>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="s2">&quot;resunet_pred.npz&quot;</span><span class="p">,</span> <span class="s2">&quot;ResUNet&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/da8d8862b41ab9ba41219d626bda7a40bedafe4d55c90ea8b3e4f5d6b3ff363b.png" src="_images/da8d8862b41ab9ba41219d626bda7a40bedafe4d55c90ea8b3e4f5d6b3ff363b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="s2">&quot;pspnet_pred.npz&quot;</span><span class="p">,</span> <span class="s2">&quot;PSPNet&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Pumacens\AppData\Local\Temp\ipykernel_21124\1317268308.py:38: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  plt.tight_layout()
C:\Users\Pumacens\AppData\Roaming\Python\Python312\site-packages\IPython\core\pylabtools.py:170: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/8bf10ee418823eb30f154c6fdb3065c9c6457cee0ce9c52d6aa7cb4c76776ddc.png" src="_images/8bf10ee418823eb30f154c6fdb3065c9c6457cee0ce9c52d6aa7cb4c76776ddc.png" />
</div>
</div>
<div style="border-left: 6px solid #2ecc71; border-radius: 6px; overflow: hidden;">
  <div style="background-color: #d4f8e8; padding: 8px 12px;">
    <strong>üí° An√°lisis</strong>
  </div>
  <div style="background-color: #f5fdf9; padding: 12px;">
<p><strong>üîç ResUNet</strong><br><br>
El modelo <strong>ResUNet</strong> presenta un desempe√±o modesto, con un AUC-ROC de <code>0.572</code> y un AUC de la curva Precision-Recall de apenas <code>0.194</code>. Estos valores sugieren una capacidad limitada para distinguir correctamente entre clases y una baja precisi√≥n a medida que se incrementa la sensibilidad. Este comportamiento lo hace menos recomendable para tareas donde se requiere una detecci√≥n precisa y consistente.<br><br></p>
<p><strong>üîç PSPNet</strong><br><br>
En contraste, <strong>PSPNet</strong> muestra un rendimiento excelente con un AUC-ROC de <code>0.850</code> y un AUC-PR de <code>0.436</code>, lo que indica una alta capacidad de clasificaci√≥n y un buen equilibrio entre precisi√≥n y recall. Este modelo demuestra ser altamente efectivo, particularmente en entornos donde es crucial evitar tanto falsos positivos como falsos negativos.</p>
  </div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="s2">&quot;fcn_pred.npz&quot;</span><span class="p">,</span> <span class="s2">&quot;FCN&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Pumacens\AppData\Local\Temp\ipykernel_21124\1317268308.py:38: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  plt.tight_layout()
C:\Users\Pumacens\AppData\Roaming\Python\Python312\site-packages\IPython\core\pylabtools.py:170: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/0f6eeb1eab4709a2233f72813769e416f73658c5e7c835142c48d4fa9e137365.png" src="_images/0f6eeb1eab4709a2233f72813769e416f73658c5e7c835142c48d4fa9e137365.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mostrar_curvas_roc_pr</span><span class="p">(</span><span class="s2">&quot;swin_unet_pred.npz&quot;</span><span class="p">,</span> <span class="s2">&quot;Swin U-Net&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Pumacens\AppData\Roaming\Python\Python312\site-packages\IPython\core\pylabtools.py:170: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/456b5c6344c75de4be64624f5f23435ba3c2a04335878ebdb9847bd1d45a6e6c.png" src="_images/456b5c6344c75de4be64624f5f23435ba3c2a04335878ebdb9847bd1d45a6e6c.png" />
</div>
</div>
<div style="border-left: 6px solid #2ecc71; border-radius: 6px; overflow: hidden;">
  <div style="background-color: #d4f8e8; padding: 8px 12px;">
    <strong>üí° An√°lisis</strong>
  </div>
  <div style="background-color: #f5fdf9; padding: 12px;">
<p><strong>üîç FCN</strong><br><br>
El modelo <strong>FCN</strong> ofrece un desempe√±o s√≥lido, alcanzando un AUC-ROC de <code>0.771</code> y un AUC de la curva Precision-Recall de <code>0.374</code>. Estos valores indican que el modelo logra distinguir adecuadamente entre clases, con un buen equilibrio entre sensibilidad y precisi√≥n, aunque todav√≠a con margen de mejora frente a modelos m√°s avanzados.<br><br></p>
<p><strong>üîç Swin U-Net</strong><br><br>
<strong>Swin U-Net</strong> mantiene un rendimiento competitivo con un AUC-ROC de <code>0.759</code> y un AUC-PR de <code>0.390</code>. Aunque ligeramente inferior al modelo FCN en la m√©trica ROC, presenta una mejor relaci√≥n entre precisi√≥n y recall, lo que lo hace m√°s adecuado en escenarios donde la clase positiva es escasa o dif√≠cil de detectar.</p>
  </div>
</div><ul class="simple">
<li><p><strong>U-Net</strong></p>
<ul>
<li><p>ROC AUC = 0.698: desempe√±o moderado, con capacidad discriminativa aceptable.</p></li>
<li><p>PR AUC = 0.297: baja. El modelo tiende a sacrificar precisi√≥n a medida que aumenta el recall.</p></li>
<li><p>Comentario: U-Net logra un equilibrio aceptable en clasificaci√≥n general, pero sufre para mantener precisi√≥n cuando intenta cubrir m√°s √°rea positiva.</p></li>
</ul>
</li>
<li><p><strong>V-Net</strong></p>
<ul>
<li><p>ROC AUC = 0.631: cercano al azar, indica baja discriminaci√≥n.</p></li>
<li><p>PR AUC = 0.134: extremadamente baja, lo que indica que el modelo produce muchos falsos positivos.</p></li>
<li><p>Comentario: Este modelo presenta un rendimiento muy pobre en segmentaci√≥n; incluso al aumentar el recall, la precisi√≥n colapsa.</p></li>
</ul>
</li>
<li><p><strong>SegNet</strong></p>
<ul>
<li><p>ROC AUC = 0.641: desempe√±o bajo, pero por encima del azar. La capacidad de distinguir entre p√≠xeles positivos y negativos es limitada.</p></li>
<li><p>PR AUC = 0.182: muy baja. El modelo presenta dificultades significativas para mantener una buena precisi√≥n cuando intenta aumentar el recall.</p></li>
<li><p>Comentario: SegNet tiene un comportamiento d√©bil en t√©rminos de segmentaci√≥n vascular. Aunque discrimina ligeramente mejor que V-Net, el modelo comete muchos falsos positivos y no logra un buen compromiso entre precisi√≥n y sensibilidad, lo cual se refleja claramente en la curva Precision-Recall.</p></li>
</ul>
</li>
<li><p><strong>DeepLabV3+</strong></p>
<ul>
<li><p>ROC AUC = 0.670: levemente mejor que V-Net, pero a√∫n d√©bil.</p></li>
<li><p>PR AUC = 0.206: igualmente baja.</p></li>
<li><p>Comentario: El modelo no logra un buen balance entre detecci√≥n y precisi√≥n, similar a V-Net.</p></li>
</ul>
</li>
<li><p><strong>Attention U-Net</strong></p>
<ul>
<li><p>ROC AUC = 0.693: similar a U-Net, pero no superior.</p></li>
<li><p>PR AUC = 0.349: mejor que U-Net y DeepLabV3+, aunque sigue siendo limitado.</p></li>
<li><p>Comentario: El uso de atenci√≥n mejora ligeramente la calidad de la segmentaci√≥n en t√©rminos de precisi√≥n y recall.</p></li>
</ul>
</li>
<li><p><strong>Mask R-CNN</strong></p>
<ul>
<li><p>ROC AUC = 0.821: el m√°s alto entre todos los modelos.</p></li>
<li><p>PR AUC = 0.535: tambi√©n el mejor valor.</p></li>
<li><p>Comentario: Este modelo tiene un rendimiento sobresaliente, identificando correctamente una gran proporci√≥n de verdaderos positivos sin perder precisi√≥n. Se adapta bien a la tarea incluso con clases desbalanceadas.</p></li>
</ul>
</li>
<li><p><strong>ResUNet</strong></p>
<ul>
<li><p>ROC AUC = 0.572: el peor valor ROC de todos los modelos.</p></li>
<li><p>PR AUC = 0.194: tambi√©n bajo.</p></li>
<li><p>Comentario: Aunque tiene buena precisi√≥n puntual en m√©tricas previas, el modelo no logra detectar correctamente los vasos a nivel de recall, lo cual se evidencia aqu√≠.</p></li>
</ul>
</li>
<li><p><strong>PSPNet</strong></p>
<ul>
<li><p>ROC AUC = 0.850: el mejor valor ROC.</p></li>
<li><p>PR AUC = 0.436: tambi√©n alto.</p></li>
<li><p>Comentario: PSPNet presenta uno de los mejores compromisos entre sensibilidad y precisi√≥n, especialmente para clases peque√±as. Ideal para segmentaci√≥n detallada.</p></li>
</ul>
</li>
<li><p><strong>FCN</strong></p>
<ul>
<li><p>ROC AUC = 0.771: alto y consistente.</p></li>
<li><p>PR AUC = 0.374: valor intermedio, por encima de muchos modelos cl√°sicos.</p></li>
<li><p>Comentario: FCN ofrece un rendimiento s√≥lido y consistente. No destaca como PSPNet o Mask R-CNN, pero claramente supera a U-Net y DeepLabV3+.</p></li>
</ul>
</li>
<li><p><strong>Swin U-Net</strong></p>
<ul>
<li><p>ROC AUC = 0.759: alto.</p></li>
<li><p>PR AUC = 0.390: tambi√©n bueno.</p></li>
<li><p>Comentario: El modelo Swin U-Net mantiene una muy buena discriminaci√≥n general y una buena relaci√≥n precisi√≥n-recall. Su arquitectura basada en transformers parece efectiva incluso en este dataset reducido.</p></li>
</ul>
</li>
</ul>
<p>Los modelos Mask R-CNN, PSPNet y Swin U-Net presentan las mejores curvas, tanto en ROC como en Precision-Recall. Modelos como V-Net, DeepLabV3+ y ResUNet muestran curvas planas o con ca√≠das abruptas, se√±al de mala capacidad de generalizaci√≥n y muchos errores de tipo I o II. La curva Precision-Recall fue especialmente √∫til para identificar el verdadero poder del modelo en este problema desbalanceado.</p>
</section>
<section id="mapa-de-error">
<h3>Mapa de Error<a class="headerlink" href="#mapa-de-error" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">tifffile</span> <span class="k">as</span> <span class="nn">tiff</span>

<span class="k">def</span> <span class="nf">mostrar_mapa_error</span><span class="p">(</span><span class="n">tid</span><span class="p">,</span> <span class="n">ruta_npz</span><span class="p">,</span> <span class="n">indice</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ruta_imagen</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">):</span>
    <span class="c1"># Cargar imagen original</span>
    <span class="n">img_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ruta_imagen</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tid</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">tiff</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>
    <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">img</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># convertir a RGB</span>

    <span class="c1"># Cargar predicciones</span>
    <span class="n">datos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ruta_npz</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">datos</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">][</span><span class="n">indice</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">datos</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">][</span><span class="n">indice</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="n">pred</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">gt</span> <span class="o">=</span> <span class="n">HuBMAP</span><span class="p">([])</span><span class="o">.</span><span class="n">_mask</span><span class="p">(</span><span class="n">tid</span><span class="p">)</span>

    <span class="c1"># Calcular FP y FN</span>
    <span class="n">FP</span> <span class="o">=</span> <span class="p">(</span><span class="n">pred</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">gt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">FN</span> <span class="o">=</span> <span class="p">(</span><span class="n">pred</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">gt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Crear imagen en blanco (RGB) del error</span>
    <span class="n">error_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">error_img</span><span class="p">[</span><span class="n">FP</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>   <span class="c1"># Rojo para FP</span>
    <span class="n">error_img</span><span class="p">[</span><span class="n">FN</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>   <span class="c1"># Azul para FN</span>

    <span class="c1"># Mostrar imagen original, GT, predicci√≥n y mapa de error</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Imagen Original&quot;</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gt</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Ground Truth&quot;</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Predicci√≥n&quot;</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">error_img</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Mapa de Error</span><span class="se">\n</span><span class="s2">Rojo = FP | Azul = FN&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Ejemplo de uso:</span>
<span class="n">mostrar_mapa_error</span><span class="p">(</span><span class="s2">&quot;0006ff2aa7cd&quot;</span><span class="p">,</span> <span class="s2">&quot;swin_unet_pred.npz&quot;</span><span class="p">,</span> <span class="n">indice</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a70987117eb95834774b6cd38171afe80dfd10dbeff9bf7907b24a69fae881e3.png" src="_images/a70987117eb95834774b6cd38171afe80dfd10dbeff9bf7907b24a69fae881e3.png" />
</div>
</div>
<div style="border-left: 6px solid #2ecc71; border-radius: 6px; overflow: hidden;">
  <div style="background-color: #d4f8e8; padding: 8px 12px;">
    <strong>üí° An√°lisis</strong>
  </div>
  <div style="background-color: #f5fdf9; padding: 12px;">
    El <strong>Mapa de Error</strong> proporciona una visualizaci√≥n intuitiva de los errores cometidos por el modelo de segmentaci√≥n. Se destacan dos tipos de errores:
    <ul>
      <li style="margin-bottom: 4px;"><strong style="color: red;">Falsos Positivos (FP)</strong>: en <span style="color: red;">rojo</span>, representan regiones que el modelo predijo como positivas (vasos), pero que no estaban presentes en la verdad de terreno.</li>
      <li><strong style="color: blue;">Falsos Negativos (FN)</strong>: en <span style="color: blue;">azul</span>, representan regiones verdaderas no detectadas por el modelo.</li>
    </ul>
    En el ejemplo mostrado, el modelo <strong>Swin U-Net</strong> logra una segmentaci√≥n general adecuada, aunque se observan varias regiones mal clasificadas. Los <strong>errores FP</strong> predominan en √°reas perif√©ricas a los vasos reales, mientras que los <strong>FN</strong> suelen coincidir con vasos m√°s delgados o parcialmente visibles. 
    Esto sugiere que, aunque el modelo tiene una buena sensibilidad general, a√∫n existen oportunidades de mejora en la detecci√≥n de estructuras peque√±as o ambiguas.
  </div>
</div></section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="modelos_regresion.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Ejercicio 3. Modelos de Regresi√≥n</p>
      </div>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parte-a">Parte A</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parte-b">Parte B</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parte-c">Parte C</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplots">Boxplots</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#histogramas">Histogramas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparacion-visual-de-imagenes">Comparacion Visual de Imagenes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#curvas-roc-y-precision-recall">Curvas ROC y Precision-Recall</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mapa-de-error">Mapa de Error</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Ang√©lica Sep√∫lveda, Andr√©s Pedraza y Jefry Llerena
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      ¬© Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>